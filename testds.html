<div class="title"><a href="http://cnodejs.org/topic/51d3dbb3d44cbfa30434df7d" target="_blank">
      前端程序媛实习森求node教学
    </a>24 分钟前</div><p>呃<br>一直听说nodejs酱紫神奇的东西<br>但是入门还是赶脚流程有点难以自学<br>求带上路<br>然后可以把我丢掉让我自己走<br>拜托啦~~<br>  Q 351896959</p>
<p>媛 非 猿 ?估计一群牛人有兴趣了..可惜我菜鸟一个帮不上忙...</p>
<p>媛.....</p>
<p>  共同学习呀。<br>  我也是按照wiki教程初学的。</p>
<p>加我Q 或者 微信 littletree001</p>
<p>对于这种程序猿，我只想对她说：“请联系我！”</p>
<p>怎么联系 求方式 ^_^</p>
<p>老雷我鄙视你~看见妹纸基友都不要了！</p>
<p>@<a href="/user/snoopy">snoopy</a> 物以稀为贵嘛</p>
<p>我勒个去大牛发话了!!!!!</p>
<p>呃 一起来~</p>
<p>哪天 Node 社区也来个 Model 就好了, 全部都变热心人了..<br>我能问下真是女生吗.. 为什么要学前端...</p>
<p>真的是女生啦 学前端都一年半了呀 现在在杭州实习</p>
<p>@<a href="/user/tree0515">tree0515</a> 貌似我碰到新手第一件事就是怂恿学 CoffeScript... JS 太难看了</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 太....难...看.... %&gt;_&lt;%</p>
<p>@<a href="/user/tree0515">tree0515</a> 认同，图灵社区里有本书叫《深入浅出 Coffeescript》，可以看一看。Coffee 确实优美得多<br>(虽然我刚开始用的时候经常不能正确编译成我想要的代码....(光速逃</p>
<div class="title"><a href="http://cnodejs.org/topic/50ce892c637ffa41558e743b" target="_blank">
      如何从appfog导出数据库文件？
    </a>58 分钟前</div><p>我想把appfog上的mongodb的数据库文件导出来下载到本机，如何操作？求助</p>
<p>搭建一个phpMyAdmin来管理数据库！</p>
<p>phpMyAdmin可以管理mongo吗？我没试过，但是搜索出来都是Mysql管理工具phpMyAdmin</p>
<p> @<a href="/user/cony138">cony138</a> @<a href="/user/cony138">cony138</a> 是在用mongodb么？ mysql的也一样，详细请看文档~~<a href="http://blog.appfog.com/manage-your-appfog-data-from-your-workstation/">Manage your AppFog data from your workstation</a> ，还有这个<a href="http://blog.csdn.net/llmlx/article/details/7762367">nodejs与cloudfoundry之二:tunnel to mongodb</a></p>
<p>mygod,还要学php么。</p>
<div class="title"><a href="http://cnodejs.org/topic/50f6bc56df9e9fcc58745985" target="_blank">
      大家多用 Markdown 吧, 写了份说明, 方便找教程
    </a>7-10 12:07</div><p>希望不熟悉 Markdown 的同学参照 GFM 语法标记好代码, 别让页面太难看 :)<br><a href="http://jiyinyiyong.github.com/article/06-use-gfm-please/page/">原文</a></p>
<hr>
<h1>Markdown 是什么</h1>
<p>关于这一点, <a href="http://zh.wikipedia.org/zh/Markdown">Wiki</a> 上最为明确了, 直接就上用法<br>中文的好的教程还有 <a href="http://wowubuntu.com/markdown/">WOW Ubuntu</a> 的教程, 非常详细, 猜是<a href="http://markdown.tw/">翻译</a><br><a href="http://www.yangzhiping.com/tech/r-markdown-knitr.html">阳志平的个人网站</a>写的说明也听好动懂的<br>教程还有<a href="http://www.stack.nl/~dimitri/doxygen/manual/markdown.html">更多</a>以及<a href="http://www.showdown.im/">更多</a>的版本</p>
<p>Markdown 项目主页在 <a href="http://en.wikipedia.org/wiki/Daring_Fireball">Daring Fireball</a> 的<a href="http://daringfireball.net/projects/markdown/">网站上有具体的说明</a><br>一篇题名 <a href="http://www.codinghorror.com/blog/2012/10/the-future-of-markdown.html">The Future of Markdown</a> 讲述了 Markdown 的现状<br>Markdown 是一门缺乏标准的语言, 在 Github, StackOverflow 都有各自的特性<br>国内的 <a href="http://cnodejs.org/">CNode</a>, <a href="http://ruby-china.org/topics">Ruby-China</a>, <a href="http://python-china.org/">Python-China</a> 论坛应该借鉴自 Github</p>
<h2>个人经历</h2>
<p>目前 Markdown 有多个实现, 这个问题我当初非常纠结地问过,<br>逛 Github 多了, 慢慢熟悉了 Github 自己的 Markdown 方言 <a href="http://github.github.com/github-flavored-markdown/">GFM</a><br>我现在用 <a href="https://github.com/chjj/marked">Marked</a> 这个支持 GFM 的版本来麻页面</p>
<p>网上用的标记, 主要是链接, 代码, 其他在一般帖子里不太需要<br>至少, 这两样功能必须优化到极致的, 在编辑方面必须要足够轻松<br>而 Markdown 的好处, 也在于直接作为纯文本编辑, 不用多么复杂</p>
<h1>GFM 的语法</h1>
<h2>链接</h2>
<p>首先链接在 GFM 里是自动标记的, 而原始的版本要加 <code>&lt;&gt;</code>:</p>
<p><a href="http://daringfireball.net/">http://daringfireball.net/</a><br><a href="http://daringfireball.net/">http://daringfireball.net/</a></p>
<pre class="prettyprint"><code>http://daringfireball.net/
&lt;http://daringfireball.net/&gt;</code></pre>
<p>也可以直接嵌在文字当中, 比如标记一个 <a href="http://lyric.im/ma-de-markdown-wysiwyg-editor/">MaDe 编辑器</a></p>
<pre class="prettyprint"><code>也可以直接嵌在文字当中, 比如标记一个 [MaDe 编辑器](http://lyric.im/ma-de-markdown-wysiwyg-editor/)</code></pre>
<p>或者比如说<a href="http://markedapp.com/">另一个名叫 marked 的 iOS 应用</a>我没装过的 - -!</p>
<pre class="prettyprint"><code>或者比如说[另一个名叫 marked 的 iOS 应用][app]我没装过的 - -!
[app]: http://markedapp.com/</code></pre>
<h2>代码</h2>
<p>代码有句中的代码, 代码块, 都是用的 <code>` </code> 作为符号标记的<br>句中用 <code>1</code> 个或者 <code>2</code> 个, 而代码块用 <code>3</code> 个单独作为行的反引号<br>Github 也许无法很好解析这些细节, Marked 却是可以的</p>
<pre class="prettyprint"><code>代码有句中的代码, 代码块, 都是用的 `` ` `` 作为符号标记的
句中用 `1` 个或者 `2` 个, 而代码块用 `3` 个单独作为行的反引号
Github 也许无法很好解析这些细节, Marked 却是可以的</code></pre>
<p>另外 Github 上在代码块第一行反引号之后可以声明语法<br>比如 JS 下面这样就会被在 HTML 标记上一些属性<br>Github 站点上会直接对代码形成语法高亮, 其他很多模块也借鉴了</p>
<pre class="prettyprint">
```js
console.log('这里有问题, 我的反引号是写在下一行的 -&gt;');
```
</pre>

<p>另外 <a href="https://github.com/chjj/marked#usage">marked</a> 就可以配合 <a href="http://softwaremaniacs.org/soft/highlight/en/">Highlight.js</a> 在编译时高亮代码, 方便博客排版</p>
<h2>图片</h2>
<p>图片的标记和链接非常相似, 方括号文本部分在对应图片的 alt 属性, 后边括号是网址:</p>
<p><img src="http://d2o0t5hpnwv4c1.cloudfront.net/2063_markdown/preview.png" alt="Mark-Up"></p>
<p><img src="http://octodex.github.com/images/aidorucat.png" alt="Mark-Down"></p>
<p><a href="http://octodex.github.com/codercat"><img src="http://octodex.github.com/images/codercat.jpg" alt="Mark-Down"></a></p>
<pre class="prettyprint"><code>![Mark-Up](http://d2o0t5hpnwv4c1.cloudfront.net/2063_markdown/preview.png)

![Mark-Down][cat-girl]
[cat-girl]: http://octodex.github.com/images/aidorucat.png

[![Mark-Down][cat-boy]][octocat]
[cat-boy]: http://octodex.github.com/images/codercat.jpg
[octocat]: http://octodex.github.com/codercat</code></pre>
<p>带链接的图片比较搞, 其实还不如直接在里边写 HTML,<br>但说回来, 允许 HTML 实在是危险的, 有时候就要进行过滤, 比如 CNode 上做的</p>
<h2>文本样式</h2>
<p>另外还有 <code>&gt;</code> 开头的引用,</p>
<blockquote>
<p>Aaron Swartz</p>
</blockquote>
<p><code>**</code> 包围的 <strong>加粗</strong>, <code>*</code> 包围的 <em>斜体</em>, <code>~</code> 包围的删除线等等,<br>甚至用 HTML 标签直接添加 Markdown 不直接支持的样式可以</p>
<ul>
<li>还有列表之类的功能</li>
<li>这里是无序的列表, 用 <code>*</code> 写在巷头即可</li>
</ul>
<p>还有有序列表</p>
<ol>
<li>有序列表大概的样子和无序列表一样</li>
<li>然后数字写在行开头标记</li>
</ol>
<pre class="prettyprint"><code>另外还有 `&gt;` 开头的引用,

&gt; Aaron Swartz

`**` 包围的 **加粗**, `*` 包围的 *斜体*, `~` 包围的删除线等等,
甚至用 HTML 标签直接添加 Markdown 不直接支持的样式可以

* 还有列表之类的功能
* 这里是无序的列表, 用 `*` 写在巷头即可

还有有序列表

1. 有序列表大概的样子和无序列表一样
2. 然后数字写在行开头标记</code></pre>
<ul>
<li>标题</li>
</ul>
<p>标题是用 <code>#</code> 写在行头来标记的, 比如 <code># ## ### ######</code> 对应 <code>h1</code> 到 <code>h6</code> 标签<br>一个比较方便的写法是用 <code>------ ======</code> 线来标记标题, 比如下面的:</p>
<h3>h3</h3>
<h4>h4</h4>
<h2>h2</h2>
<h1>h1</h1>
<pre class="prettyprint"><code>### h3
#### h4

h2
------

h1
======</code></pre>
<p>不过在文本中肆意使用标题也不是多好的办法, 尽量保证文本清晰才好</p>
<p>还有注意换行, 因为 <code>------</code> 上下被空行包裹时是个 <code>&lt;hr&gt;</code> 分割线<br>Markdown 其实很多地方要留意空行的, 也许会出现意外</p>
<h1>多用 GFM</h1>
<p>更多的细节, 看文档比看我介绍一遍要轻松多了<br>论坛上看到好多 Markdown 标记失败的帖子, 别提多伤心了</p>
<p>作为 Coder, 对编辑器字体和高亮各种挑剔, 我想大多数人都是有体会的<br>没有高亮, 没有等宽字体, 甚至手写的代码, 那都是多不自在的<br>Markdown 无疑是对于网页一个更好的解决方式<br>除非有一天, 我们直接在网页上嵌入代码编辑器专门处理代码<br>或者有发明出强大的代码图片和链接可视化编辑工具, 那另当别论</p>
<p>最后链上一份各种标记语言的对比, 至少看下喜欢哪个 ;p<br><a href="http://www.worldhello.net/gotgithub/appendix/markups.html">http://www.worldhello.net/gotgithub/appendix/markups.html</a></p>
<p>我看你发的那个人用eido而非mk，这是什么东西，你能翻点东西给我们吗？<br>摘要那位大神的话</p>
<pre class="prettyprint"><code>现在的 typeof.net 里面一个动态文件也没有，所有的东西都是用 eidoc 从 .ed 文件生成的 HTML。你也许会问我为什么不用 markdown 这种流行物，我要说，markdown 没有宏，没法作出 eido 这种逆天的效果。整个 typeof.net 我没有写一行 HTML，所有的东西都是 eidoc 生成的。</code></pre>
<p>貌似是他自己做的标记语言, 相关的信息我找不出来, Github 链接他文章里倒是有</p>
<p>那个神人就是这个神人吧。<br>对 eidoc 同感兴趣。感觉和 MARKDOWN 平行的一种工具。</p>
<p>伤不起了, 这里跟 Marked 相比语法支持又少了, 大量出错 - -!</p>
<p>厄，我们就是使用它的啊</p>
<p>@<a href="/user/suqian">suqian</a> 这是半年前的帖子啊亲</p>
<p>支持md，以后基本都是fe基本技能了</p>
<p>方括号文本部分在对应图片的 title, 后边括号是网址</p>
<p>这个有问题吧，方括号是alt吧？</p>
<p>看得超细.. 我记混了, 订正了</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 赞~</p>
<p><code>this is cod test</code></p>
<p>模板引擎吗</p>
<p>标记语言而已, 不是模板引擎. 标记语言平常写博客和评论里加样式用的,<br>比如 ~呵呵~, <strong>呵呵</strong>, <strong>呵呵</strong></p>
<div class="title"><a href="http://cnodejs.org/topic/516b64596d38277306407936" target="_blank">
      Node.js 异步异常的处理与domain模块解析
    </a>4-15 10:22</div><h3>异步异常处理</h3>
<h4>异步异常的特点</h4>
<p>由于node的回调异步特性，无法通过<code>try catch</code>来捕捉所有的异常：   </p>
<pre class="prettyprint"><code>try {
  process.nextTick(function () {
      foo.bar();
  });
} catch (err) {
  //can not catch it
}</code></pre>
<p>而对于web服务而言，其实是非常希望这样的：   </p>
<pre class="prettyprint"><code>//express风格的路由
app.get(&#39;/index&#39;, function (req, res) {
  try {
    //业务逻辑
  } catch (err) {
    logger.error(err);
    res.statusCode = 500;
    return res.json({success: false, message: &#39;服务器异常&#39;});
  }
});</code></pre>
<p>如果<code>try catch</code>能够捕获所有的异常，这样我们可以在代码出现一些非预期的错误时，能够记录下错误的同时，友好的给调用者返回一个500错误。可惜，<code>try catch</code>无法捕获异步中的异常。所以我们能做的只能是：  </p>
<pre class="prettyprint"><code>app.get(&#39;/index&#39;, function (req, res) {
  // 业务逻辑  
});

process.on(&#39;uncaughtException&#39;, function (err) {
  logger.error(err);
});</code></pre>
<p>这个时候，虽然我们可以记录下这个错误的日志，且进程也不会异常退出，但是我们是没有办法对发现错误的请求友好返回的，只能够让它超时返回。  </p>
<h4>domain</h4>
<p>在node v0.8+版本的时候，发布了一个模块<code>domain</code>。这个模块做的就是<code>try catch</code>所无法做到的：捕捉异步回调中出现的异常。<br>于是乎，我们上面那个无奈的例子好像有了解决的方案：   </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);

//引入一个domain的中间件，将每一个请求都包裹在一个独立的domain中
//domain来处理异常
app.use(function (req,res, next) {
  var d = domain.create();
  //监听domain的错误事件
  d.on(&#39;error&#39;, function (err) {
    logger.error(err);
    res.statusCode = 500;
    res.json({sucess:false, messag: &#39;服务器异常&#39;});
    d.dispose();
  });

  d.add(req);
  d.add(res);
  d.run(next);
});

app.get(&#39;/index&#39;, function (req, res) {
  //处理业务
});</code></pre>
<p>我们通过中间件的形式，引入domain来处理异步中的异常。当然，domain虽然捕捉到了异常，但是还是由于异常而导致的堆栈丢失会导致内存泄漏，所以出现这种情况的时候还是需要重启这个进程的，有兴趣的同学可以去看看<a href="https://github.com/fengmk2/domain-middleware">domain-middleware</a>这个domain中间件。  </p>
<h3>诡异的失效</h3>
<p>我们的测试一切正常，当正式在生产环境中使用的时候，发现<code>domain</code>突然失效了！它竟然没有捕获到异步中的异常，最终导致进程异常退出。经过一番排查，最后发现是由于引入了redis来存放session导致的。   </p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);
var connect = require(&#39;connect&#39;);
var RedisStore = require(&#39;connect-redis&#39;)(connect);
var domainMiddleware = require(&#39;domain-middleware&#39;);

var server = http.createServer();
var app = connect();
app.use(connect.session({
  key: &#39;key&#39;,
  secret: &#39;secret&#39;,
  store: new RedisStore(6379, &#39;localhost&#39;)
}));
//domainMiddleware的使用可以看前面的链接
app.use(domainMiddleware({
  server: server,
  killTimeout: 30000
}));</code></pre>
<p>此时，当我们的业务逻辑代码中出现了异常，发现竟然没有被<code>domain</code>捕获！经过一番尝试，终于将问题定位到了：  </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);
var redis = require(&#39;redis&#39;);
var cache = redis.createClient(6379, &#39;localhost&#39;);

function error() {
  cache.get(&#39;a&#39;, function () {
    throw new Error(&#39;something wrong&#39;);
  });
}

function ok () {
  setTimeout(function () {
    throw new Error(&#39;something wrong&#39;);
  }, 100);
}
var d = domain.create();
d.on(&#39;error&#39;, function (err) {
  console.log(err);
});

d.run(ok);    //domain捕获到异常
d.run(error); //异常被抛出</code></pre>
<p>奇怪了！都是异步调用，为什么前者被捕获，后者却没办法捕获到呢？   </p>
<h3>Domain剖析</h3>
<p>回过头来，我们来看看domain做了些什么来让我们捕获异步的请求(代码来自node v0.10.4，此部分可能正在快速变更优化)。如果对domain还不甚了解的同学可以先简单过一下domain的<a href="nodejs.org/api/domain.html">文档</a>。  </p>
<h4>node事件循环机制</h4>
<p>在看Domain的原理之前，我们先要了解一下<code>nextTick</code>和<code>_tickCallback</code>的<a href="https://github.com/joyent/node/blob/v0.10.4/src/node.js#L395">两个方法</a>。  </p>
<pre class="prettyprint"><code>function laterCall() {
  console.log(&#39;print me later&#39;);
}

process.nextTick(laterCallback);
console.log(&#39;print me first&#39;);</code></pre>
<p>上面这段代码写过node的人都很熟悉，<code>nextTick</code>的作用就是把laterCallback放到下一个事件循环去执行。而<code>_tickCallback</code>方法则是一个非公开的方法，这个方法是在当前时间循环结束之后，调用之以继续进行下一个事件循环的入口函数。  </p>
<p>换而言之，node为事件循环维持了一个队列，<code>nextTick</code>入队，<code>_tickCallback</code>出列。  </p>
<h4>domain的实现</h4>
<p>在了解了node的事件循环机制之后，我们再来看看domain做了些什么。<br>domain自身其实是一个<code>EventEmitter</code>对象，它通过事件的方式来传递捕获的错误。这样我们在研究它的时候，就简化到两个点：  </p>
<ul>
<li><p>什么时候触发domain的<code>error</code>事件：  </p>
<ul>
<li>进程抛出了异常，没有被任何的<code>try catch</code>捕获到，这时候将会触发整个process的<code>processFatal</code>，此时如果在domain包裹之中，将会在domain上触发<code>error</code>事件，反之，将会在process上触发<code>uncaughtException</code>事件。   </li>
</ul>
</li>
<li><p>domain如何在多个不同的事件循环中传递：     </p>
<ol>
<li>当domain被实例化之后，我们通常会调用它的<code>run</code>方法（如之前在web服务中的使用），来将某个函数在这个domain示例的包裹中执行。被包裹的函数在执行的时候，<code>process.domain</code>这个全局变量将会被指向这个domain实例。当这个事件循环中，抛出异常调用<code>processFatal</code>的时候，发现<code>process.domain</code>存在，就会在domain上触发<code>error</code>事件。   </li>
<li><p>在require引入domain模块之后，会重写全局的<code>nextTick</code>和<code>_tickCallback</code>,注入一些domain相关的<a href="https://github.com/joyent/node/blob/v0.10.4/src/node.js#L426">代码</a>：</p>
<pre class="prettyprint"><code>//简化后的domain传递部分代码
function nextDomainTick(callback) {
 nextTickQueue.push({callback: callback, domain: process.domain});
}

function _tickDomainCallback() {
 var tock = nextTickQueue.pop();
 //设置process.domain = tock.domain
 tock.domain &amp;&amp; tock.domain.enter();
 callback();
 //清除process.domain
 tock.domain &amp;&amp; tock.domain.exit();        
 }
};</code></pre>
</li>
</ol>
<p>这个是其在多个事件循环中传递domain的关键：<code>nextTick</code>入队的时候，记录下当前的domain，当这个被加入队列中的事件循环被<code>_tickCallback</code>启动执行的时候，将新的事件循环的<code>process.domain</code>置为之前记录的<code>domain</code>。这样，在被<code>domain</code>所包裹的代码中，不管如何调用<code>process.nextTick</code>, domain将会一直被传递下去。   </p>
<ol>
<li>当然，node的异步还有两种情况，一种是<code>event</code>形式。因此在<code>EventEmitter</code>的<a href="https://github.com/joyent/node/blob/master/lib/events.js#L28">构造函数</a>有如下代码：  </li>
</ol>
<pre class="prettyprint"><code>  if (exports.usingDomains) {
    // if there is an active domain, then attach to it.
    domain = domain || require(&#39;domain&#39;);
    if (domain.active &amp;&amp; !(this instanceof domain.Domain)) {
      this.domain = domain.active;
    }
  }</code></pre>
<p>实例化<code>EventEmitter</code>的时候，将会把这个对象和当前的domain绑定，当通过<code>emit</code>触发这个对象上的事件时，像<code>_tickCallback</code>执行的时候一样，回调函数将会重新被当前的<code>domain</code>包裹住。   </p>
<ol>
<li>而另一种情况，是<code>setTimeout</code>和<code>setInterval</code>，同样的，在<code>timer</code>的源码中，我们也可以发现这样的一句<a href="https://github.com/joyent/node/blob/master/lib/timers.js#L214">代码</a>:   </li>
</ol>
<pre class="prettyprint"><code> if (process.domain) timer.domain = process.domain;</code></pre>
<p>跟<code>EventEmmiter</code>一样，之后这些<code>timer</code>的回调函数也将被当前的domain包裹住了。   </p>
</li>
</ul>
<p><strong>node通过在<code>nextTick</code>, <code>timer</code>, <code>event</code>三个关键的地方插入domain的代码，让它们得以在不同的事件循环中传递。</strong></p>
<h4>更复杂的domain</h4>
<p>有些情况下，我们可能会遇到需要更加复杂的domain使用。   </p>
<ul>
<li>domain嵌套：我们可能会外层有domain的情况下，内层还有其他的domain，使用情景可以在文档中<a href="http://nodejs.org/api/domain.html#domain_explicit_binding">找到</a>  </li>
</ul>
<pre class="prettyprint"><code>// create a top-level domain for the server
var serverDomain = domain.create();

serverDomain.run(function() {
  // server is created in the scope of serverDomain
  http.createServer(function(req, res) {
    // req and res are also created in the scope of serverDomain
    // however, we&#39;d prefer to have a separate domain for each request.
    // create it first thing, and add req and res to it.
    var reqd = domain.create();
    reqd.add(req);
    reqd.add(res);
    reqd.on(&#39;error&#39;, function(er) {
      console.error(&#39;Error&#39;, er, req.url);
      try {
        res.writeHead(500);
        res.end(&#39;Error occurred, sorry.&#39;);
      } catch (er) {
        console.error(&#39;Error sending 500&#39;, er, req.url);
      }
    });
  }).listen(1337);
});</code></pre>
<p>为了实现这个功能，其实domain还会偷偷的自己维持一个domain的stack，有兴趣的童鞋可以在<a href="https://github.com/joyent/node/blob/v0.10.4/lib/domain.js#L44">这里</a>看到。   </p>
<h4>回头解决疑惑</h4>
<p>回过头来，我们再来看刚才遇到的问题：为什么两个看上去都是同样的异步调用，却有一个domain无法捕获到异常？理解了原理之后不难想到，肯定是调用了redis的那个异步调用在抛出错误的这个事件循环内，是不在domain的范围之内的。我们通过一段更加简短的代码来看看，到底在哪里出的问题。   </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);
var EventEmitter = require(&#39;events&#39;).EventEmitter;

var e = new EventEmitter();

var timer = setTimeout(function () {
  e.emit(&#39;data&#39;);  
}, 10);

function next() {
  e.once(&#39;data&#39;, function () {
    throw new Error(&#39;something wrong here&#39;);
  });
}

var d = domain.create();
d.on(&#39;error&#39;, function () {
  console.log(&#39;cache by domain&#39;);
});

d.run(next);</code></pre>
<p> 此时我们同样发现，错误不会被domain捕捉到，原因很清晰了：<code>timer</code>和<code>e</code>两个关键的对象在初始化的时候都时没有在domain的范围之内，因此，当在<code>next</code>函数中监听的事件被触发，执行抛出异常的回调函数时，其实根本就没有处于domain的包裹中，当然就不会被<code>domain</code>捕获到异常了！   </p>
<p>其实node针对这种情况，专门设计了一个<a href="http://nodejs.org/api/domain.html#domain_domain_add_emitter">API：domain.add</a>。它可以将domain之外的<code>timer</code>和<code>event</code>对象，添加到当前domain中去。对于上面那个例子：   </p>
<pre class="prettyprint"><code>d.add(timer);
//or
d.add(e);</code></pre>
<p>将<code>timer</code>或者<code>e</code>任意一个对象添加到domain上，就可以让错误被domain捕获了。   </p>
<p>再来看最开始<code>redis</code>导致domain无法捕捉到异常的问题。我们是不是也有办法可以解决呢？<br>看<a href="http://weibo.com/81715239">@python发烧友</a> 的这条<a href="http://weibo.com/1640328892/zrP7PdLkG">微博</a>我们就能理解，其实对于这种情况，还是没有办法实现最佳的解决方案的。现在对于非预期的异常产生的时候，我们只能够让当前请求超时，然后让这个进程停止服务，之后重新启动。<a href="https://github.com/fengmk2/graceful">graceful</a>模块配合<code>cluster</code>就可以实现这个解决方案。  </p>
<p><strong><code>domain</code>十分强大，但不是万能的。</strong>希望在看过这篇文章之后，大家能够正确的使用domian，避免踩坑。:)</p>
<hr>
<h4>题外推荐</h4>
<p>在整个问题排查与代码研究过程中，有一个工具起了巨大的作用：<code>node-inspector</code>，它可以让node代码在chrome下进行单步调试，能够跟进到node源码之中，<a href="http://weibo.com/goddyzhao">@<a href="/user/goddyzhao">goddyzhao</a></a>的文章<a href="http://blog.goddyzhao.me/post/11522397416/how-to-debug-node-with-node-inspector">使用node-inspector来调试node</a>详细介绍了如何使用<code>node-inspector</code>。</p>
<p>好文，支持，收藏了。</p>
<p>非常精彩的文章，domain运行机制剖析很明了。domain很美好，但要成长为一个成熟稳定的node模块，还有一段很长的路呢。</p>
<p>顶起.</p>
<p>不错，</p>
<p>好东西 ！～～～～～～～～～～～～</p>
<p>您好，DeNA在招聘资深Node.js的职位，您有兴趣了解一下吗？</p>
<p>可不可以这么说 目前的domain配合最后的退出进程再重启是现行最好的方案？</p>
<p>domain 不能捕获全部异常，还得配合 <code>process.on(&quot;uncaughtException&quot;)</code> 和 优雅退出。</p>
<p> @<a href="/user/suqian">suqian</a> 我很认同你说的话，<code>process.on(&quot;uncaughtException&quot;)</code>在servers中可以进行整个错误的抓包处理，domain我觉得楼主给的方案还不是很成熟，另外在写代码的时候应封装好，对错误做回调处理，如：<br><code>var login = function(fn) { var results = 1 + 2; return fn(err,results);}</code> 调用代码:</p>
<pre class="prettyprint"><code>login(function(err, cookie) {});</code></pre>
<p>之前nodejs官网并未发布异步回调所产生错误的解决方案我想应该是本身nodejs语言所致，所以我觉得能利用本身的语言特点去解决才最好</p>
<p>@<a href="/user/ym1623">ym1623</a> 所有的异步调用的异常，都是通过回调函数的第一个参数返回的。我们需要domain并不是因为想要去代替这种形式。尽管domain的api里面有这样的用法：   </p>
<pre class="prettyprint"><code>var d = domain.create();

function readSomeFile(filename, cb) {
  fs.readFile(filename, &#39;utf8&#39;, d.intercept(function(data) {
    // note, the first argument is never passed to the
    // callback since it is assumed to be the &#39;Error&#39; argument
    // and thus intercepted by the domain.

    // if this throws, it will also be passed to the domain
    // so the error-handling logic can be moved to the &#39;error&#39;
    // event on the domain instead of being repeated throughout
    // the program.
    return cb(null, JSON.parse(data));
  }));
}

d.on(&#39;error&#39;, function(er) {
  // an error occurred somewhere.
  // if we throw it now, it will crash the program
  // with the normal line number and stack message.
});</code></pre>
<p>这可能是node尝试通过domain来统一处理嵌套异步回调中的异常。 但是由于文章中所描述的domain的一些问题，这个暂时还不是很好用。不过异步流程工具已经很多了。只要按照约定，把错误放在callback的第一个参数返回。可以有很多种工具来优化代码。    </p>
<p>我们使用domain的原因，只是为了捕获那些意料之外的错误，例如：  </p>
<pre class="prettyprint"><code>if (!data.length) {
  //do something
}</code></pre>
<p>类似这种不小心出现的错误，如果真的在线上出现了，我们想要把这个错误记录下来以便之后的修改，同时可以给前端一个友好的500响应，而不是只能超时返回（因为用uncaughtException捕捉到的异常，我们也没有办法知道这个异常是在哪个请求出现的）。      </p>
<p>@dead_horse 我一般都是这样做的：process.on(&#39;uncaughtException&#39;, console.dir);直接把错误信息打印在控制台中或者写在日志中</p>
<p>@<a href="/user/ym1623">ym1623</a> 嗯， 为什么我们想要用domain替代这种方案的原因在node<a href="http://www.nodejs.org/api/process.html#process_event_uncaughtexception">文档</a>中提到了。</p>
<blockquote>
<p>Note that uncaughtException is a very crude mechanism for exception handling and may be removed in the future.<br>Don&#39;t use it, use domains instead. If you do use it, restart your application after every unhandled exception!</p>
</blockquote>
<p>所以我们最终在domain有缺陷的情况下，只能使用<a href="https://github.com/TBEDP/show-me-the-code/blob/master/2013/0419/suqian.md">graceful</a>的这个并不完美的解决方案。  </p>
<p>@dead_horse 我觉得还是写测试代码好点，在把项目推上去的时候先运行npm test一次，保证代码质量不出错，node服务抓错防止服务不挂掉也是不错的，但是现在没有一个成熟的方案出来，先写个process.on(&#39;uncaughtException&#39;, console.dir)用着也可以.</p>
<p>@<a href="/user/ym1623">ym1623</a> 那肯定是要自己代码保证不出错啊。domain和uncaoughtException都只是预防意外而已。:)</p>
<p>@dead_horse 我之前无意间用forever watch一个文件作为项目目录时，在出错的时候我将错误log指定到该项目中，这样的话项目一报错的话就会在在该项目下的错误log中写入错误日志，而forever watch此时就起作用了，以为项目有改动自动重启，不知道这个算不算一个取巧.</p>
<p>学习了，支持好文章</p>
<div class="title"><a href="http://cnodejs.org/topic/51deb54bf4963ade0e2b3433" target="_blank">
      fs.write函数参数里面position的作用
    </a>1 小时前</div><p>我写的函数：<br><code>writeToFileFromTop: (src, content)-&gt;
      content = new Buffer content
        fs.open src, &#39;a&#39;, (err, fd)-&gt;
            throw err if err
            position = 0
            fs.write fd, content, 0, content.length, position, (err)-&gt;
                throw err if err
                fs.closeSync fd</code><br>但是无论position设值为多少，他都把内容插入到文件的最后，position好像不起作用，<br>我是想把内容插入到文件的头部，请问应该怎么做？</p>
<pre class="prettyprint"><code>writeToFileFromTop: (src, content)-&gt;
  content = new Buffer content
  fs.open src, &#39;a&#39;, (err, fd)-&gt;
    throw err if err
    position = 0
    fs.write fd, content, 0, content.length, position, (err)-&gt;
      throw err if err
      fs.closeSync fd</code></pre>
<div class="title"><a href="http://cnodejs.org/topic/51de0b30f4963ade0e0986e4" target="_blank">
      fjdsajflksajflkjsfsadf
    </a>1 小时前</div><p>dfdsafjlksafdsaddfsdavxv</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 劣退, 有這功能嗎XD</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd1bd9d44cbfa304338f31" target="_blank">
      Node 中文文档,不可用?
    </a>2 小时前</div><p><a href="http://docs.cnodejs.net/cman/">http://docs.cnodejs.net/cman/</a></p>
<p>404 Not Found : docs.cnodejs.net</p>
<p>这是意外吗?</p>
<p>我刚刚也发现了这问题</p>
<p>老问题.. 一起去 Github 上催一下吧: <a href="https://github.com/cnodejs/nodeclub/issues/191">https://github.com/cnodejs/nodeclub/issues/191</a></p>
<p>这个问题也太久了吧，应该有2个礼拜以上了，我还以为是故意关闭的！</p>
<p>直接看英文的吧,node变化挺快的</p>
<p>看英文吧。。。。没记错的话，中文版是0.6.X的</p>
<div class="title"><a href="http://cnodejs.org/topic/51de8204f4963ade0e25f511" target="_blank">
      有关nodejs-less相关的问题
    </a>5 小时前</div><p>parser.parse(less, function (err, tree) {<br>    //假设less里的变量如 @<a href="/user/color">color</a>:#000</p>
<pre class="prettyprint"><code>//我想操作 让@[color](/user/color)设置成 @[color](/user/color):#fff;
//我在tree里找到有@[color](/user/color)的相关rule，但无从改起，求破，求助攻</code></pre>
<p>});</p>
<div class="title"><a href="http://cnodejs.org/topic/51d9650ad44cbfa304d545f3" target="_blank">
      国内的前端到底有多牛, 而且为啥都没个论坛的?
    </a>1 小时前</div><p>刚才翻到一篇旧文章: <a href="http://hax.iteye.com/blog/1128269">关于国内前端和JS技术发展的乱想</a><br>讲到国内的前端技术能力上和国外的社区相差不多, 甚至很超前<br>文章里提到的一些人物, 我在关心 Node 时逛微博看 JS 的大神有机会看到过一些..<br>想想我还真是边缘啊, 今年也就蹭了几次 Ruby 线下聚会的样子, 前端哪有聚会?<br>文章还提到关于这个原因是前端的社区意识不强, 因而没有怎么怎么...<br>记得去阿里系工作的学长教我 JS 时说国外的 Backbone Bootstrap 什么, 其实他们早实现了</p>
<p>听到以后, 直到现在我也觉得有点不合理..<br>比国外的实现早, 不代表国外只有一种实现, 而且国外光是 Node 就重复造了很多遍轮子<br>中文社区的有做了类似的又怎么样, 哪里证明了更强了?<br>还有社区.. 国外的 JS 也是 JS 呀, 为什么他们有社区我们就没?</p>
<p>求解惑!!!</p>
<p>我知道有个QQ群 <strong>这可谓是国内最强的QQ群之一</strong></p>
<p><a href="http://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html">http://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html</a></p>
<p>自大到这种地步？</p>
<p>既然 QQ 群, 又要审核, 完全没有加入的欲望了<br>QQ 群是无法形成良好的积淀的地方,,<br>就跟写 JS 不用模块化方案分享代码一样, 用一次不开心一次</p>
<p>司徒正美大神的群啊</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a>  前端再推荐一个群吧，w3cplus 主要是UI这部分，偏CSS</p>
<p>@<a href="/user/ldjking">ldjking</a> 有 QQ 有微博有 YY, 还是没有独立论坛哎</p>
<p>@<a href="/user/ldjking">ldjking</a> 只能说玩得还可以，称不上大神吧。</p>
<p>对于技术、语言什么的，感觉国外的人看待它们的思维更开放，对流行趋势把握得很准；相比之下国内开发者思维方式内略有些死，甚至只能跟在别人后面走。所以有些在国外很吃香的东西在国内不是那么受重视，例如JavaScript。。。</p>
<p>let&#39;s join here:  <a href="http://yaha.me/">http://yaha.me/</a><br>build with AngularJS<br>the backend is Nodejs(<a href="http://deployd.com">http://deployd.com</a>) </p>
<p>seems the deployd dev guy also team member of the AngularJS?</p>
<div class="title"><a href="http://cnodejs.org/topic/51de0a33f4963ade0e094fce" target="_blank">
      如何用nodejs模拟get发送消息？小白提问
    </a>5 小时前</div><pre class="prettyprint"><code>http.get(&quot;http://www.google.com/index.html&quot;, function(res) {
  console.log(&quot;Got response: &quot; + res.statusCode);
}).on(&#39;error&#39;, function(e) {
  console.log(&quot;Got error: &quot; + e.message);
});</code></pre>
<p>我在文档上看到的例子。<br>微信平台验证的时候他们会把发一条GET消息，内容大概是</p>
<pre class="prettyprint"><code>/wechat?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264</code></pre>
<p>但是我想自己本地模拟这个get发一下，验证我的服务器写得对不对，但是，不知道第一参数到底要怎么写？<br>比如写成<br>&quot;<a href="http://127.0.0.1:80/wechat/?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264">http://127.0.0.1:80/wechat/?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264</a>&quot;<br>但是好像有点问题。</p>
<p>用requests</p>
<p>@<a href="/user/ggaaooppeenngg">ggaaooppeenngg</a> 你這樣寫是沒錯的, 你說的有點問題是出了什麼問題? 是在parse query string方面嗎?</p>
<p>供你參考:</p>
<p><strong>client.js</strong></p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);

http.get(&quot;http://127.0.0.1:3000/wechat?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=137&quot;, function(res) {
  console.log(&quot;Got response: &quot; + res.statusCode);
}).on(&#39;error&#39;, function(e) {
  console.log(&quot;Got error: &quot; + e.message);
});</code></pre>
<p><strong>server.js</strong></p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);
var url = require(&#39;url&#39;);
var qs = require(&#39;querystring&#39;);

http.createServer(function(req, res) {
    res.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});
    var query = url.parse(req.url).query;
    res.end(JSON.stringify(qs.parse(query)));
}).listen(3000);</code></pre>
<div class="title"><a href="http://cnodejs.org/topic/51de6419f4963ade0e207bff" target="_blank">
      Mongo里面dropDatabase之后怎么数据还在。。。
    </a>5 小时前</div><p>网页查看rows, total_rows 全是空的了。<br>但是mongoskin里面还能读到数据。。。<br>怎么让清空数据立即生效。。。<br>= =！</p>
<div class="title"><a href="http://cnodejs.org/topic/51de195bf4963ade0e0cf46e" target="_blank">
      NAE的文档中心打开失败
    </a>5 小时前</div><p>NAE的 [文档中心]<a href="http://blog.cnodejs.net/post/4e686c290716ac9910000009">http://blog.cnodejs.net/post/4e686c290716ac9910000009</a>)</p>
<div class="title"><a href="http://cnodejs.org/topic/519e01c563e9f8a542fa68f9" target="_blank">
      【一起学node.js】再版啦~
    </a>7-10 13:53</div><p>最近又把教程彻底重写了一遍，内容更加详细，条理更加清晰。已发布到 github ，地址为<br><a href="https://github.com/nswbmw/N-blog"><a href="https://github.com/nswbmw/N-blog">https://github.com/nswbmw/N-blog</a></a></p>
<p>前面的教程现已废弃。</p>
<p>若在学习过程之中遇到错误，给所有读者以下建议：</p>
<p>1.自己通过错误信息分析哪里出错<br>2.对比 github 上的源码找出错误<br>3.清空数据库，重新运行 app.js （这点很重要）<br>4.把错误的代码打包发到 gxqzk@126.com ，我帮你解决问题</p>
<p>学习了，楼主写的很详细些，手把手新手入门啊~</p>
<p>@<a href="/user/snoopy">snoopy</a> 能不能讲讲mongoose 啊！！</p>
<p>不用mongoose的啊~</p>
<p> @<a href="/user/snoopy">snoopy</a> -orz<br>那您推荐一个吧</p>
<p>小哥，出来混要打扮下的——css用twitter bootstrap；这样才能吸引妹子啊</p>
<p>这里能有几个妹子啊 = =</p>
<p> @<a href="/user/nswbmw">nswbmw</a> 他就是妹子！</p>
<p>很详细，加油！</p>
<p>不错，置顶！</p>
<p>我擦，吃晚饭，刷一下，变样子了~</p>
<p> @<a href="/user/snoopy">snoopy</a> 哈哈，先上线让大家吐槽吐槽。</p>
<p>支持！！！</p>
<p>求mongoose教程</p>
<p>去看我之前翻译的文档，绝大部分查看api就可以使用了</p>
<p> @<a href="/user/a272121742">a272121742</a> 看完了，真心不错，谢了。不过因为网站模版改了，教程排版比较乱，看着有点吃力</p>
<p>顶一个, 很有奉献精神</p>
<p>必须支持，给我们新手来说帮助太大了，呵呵。</p>
<p>改版后没有什么层次感了！</p>
<p>一阵新鲜感哈</p>
<p>楼主很给力啊，辛苦了</p>
<p>就是要多点热爱分享的人，新手表示感谢</p>
<p>那个在安装flash 模块的时候，是在app.js中修改代码，不是在index.js中修改代码吧？</p>
<p>嗯，多谢指正，笔误。。。</p>
<p>感谢楼主奉献<br>我是Linux下,做到mongodb那里总是报错,说是连接不上数据库<br>&#39;throw new Error(&#39;Error connecting to database&#39;);&#39;<br>上面的是抛错,mongod是需要额外启动的么?</p>
<p>对，每一次都是先启动 mongod ，后启动 app。</p>
<p>可以把mongodb添加到开机启动脚本</p>
<p>@<a href="/user/nswbmw">nswbmw</a> 感谢,过这么久才来看,已经OK</p>
<p>@<a href="/user/soufii">soufii</a> 同样感谢~</p>
<p>good！</p>
<p>又可以省些时间自己写了哈···</p>
<p>怎么就没得人用MySQL咧</p>
<p>怎么不用pgsql。。  有node.JS jade教程么？</p>
<p>受益了，支持楼主，顶上~~</p>
<p>好文章啊，传说中的深入浅出～～</p>
<p>多谢啊！！！！！</p>
<p>楼主能不能完善下以auth方式启动的mongodb与connect-mongo的连接该如何配置用户名和密码啊。我照着你的系列搞，我的mongodb是以auth方式启动的，所以连接被拒绝，如果能把这完善下就完美了，本人能力有限，捣鼓半天也折腾不出来，期待楼主佳音</p>
<p>connect-mongo的说明里写了username和password其实是可选选项，加入到连接代码中即可。<br><a href="https://npmjs.org/package/connect-mongo">https://npmjs.org/package/connect-mongo</a><br>很多事情其实官方的文件都有说的，多看文档可以节约很多时间</p>
<p>后来又看了下，发现了点问题<br>node.js的创建数据库连接传递的参数没有用户名和密码（大部分地方都没写）<br>我还在查阅资料，看看格式具体是什么</p>
<p>后来重新看了遍文章，连接其实都是由mongodb这个package弄得，connect-mongodb是用来保存回话信息的。。<br>请在app.js的store: new MongoStore({下增加username和password来保证connect-mongodb的正常使用<br>mongodb的文档我还在翻阅，希望能找到方法</p>
<p>翻着url连接偶然想起一个方法<br>在setting.js的host的localhost前面加&quot;用户名:密码@&quot;（不要引号）就可以了<br>其实和url建立连接的原理相同<br>app.js的那个username必须是在指定数据库创建的，admin创建的全局用户不行</p>
<p>楼主，第四章的时候为什么我的评论写不到数据库中，评论的form是提交到post,但是index.js中的post是：<br> app.post(&#39;/post&#39;, checkLogin);<br>  app.post(&#39;/post&#39;,function(req,res){<br>        var currentUser = req.session.user,<br>      post = new Post(currentUser.name, req.body.title, req.body.post);<br>      post.save(function(err){<br>        if(err){<br>          req.flash(&#39;error&#39;, err);<br>          return res.redirect(&#39;/&#39;);<br>        }<br>        req.flash(&#39;success&#39;, &#39;发布成功!&#39;);<br>        res.redirect(&#39;/&#39;);<br>      });<br>  });<br>  并没有有关处理comment的内容啊？请问评论的内容是如果写入到数据库中的？？<br>  期待楼主指教，</p>
<p>咦？你的 comment.js 呢？ <code>app.post(&#39;/u/:name/:day/:title&#39;)</code> 是处理留言的。</p>
<p>不好意思贴错了：<br>app.post(&#39;/u/:name/:day/:title&#39;, function(req,res){<br>    var date = new Date(),<br>        time = date.getFullYear() + &quot;-&quot; + (date.getMonth()+1) + &quot;-&quot; + date.getDate() + &quot; &quot; + date.getHours() + &quot;:&quot; + date.getMinutes(),<br>        comment = {&quot;name&quot;:req.body.name, &quot;email&quot;:req.body.email, &quot;website&quot;:req.body.website, &quot;time&quot;:time, &quot;content&quot;:req.body.content};<br>    var newComment = new Comment(req.params.name, req.params.day, req.params.title, comment);<br>    newComment.save(function(err){<br>      if(err){<br>        req.flash(&#39;error&#39;,err);<br>        return res.redirect(&#39;/&#39;);<br>      }<br>      req.flash(&#39;success&#39;, &#39;留言成功!&#39;);<br>      res.redirect(&#39;back&#39;);<br>    });<br>  });</p>
<p>  comment.js是有的，留言的时候也提示留言成功了，也没有报错，</p>
<p>留言成功了，显示不了留言还是怎么？</p>
<p>显示留言成功了，但是我到数据库中查询的结果是：</p>
<blockquote>
<p>db.posts.find();<br>{ &quot;name&quot; : &quot;Dn9x&quot;, &quot;time&quot; : { &quot;date&quot; : ISODate(&quot;2013-06-01T07:29:48.298Z&quot;), &quot;yea<br>r&quot; : 2013, &quot;month&quot; : &quot;2013-6&quot;, &quot;day&quot; : &quot;2013-6-1&quot;, &quot;minute&quot; : &quot;2013-6-1 15:29&quot; }<br>, &quot;title&quot; : &quot;this is First&quot;, &quot;post&quot; : &quot;this is my First,\r\nI real happy!&quot;, &quot;com<br>ments&quot; : [ ], &quot;_id&quot; : ObjectId(&quot;51a9a2ec425e47c816000002&quot;) }<br>{ &quot;name&quot; : &quot;Dn9x&quot;, &quot;time&quot; : { &quot;date&quot; : ISODate(&quot;2013-06-01T07:30:30.592Z&quot;), &quot;yea<br>r&quot; : 2013, &quot;month&quot; : &quot;2013-6&quot;, &quot;day&quot; : &quot;2013-6-1&quot;, &quot;minute&quot; : &quot;2013-6-1 15:30&quot; }<br>, &quot;title&quot; : &quot;CSS: generated content 1&quot;, &quot;post&quot; : &quot;this is about css and Hmtl???\<br>r\ni like css  and html\r\n<em>this is good</em>&quot;, &quot;comments&quot; : [ ], &quot;_id&quot; : ObjectId(&quot;<br>51a9a316425e47c816000003&quot;) }</p>
</blockquote>
<p>所以就没有留言显示，但是保存的时候却提示留言成功！</p>
<p>贴出你的 comment.ejs 和 comment.js 我看看</p>
<p><a href="https://github.com/nswbmw/N-blog/wiki/%E7%AC%AC%E5%9B%9B%E7%AB%A0--%E5%AE%9E%E7%8E%B0%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD">https://github.com/nswbmw/N-blog/wiki/%E7%AC%AC%E5%9B%9B%E7%AB%A0--%E5%AE%9E%E7%8E%B0%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD</a></p>
<p>楼主，我刚才是直接复制的你这一章的comment.js和comment.ejs的代码，上面的步骤我也是照着来的，</p>
<p>这个是comment.js</p>
<p>var mongodb = require(&#39;./db&#39;);</p>
<p>function Comment(name, day, title, comment) {<br>  this.name = name;<br>  this.day = day;<br>  this.title = title;<br>  this.comment = comment;<br>}</p>
<p>module.exports = Comment;</p>
<p>Comment.prototype.save = function(callback) {<br>  var name = this.name,<br>      day = this.day,<br>      title = this.title,<br>      comment = this.comment;<br>  mongodb.open(function (err, db) {<br>    if (err) {<br>      return callback(err);<br>    }<br>    db.collection(&#39;posts&#39;, function (err, collection) {<br>      if (err) {<br>        mongodb.close();<br>        return callback(err);<br>      }<br>      //通过用户名、发表日期及标题查找文档，并把一条留言添加到该文档的 comments 数组里<br>      collection.findAndModify({&quot;name&quot;:name,&quot;time.day&quot;:day,&quot;title&quot;:title}<br>      , &#39;time&#39;,-1<br>      , {$push:{&quot;comments&quot;:comment}}<br>      , {new: true}<br>      , function (err,comment) {<br>          mongodb.close();<br>          callback(null);<br>      });<br>    });<br>  });<br>};</p>
<p>@<a href="/user/xiuxu123">xiuxu123</a> 把你错误的代码打包发到 gxqzk@126.com 我看看哪里出问题了</p>
<p>@<a href="/user/nswbmw">nswbmw</a> 谢谢你了，我直接下载您的源码然后运行，我就直接看你的源码了，其实我主要是想使用MySql,不过也已经可以了，谢谢您了，以后还请多多指教</p>
<p>第四章我出了一个错误是</p>
<pre class="prettyprint"><code>doc.comments.forEach(function(comment){
  comment.content = markdown.toHTML(comment.content);
});</code></pre>
<p>说这个doc.comments是undefined，找了一天没找到原因，求助</p>
<div class="title"><a href="http://cnodejs.org/topic/51de26e9f4963ade0e0fa06d" target="_blank">
      安装了node最新版，npm出错，什么情况
    </a>5 小时前</div><p>安装了node最新版本，10.13，但是在npm的时候出错</p>
<p>Cannot find module &#39;delayed-stream&#39;</p>
<p>什么情况</p>
<div class="title"><a href="http://cnodejs.org/topic/51de5f52f4963ade0e1fd645" target="_blank">
      求解： 包含数组的数据发送到Node服务端后，左中括号被转换的问题
    </a>5 小时前</div><p>在前端， 数据被JSON.stringift 用POST方式发送到node服务端，本来是‘[’符号 被转换成了 &#39;: { &#39;</p>
<p>而为什么要用JSON.stringift，是因为公司的插件的原因。 所以在这里请教这是怎么回事，以及如何破解之妙方！</p>
<p>竟然有此等转换！谁干的！</p>
<div class="title"><a href="http://cnodejs.org/topic/51de1f23f4963ade0e0e42db" target="_blank">
      node.js运行appJS出错，弹出窗提示C++错误
    </a>5 小时前</div><p>如题：<br><img src="http://static.oschina.net/uploads/space/2013/0106/100852_fdmR_143411.png" alt="图"></p>
<p>直接执行APP.exe是可以运行，但是node --harmony app.js跑不起，直接报错了</p>
<p>环境：win7 32bit   node:0.8.18</p>
<p>assertion failed!<br>file: libcef_dll\wrapper\libcef_dll_wrapper.cc</p>
<p>for information on how your program can cause an assertion failure, see the visual c++ documentation on asserts</p>
<div class="title"><a href="http://cnodejs.org/topic/5033ab60f767cc9a51ad9bc1" target="_blank">
      AppFog拎包入住指南
    </a>5 小时前</div><p>你也可以在<a href="http://www.imjustfly.net">我的博客</a>阅读这片文章</p>
<p><strong>AppFog</strong>是国外的一个免费应用引擎，类似于SAE、GAE和NAE。它支持Java, Python, Node, .Net, Ruby, PHP, MySQL, Mongo, PostgreSQL等平台和数据库，几乎覆盖主流web开发平台，而且<a href="https://console.appfog.com/pricing">免费套餐诱人</a>，部署方便，所以吸引的不少人的目光，尤其是像我这样没钱的学生党。缺点，服务器在国外（最近的也在新加坡），延迟肯定是有的，<strong>另外</strong>，说不定某天就被长城给over掉了。</p>
<p>苦于没有NAE邀请码，博客暂时部署在appfog上，部署过程还算简单，这里以Linux Ubuntu+nodejs部署为例，简单介绍一下。</p>
<h4>Step1.<a href="https://console.appfog.com/signup">注册</a>服务。</h4>
<p>好吧，我知道你肯定会，就当我说废话。。。</p>
<h4>Step2.创建一个APP</h4>
<p>当你注册完成后，进入<a href="https://console.appfog.com/">https://console.appfog.com/</a> ,点击New App，你可以看到app创建分三歩走：</p>
<p>第一步，选择一类应用，我们看到有三种支持的nodejs应用，nodejs，node chat node express，不管你是否使用了node express，<strong>选第一个nodejs都可以</strong>，关键是你在上传代码时加上所有你依赖的库，也就是node moudles那个文件夹放到代码跟目录即可。</p>
<p>第二步，选择一个服务器，随便你了，要说里你最近的就是新加坡的那个，使用的是亚马逊的云存储服务。</p>
<p>第三步，输入你的app子域名，也就是你给你的app起的名称。</p>
<p>之后，点击Create App，你会看到一个进度列表，当你看到‘done’后，你的应用就创建完毕了，简单吧。接下来，你将进入配置界面。</p>
<h4>Step3.App配置</h4>
<p>一个dashboard呈现在你面前：<br><img src="http://ww1.sinaimg.cn/large/a74ecc4cjw1dw4isb7yufj.jpg" alt="dashboard"></p>
<p>看上去够简单吧，介绍下，Instances顾名思义，启动实例数目，memeory quota是内存分配，你有2G的内存，你自己根据应用大小决定分配给他多少内存。调整完后记得点击一下右下角蓝色的Update！显示Done之后就修改完成了。</p>
<h4>Step4.创建数据服务</h4>
<p>很大一部分的web应用还是需要数据库的，appfog提供了三种数据引擎，mongodb，postgresql，mysql。点击左侧边栏Services，选择一种数据服务，在下面输入名字，创建就好。<br><img src="http://ww2.sinaimg.cn/large/a74ecc4cjw1dw4j4exjt5j.jpg" alt="数据服务"><br><strong>注意</strong>，还没有完，你需要将创建的服务和应用绑定(Bind)才能使用，不过你稍等片刻，他会自动给你绑定上。</p>
<h4>Step5.修改代码并上传</h4>
<p>修改代码重要的是你的数据库连接的代码，上面创建服务的页面有三种语言的连接实例，但是貌似打不开，nodejs可以使用下面代码：</p>
<pre class="prettyprint"><code>if(process.env.VCAP_SERVICES){
var env = JSON.parse(process.env.VCAP_SERVICES);
var mongo = env[&#39;mongodb-1.8&#39;][0][&#39;credentials&#39;];
}
else{
    var mongo = {
    &quot;hostname&quot;:&quot;localhost&quot;,
    &quot;port&quot;:27017,
    &quot;username&quot;:&quot;你的用户名&quot;,
    &quot;password&quot;:&quot;你的密码&quot;,
    &quot;name&quot;:&quot;你的应用名&quot;,
    &quot;db&quot;:&quot;db&quot;
    }
}
var generate_mongo_url = function(obj){
    obj.hostname = (obj.hostname || &#39;localhost&#39;);
    obj.port = (obj.port || 27017);
    obj.db = (obj.db || &#39;test&#39;);
    if(obj.username &amp;&amp; obj.password){
        return &quot;mongodb://&quot; + obj.username + &quot;:&quot; + obj.password + &quot;@&quot; + obj.hostname + &quot;:&quot; + obj.port + &quot;/&quot; + obj.db;
    }
    else{
        return &quot;mongodb://&quot; + obj.hostname + &quot;:&quot; + obj.port + &quot;/&quot; + obj.db;
    }
}
var mongourl = generate_mongo_url(mongo);</code></pre>
<p>把mongourl赋值给你的数据库连接字符串就好了。</p>
<p>ps:我一开始忘记设置数据库连接，仍然保持开发时候的127.0.0.1配置应用也能正常运行，奇怪，后来改过来了。</p>
<p>上传代码你需要ruby gem 和gem下的af。ubuntu下，</p>
<pre class="prettyprint"><code>sudo apt-get install ruby1.9.1 ruby1.9.1-dev gem
gem install af
cd ‘你的应用目录’
af login（之后输入你的邮箱和密码）
af update ‘你的应用名’</code></pre>
<p>等待，一连串的ok后完成，回到dashboard点击右边Visit Live Site，看看是不是已经运行了？</p>
<p>ps：之前的Step2可以在代码根目录用af命令：af push来实现，过程就是做几个选择题和填空题。<br>pps：你需要将所有的依赖库node_moudles保留在根目录，肯定有人想用package.json让服务器自己npm install，这种方法当然可以，你需要npm shrinkwrap，具体方法在<a href="http://docs.appfog.com/frameworks/node">这里</a>，但不如直接上传来的直接，而且免除莫名其妙的问题。</p>
<h4>Step6.绑定域名</h4>
<p>你已经有了一个appfog提供的域名，但如果你想使用自己的域名怎么办？appfog使用cname的方法绑定域名（如果你不知道cname是神马东东，google之）。具体操作：</p>
<p>点击做侧边栏Domain Names，在空白框内写入你的域名，update。然后去你的域名服务商那里设置解析方式cname，地址为红色的cname01开头的网址，appfog会自动根据你添加的域名进行定向，然后等待所有dns同步好你的信息，你就能访问了。</p>
<p>ok，6步，不出什么差错的话部署应该胜利完成了。</p>
<p>关于CLI控制appfog，看这里，<a href="http://docs.appfog.com/getting-started/af-cli">http://docs.appfog.com/getting-started/af-cli</a><br>进阶请随时保持对文档的关注，但需要你一定的英文阅读的能力。</p>
<p>还有：<strong>求NAE邀请码。。。。</strong></p>
<p>顶LZ了，这个托管引擎做得蛮人性化的，不过国外的云服务访问速度终究是硬伤呐</p>
<p>前几个刚注册了。<br>话说，nae不稳定。。</p>
<p>这个很不错的样子。就是数据库太小了。每个限制100M</p>
<p>只要一登陆就500<img src="/upload/4efc278625fa69ac6900043c/1345608207045_pic.JPG" alt="enter image description here"></p>
<p>这个嘛，我就遇到过一次，而且刷新几下就好了</p>
<p>试过，这个其实比NAE还不稳定~~</p>
<p>真的吗，如此这般更加坚定我转移到nae的决心。继续求码</p>
<p>NAE不知道是否我RP问题... 至今未能稳定部署一个应用... 只有很早前的一个应用. 后续上传的都报什么make dir.</p>
<p>ps: NAE能否用express3和Socket.io?</p>
<p>国内都需要备案，国外速度又有点问题，还随时有可能被墙</p>
<p>您好，我在windows 下用af ，会出错<img src="/upload/5025513af767cc9a51130f0f/1346090426330_%E6%9C%AA%E5%91%BD%E5%90%8D12.jpg" alt="enter image description here"></p>
<p>请问下af 这里的操作是如何的，我要如何将我的代码弄上appfog呢</p>
<p>我只能告诉你，多尝试几次吧！<br>我的windows 8下面会报一个编码错误，<br>现在在家都是在虚拟机中的win7 update的，<br>这个确实有时候喜欢抽风的乱报错！</p>
<p>国内链接不上啊，难道又被伟大的GFW给封啦？</p>
<p>因为工作的原因好久没来了，这个绝对要顶的。</p>
<p><strong>收藏了</strong><br>正好需要这个测试</p>
<p>这个不能用socket.io啊</p>
<p>很不错，appfog给新手做部署练习</p>
<p>怎么上传没看懂</p>
<h2>遇到个问题，请教下</h2>
<blockquote>
<p>我用的是express来开发，本地开发的时候一切正常。<br>   当登陆admin后进行的一系列操作都要先验证session，如果session失效会跳转到login<br>   本地开发是一切正常，session可以用，当我配置到appfog后发现很经常出现session无效的情况<br>   就连登陆也经常无法登陆，一般点几次才能登陆，登陆后进行操作又会跳回login页。又看不到控制台的信息，纠结ing啊~~~~</p>
</blockquote>
<p>试试用一个 instance 跑，而不是多个</p>
<div class="title"><a href="http://cnodejs.org/topic/51db6871d44cbfa3040397e8" target="_blank">
      有大连的软件公司用 nodejs 的吗？
    </a>7 小时前</div><p>调查一下，看看大连的 node 环境怎么样。</p>
<p>有在用</p>
<p>大连的公司不错嘛。握个手。</p>
<p>内部用，还是给客户用？</p>
<div class="title"><a href="http://cnodejs.org/topic/500bcd604764b72902ed495a" target="_blank">
      Nodeclipse -- Node的Eclipse插件
    </a>6 小时前</div><p>Nodeclipse是一个Eclipse插件，想让习惯Eclipse的童鞋更方便的在Eclipse下开发Node.<br>这是一个业余项目，开发很慢，但是会一直进行。如果您是RCP高手，期待您的帮助和加入。</p>
<p>目前支持新建Node项目和Node源文件，代码高亮，代码提示，NPM操作支持等。</p>
<p>可以通过下面的地址在线安装。<br>Update Site : <a href="http://www.nodeclipse.org/updates">http://www.nodeclipse.org/updates</a></p>
<p>代码托管在Github。<br>项目地址：<a href="https://github.com/lambgao/nodeclipse">https://github.com/lambgao/nodeclipse</a></p>
<p>我发布这个项目是因为开发中碰到了困难，我不擅长RCP的开发，开发是处于摸索状态。如果您是RCP高手又非常愿意花费时间来参与那么可以和我联系。可以站内留言，或者Github上面，或者dev@nodeclipse.org，或者 <a href="http://weibo.com/lambsand">@金氧</a>，或者你还用什么沟通方式你希望我提供的都可以给你。</p>
<p>你需要哪方面的帮助？</p>
<p>如何继承已有的jsdt的js编辑器，本来有的那些功能代码格式化 语法检查的功能我不想再开发了。</p>
<p> @<a href="/user/jin52yang">jin52yang</a> 我明天在回顾一下jsdt。为什么不在jsdt上附加扩展而是自己做一个编辑器呢？</p>
<p> @<a href="/user/saighost">saighost</a> 我是想扩展，不知道咋扩展。暂时现在新整了一个编辑器.你可否加我一下qq61357158?</p>
<div class="title"><a href="http://cnodejs.org/topic/51c50a4d73c638f3707216a8" target="_blank">
      浏览器端 JS 装逼资源
    </a>6 小时前</div><p>JS 是一门 Scheme 方言<br><a href="http://javascript.crockford.com/little.html">http://javascript.crockford.com/little.html</a></p>
<p>各种语言编译到 JS<br><a href="https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS">https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS</a><br>C++ 有没有<br><a href="https://github.com/kripken/emscripten/wiki">https://github.com/kripken/emscripten/wiki</a><br>LLVM 有没有<br><a href="http://kripken.github.io/llvm.js/demo.html">http://kripken.github.io/llvm.js/demo.html</a><br>还可以编译到 JS 哦<br><a href="https://github.com/mishoo/UglifyJS2">https://github.com/mishoo/UglifyJS2</a><br>用来写 JS 的解释器<br><a href="https://github.com/jterrace/js.js/">https://github.com/jterrace/js.js/</a><br>用来跑 Scala 和 Java<br><a href="http://www.infoq.com/news/2013/06/scalajs">http://www.infoq.com/news/2013/06/scalajs</a><br><a href="http://int3.github.io/doppio/about.html">http://int3.github.io/doppio/about.html</a></p>
<p>JS 被用来写 Linux 内核<br><a href="http://bellard.org/jslinux/tech.html">http://bellard.org/jslinux/tech.html</a><br>用来个机器人编程<br><a href="http://robotics.stackexchange.com/questions/287/programming-robots-with-javascript">http://robotics.stackexchange.com/questions/287/programming-robots-with-javascript</a><br><a href="http://baalexander.github.io/rosnodejs/">http://baalexander.github.io/rosnodejs/</a></p>
<p>Github 第一大语言, CoffeeScript 第十哦<br><a href="https://github.com/languages">https://github.com/languages</a></p>
<p>JS 图形的功能就像未来的工具穿越到了现在<br><a href="http://acko.net/">http://acko.net/</a><br><a href="http://threejs.org/">http://threejs.org/</a></p>
<p>JS 能直接上数据酷和桌面应用, 以及 Web 服务器<br><a href="http://docs.mongodb.org/ecosystem/drivers/javascript/">http://docs.mongodb.org/ecosystem/drivers/javascript/</a><br><a href="http://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx">http://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx</a><br><a href="https://live.gnome.org/Gjs">https://live.gnome.org/Gjs</a><br><a href="https://nodejsmodules.org/">https://nodejsmodules.org/</a></p>
<p>丰富的社区资源<br><a href="http://dailyjs.com/">http://dailyjs.com/</a><br><a href="https://plus.google.com/communities/100875929141897651837">https://plus.google.com/communities/100875929141897651837</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">https://developer.mozilla.org/en-US/docs/Web/JavaScript</a><br><a href="https://developer.chrome.com/extensions/api_index.html">https://developer.chrome.com/extensions/api_index.html</a><br><a href="http://nodejs.org/api/index.html">http://nodejs.org/api/index.html</a></p>
<p>JS 有先进的调试工具<br><a href="http://www.youtube.com/watch?v=bqfoYaKCYUI&amp;feature=player_embedded">http://www.youtube.com/watch?v=bqfoYaKCYUI&amp;feature=player_embedded</a><br><a href="https://developers.google.com/chrome-developer-tools/">https://developers.google.com/chrome-developer-tools/</a></p>
<p>很多的模块化方案<br><a href="http://wibblycode.wordpress.com/2013/01/01/the-state-of-javascript-package-management/comment-page-1/">http://wibblycode.wordpress.com/2013/01/01/the-state-of-javascript-package-management/comment-page-1/</a><br><a href="http://tagneto.blogspot.com/2012/01/simplicity-and-javascript-modules.html">http://tagneto.blogspot.com/2012/01/simplicity-and-javascript-modules.html</a></p>
<p>速度也算快<br><a href="http://arstechnica.com/information-technology/2013/05/native-level-performance-on-the-web-a-brief-examination-of-asm-js/">http://arstechnica.com/information-technology/2013/05/native-level-performance-on-the-web-a-brief-examination-of-asm-js/</a></p>
<p>JS 实现的 OT 和 Git<br><a href="http://sharejs.org/">http://sharejs.org/</a><br><a href="https://github.com/creationix/js-git">https://github.com/creationix/js-git</a></p>
<p>Ruby Python 社区的同学各种讨论 JS<br><a href="http://ruby-china.org/topics/node5">http://ruby-china.org/topics/node5</a><br><a href="http://python-china.org/node/javascript">http://python-china.org/node/javascript</a><br>Haskell 方言想要取代 JS 没有成功<br><a href="http://elm-lang.org/">http://elm-lang.org/</a></p>
<p>JS 有各种大公司的实现<br><a href="http://en.wikipedia.org/wiki/List_of_ECMAScript_engines">http://en.wikipedia.org/wiki/List_of_ECMAScript_engines</a></p>
<p>CoffeeScript 可以用了写 JS, JS 可以用来写 CoffeeScript<br><a href="http://js2coffee.org/">http://js2coffee.org/</a><br>JS 被用来写幻灯片, 幻灯片可以用来写 JS<br><a href="https://brendaneich.com/presentations/">https://brendaneich.com/presentations/</a></p>
<p>JS 是一种数据结构<br><a href="http://en.wikipedia.org/wiki/JSON">http://en.wikipedia.org/wiki/JSON</a></p>
<p>很多人对 JS 的记忆刻骨铭心<br><a href="http://bonsaiden.github.io/JavaScript-Garden/">http://bonsaiden.github.io/JavaScript-Garden/</a><br><a href="http://wtfjs.com/">http://wtfjs.com/</a></p>
<p>JS 可以用了模拟设计模式<br><a href="http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/">http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/</a><br>JS 是函数式的语言<br><a href="http://www.ibm.com/developerworks/library/wa-javascript/index.html">http://www.ibm.com/developerworks/library/wa-javascript/index.html</a></p>
<p><strong>很多人对 JS 的记忆刻骨铭心</strong></p>
<p>js 各种神奇的问题...呵呵</p>
<p>内容很丰富，支持一下</p>
<p>顶一个</p>
<p>mark，有时间看一边学一下</p>
<p>mark，有时间看一边学一下</p>
<p>mark，有时间看一边学一下</p>
<p>可惜大部分都是英文的  英文看不懂 伤不起啊</p>
<div class="title"><a href="http://cnodejs.org/topic/513ca7e7df9e9fcc58c36e17" target="_blank">
      【云里来软件 北京招聘】JavaScript(Node.js) 开发工程师（全职-可soho/实习）
    </a>5 小时前</div><p>【招聘职位】<br>JavaScript  (Node.js)  开发工程师 --可接受soho工作</p>
<p>【招聘要求】<br>1. 精通  JavaScript(jQuery、Backbone.js等) + css + div 开发, 精通node.js开发<br>2. 有良好的编程习惯和素养<br>3. 具备较强地沟通协作能力，善于学习，有较强地分析解决问题的能力<br>4. 对新技术的发展趋势保持关注，能不断学习最新技术，爱好创新<br>5. 有很好的英语读写能力</p>
<p>【招聘说明】<br>1. 全职、实习均可;<br>2. 实习一周最好有4天坐班时间，周末也可；<br>3. 要求踏实负责任。  </p>
<p>【薪水福利】<br>1. 全职月薪 8k - 16k，实习 200-400元/天；<br>2. 全职五险一金齐全；<br>3. 享受每月的午餐补助；<br>4. 我们非常欢迎实习生能够留下作为长期员工，届时薪水再议。  </p>
<p>如果您对我们的招聘感兴趣，欢迎将个人简历发信到 business(at)cloud603.com </p>
<p>联系我们：<br>北京云里来软件有限公司<br>email: business(at)cloud603.com </p>
<p>【北京云里来软件有限公司 简介】<br>北京云里来软件有限公司秉承“为企业信息化服务”的宗旨，立足于软件的开发、研制、技术服务，以最成熟的技术、最有效的经验和最务实的态度为客户提供最适用的解决方案，致力于内容管理、企业及政府信息化、电子商务、商业智能等软件研发及销售的一家新兴软件技术企业，秉持科技立身，创新为命的发展理念， 辅助客户预见不断变化的市场，提高用户的市场竞争能力，是云里来软件公司立足市场的根本。</p>
<p>欢迎大家投递简历啊！</p>
<p>公司在哪里，最近要换工作，挺看好这个职位</p>
<p> @<a href="/user/TearY">TearY</a> 是在北京，地铁5号线沿线， 你在做什么开发哦？ 有意向的话请发份简历吧。</p>
<p> @<a href="/user/haohello">haohello</a> 做.net，更详细的是html+css+ js+asp.net mvc,写了比较长时间js，有nodejs经验，主要想找js方面的工作</p>
<p> @<a href="/user/TearY">TearY</a> 你可以给我们发份简历哦。</p>
<p> @<a href="/user/haohello">haohello</a> 公司在天通苑啊，挺远的</p>
<p>有木有高手在这儿呢？</p>
<p>给你们发了一个邮件，咨询是否接受SOHO，但你们没回我，难道是被扔到垃圾邮箱去了？</p>
<p> @<a href="/user/conis">conis</a>  一会儿去查收一下哦，现在求贤若渴，如果合适的话，我们也愿意这种合作方式。</p>
<p> @<a href="/user/haohello">haohello</a> 好，方便的话，到时候给我回个邮件</p>
<p>有没有可以业余时间做的活呢？</p>
<p> @<a href="/user/firstgeniusboy">firstgeniusboy</a> 哦，这个木有哦</p>
<p> @<a href="/user/haohello">haohello</a> 我最近也在学Nodejs 也在考虑这方面的工作，有空聊聊吧。firstgeniusboy@163.com 我的邮箱，方便的话可以把qq发给我，简历忙过了这阵再发给你。</p>
<p> @<a href="/user/firstgeniusboy">firstgeniusboy</a> 嗯，好的。</p>
<p>官网发一个上来</p>
<p>官网在哪儿呢？</p>
<p>围观下。。。 cloud603.com 应该是官网吧 </p>
<p>嗯，是哦，是去年做的官网</p>
<p>只在北京工作吗？</p>
<p>对啊，我们都在北京办公的。</p>
<p>这种开发模式应该是前台后台分离，看了一下官网介绍，用的全是最前沿的技术，无论是webapp还是mobile app, 因此我很感兴趣</p>
<p>兄弟，可否发份简历过来呢。</p>
<p>还没见你的回复啊。</p>
<p> @<a href="/user/haohello">haohello</a> 已经发送了，具体可以和我qq联系</p>
<p> @<a href="/user/ym1623">ym1623</a> 哦，要不你私信告诉我你的名字和qq吧</p>
<p>北京很远</p>
<p>你在什么地方啊？</p>
<p> @<a href="/user/haohello">haohello</a> 广州</p>
<p> @<a href="/user/leizongmin">leizongmin</a> 你的node.js水平怎么样啊</p>
<p> @<a href="/user/haohello">haohello</a> 还可以吧 <a href="http://ucdok.com/">http://ucdok.com/</a></p>
<p> @<a href="/user/leizongmin">leizongmin</a> 老雷谦逊。</p>
<p> @<a href="/user/leizongmin">leizongmin</a>  你有没有QQ啥的？ 我加一下你吧，可以多向你请教问题。</p>
<p> @<a href="/user/yansong">yansong</a> 确实谦虚哦</p>
<p> @<a href="/user/haohello">haohello</a> 402450329</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd2e42d44cbfa30436a2a4" target="_blank">
      nodeclub 没有上传图片的功能？在线等待
    </a>9 小时前</div><p>最新版本的，在线等待</p>
<p>曾经有, broken 了: <a href="https://github.com/cnodejs/nodeclub/issues/143">https://github.com/cnodejs/nodeclub/issues/143</a></p>
<p>以前一直都有..后来某天就死了...<br>图片上传用这个..<br><a href="http://upload.cnodejs.net/">http://upload.cnodejs.net/</a></p>
<p>谢谢</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd27b3d44cbfa30435926c" target="_blank">
      Git 新手使用必看教程
    </a>10 小时前</div><p>对于我来说，使用git真的是走了不少弯路，目测弯路的代价达到了10个小时，</p><br><p>只是一个工具而已，花这么长时间几乎快把我的耐心用完了。</p><br><p>为了能让大家少走弯路，不走弯路，我觉得有必要把我的心酸历程写下来。</p><br><p>今天下班来不及了，明天来继续写。</p>




<p>坐等，呵呵</p>
<p>虽然这么说.. Git 教程已经太多了. 而且如果是教程, 我觉得翻译更靠谱<br>目前其他能替代 Git 的工具都不如 Git 广泛和好用, 还是花点时间学吧</p>
<p>坐等更新学习啊~</p>
<p>围观</p>
<p>公司里面现在都是使用SVN，<br><a href="http://121.199.33.218/bzm/Home/Detail/96"><a href="http://121.199.33.218/bzm/Home/Detail/96">http://121.199.33.218/bzm/Home/Detail/96</a></a><br>这个是我昨天写的，也发出来大家看看</p>
<p><a href="http://gitbook.liuhui998.com/">http://gitbook.liuhui998.com/</a></p>
<div class="title"><a href="http://cnodejs.org/topic/51c1205057628b975f1d4da9" target="_blank">
      NAE邀请码发送....
    </a>9 小时前</div><p>使用的请注明使用了哪个,注册成功后可以继续邀请其他人.<br><a href="http://cnodejs.net/regist?code=Kc335g64riB">http://cnodejs.net/regist?code=Kc335g64riB</a><br><a href="http://cnodejs.net/regist?code=kPxF5KotMQE">http://cnodejs.net/regist?code=kPxF5KotMQE</a><br><a href="http://cnodejs.net/regist?code=qdMSozptUrO">http://cnodejs.net/regist?code=qdMSozptUrO</a><br><a href="http://cnodejs.net/regist?code=ByVWRALAKxx">http://cnodejs.net/regist?code=ByVWRALAKxx</a><br><a href="http://cnodejs.net/regist?code=PQfJjQoDaT9">http://cnodejs.net/regist?code=PQfJjQoDaT9</a></p>
<p><a href="http://cnodejs.net/regist?code=CP0KN5ubIGF">http://cnodejs.net/regist?code=CP0KN5ubIGF</a><br><a href="http://cnodejs.net/regist?code=4BdvcdoRqCi">http://cnodejs.net/regist?code=4BdvcdoRqCi</a><br><a href="http://cnodejs.net/regist?code=cJmxNAjui71">http://cnodejs.net/regist?code=cJmxNAjui71</a><br><a href="http://cnodejs.net/regist?code=p0aBo0TbI2V">http://cnodejs.net/regist?code=p0aBo0TbI2V</a><br><a href="http://cnodejs.net/regist?code=FqIz9Y9Kmdi">http://cnodejs.net/regist?code=FqIz9Y9Kmdi</a></p>
<p>顶！</p>
<p>已用：<a href="http://cnodejs.net/regist?code=Kc335g64riB">http://cnodejs.net/regist?code=Kc335g64riB</a></p>
<p>@<a href="/user/showen">showen</a> 求邀请啊</p>
<p>@<a href="/user/wangzefu">wangzefu</a><br><a href="http://cnodejs.net/regist?code=QfgBWgGSEKX">http://cnodejs.net/regist?code=QfgBWgGSEKX</a><br><a href="http://cnodejs.net/regist?code=diOIngx5VYL">http://cnodejs.net/regist?code=diOIngx5VYL</a><br><a href="http://cnodejs.net/regist?code=F0MPxrdsj5r">http://cnodejs.net/regist?code=F0MPxrdsj5r</a><br><a href="http://cnodejs.net/regist?code=7McP0sRVC1h">http://cnodejs.net/regist?code=7McP0sRVC1h</a><br><a href="http://cnodejs.net/regist?code=emimB8GAc8q">http://cnodejs.net/regist?code=emimB8GAc8q</a></p>
<p>@<a href="/user/showen">showen</a> 谢谢哥</p>
<p>@<a href="/user/showen">showen</a> 使用了F0MPxrdsj5r，谢谢，但是直接就是邀请名额已经用完了，对不起大家</p>
<p>FqIz9Y9Kmdi</p>
<p>已经激活..</p>
<p>已用：<a href="http://cnodejs.net/regist?code=qdMSozptUrO">http://cnodejs.net/regist?code=qdMSozptUrO</a><br>我的邀请码：<br><a href="http://cnodejs.net/regist?code=GV4sgKCFTz5">http://cnodejs.net/regist?code=GV4sgKCFTz5</a><br><a href="http://cnodejs.net/regist?code=JfCdjlARak1">http://cnodejs.net/regist?code=JfCdjlARak1</a><br><a href="http://cnodejs.net/regist?code=OuiUrHzsOQM">http://cnodejs.net/regist?code=OuiUrHzsOQM</a><br><a href="http://cnodejs.net/regist?code=xgvxyl21g6o">http://cnodejs.net/regist?code=xgvxyl21g6o</a></p>
<p>话说 nae 的 node 版本还是 0.6.x ?</p>
<p>p0aBo0TbI2V<br>已经激活.....</p>
<p>OuiUrHzsOQM</p>
<p>已经激活</p>
<p>求邀请啊</p>
<p>@<a href="/user/wangzefu">wangzefu</a> 我的邀请码已经发完了哦，呵呵</p>
<p>貌似版本小于0.8啊,一些包用不上，也不支持socket.io</p>
<p><a href="http://cnodejs.net/regist?code=CP0KN5ubIGF">http://cnodejs.net/regist?code=CP0KN5ubIGF</a>   已经激活</p>
<p><a href="http://cnodejs.net/regist?code=YNN2WtD5vvX">http://cnodejs.net/regist?code=YNN2WtD5vvX</a></p>
<p><a href="http://cnodejs.net/regist?code=5B4KbYAOlAz">http://cnodejs.net/regist?code=5B4KbYAOlAz</a></p>
<p><a href="http://cnodejs.net/regist?code=4xma7kvIXpp">http://cnodejs.net/regist?code=4xma7kvIXpp</a></p>
<p><a href="http://cnodejs.net/regist?code=UTFJQXbzTW5">http://cnodejs.net/regist?code=UTFJQXbzTW5</a></p>
<p><a href="http://cnodejs.net/regist?code=mm2mHVT3uZu">http://cnodejs.net/regist?code=mm2mHVT3uZu</a></p>
<p>我的邀请码</p>
<p>激活那么多，不留点机会给其他人么。。</p>
<p>@<a href="/user/hexie">hexie</a> 额……兄弟，你想多了，这个是我发出来的邀请码</p>
<p>@<a href="/user/thesadboy">thesadboy</a> OTZ ,误会你了，向你道歉。</p>
<p>@<a href="/user/hexie">hexie</a> 呵呵，木有关系</p>
<p>怎么安装express报错?Unsupported<br>npm ERR! Not compatible with your version of node/npm: connect@2.7.11<br>npm ERR! Required: {&quot;node&quot;:&quot;&gt;= 0.8.0&quot;}<br>npm ERR! Actual:   {&quot;npm&quot;:&quot;1.1.21&quot;,&quot;node&quot;:&quot;0.6.18&quot;}</p>
<p>可以考虑先安装完了将模块文件夹一起上传，我这样是成功了，呵呵</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 手动上传了node_moduels目录<br>启动提示<br>[INFO] <em> connection established !<br>[ERROR] tfrc start fail, process exit code: 1, sig:null<br>[INFO] </em> connection closed !</p>
<p>@<a href="/user/yakczh">yakczh</a> 不会啊，你是用客户端操作的吧？可以试试直接在页面操作，将源码打包zip上传，然后点击发布试试。</p>
<p>@<a href="/user/thesadboy">thesadboy</a>  我本地的express,jade是安装成全局的,页面打包上传以后提示没有jade,然后通过命令行把node_modules目录复制了一个,再上传就启动不起来了,另外页面上传是一次性的,下一次传又把上次的全覆盖了</p>
<p>@<a href="/user/yakczh">yakczh</a> 我是在项目目录执行了npm i将所有的模块安装后打包整个项目为zip上传上去，启动成功。但是很神奇的就是部分jade语法提示错误，再查查。</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 我的终于搞定了，原来是jade的版本问题，呵呵，有兴趣看看，没整完的。<a href="http://nwyb.cnodejs.net/">http://nwyb.cnodejs.net/</a></p>
<p>@<a href="/user/thesadboy">thesadboy</a> 你的jade什么版本</p>
<p>@<a href="/user/yakczh">yakczh</a> 0.30.0</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 我在本地安装了 npm install jade@0.30.0 可以启动app, nae sup 上传以后,还是提示找不到jade</p>
<p>@<a href="/user/yakczh">yakczh</a> 你是怎么上传的？</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 本地安装了 npm install jade@0.30.0  node app能运行以后,把整个目录下的文件打包 成zip 上传<br>要不你的包含jade的zip文件发我一份 fieldset@sohu.com,谢谢</p>
<p>@<a href="/user/yakczh">yakczh</a> 已发送</p>
<p>jade也安装不了,这能干啥,专门与hello world的吗?</p>
<p>nae auth 提示success了 执行命令还是提示没有权限呢?<br> nae status myclub<br>ERROR] <em> you don&#39;t have the app&#39;s permission . auth failed !<br>INFO] </em> connection closed !</p>
<p>npm ERR! Unsupported<br>npm ERR! Not compatible with your version of node/npm: mongodb@1.2.11<br>npm ERR! Required: {&quot;node&quot;:&quot;&gt;=0.6.19&quot;}<br>npm ERR! Actual:   {&quot;npm&quot;:&quot;1.1.21&quot;,&quot;node&quot;:&quot;0.6.18&quot;}</p>
<p>有人好缺德= =用了也不说下<br><a href="http://cnodejs.net/regist?code=4xma7kvIXpp">http://cnodejs.net/regist?code=4xma7kvIXpp</a> 已用<br><a href="http://cnodejs.net/regist?code=DIXso6wT8fN">http://cnodejs.net/regist?code=DIXso6wT8fN</a><br><a href="http://cnodejs.net/regist?code=F7Rbb5coM21">http://cnodejs.net/regist?code=F7Rbb5coM21</a><br><a href="http://cnodejs.net/regist?code=Q7hDgxZY5Xk">http://cnodejs.net/regist?code=Q7hDgxZY5Xk</a><br><a href="http://cnodejs.net/regist?code=xQA1VYwPsCq">http://cnodejs.net/regist?code=xQA1VYwPsCq</a><br><a href="http://cnodejs.net/regist?code=HOOzPIXSqui">http://cnodejs.net/regist?code=HOOzPIXSqui</a></p>
<p><a href="http://cnodejs.net/regist?code=DIXso6wT8fN">http://cnodejs.net/regist?code=DIXso6wT8fN</a> 已用</p>
<p>xQA1VYwPsCq 已用</p>
<p><a href="http://cnodejs.net/regist?code=iSwkbff34XK">http://cnodejs.net/regist?code=iSwkbff34XK</a><br><a href="http://cnodejs.net/regist?code=P1mtZeG28jb">http://cnodejs.net/regist?code=P1mtZeG28jb</a><br><a href="http://cnodejs.net/regist?code=qiC8fOw8Ac0">http://cnodejs.net/regist?code=qiC8fOw8Ac0</a><br><a href="http://cnodejs.net/regist?code=sRaZLemW2oa">http://cnodejs.net/regist?code=sRaZLemW2oa</a><br><a href="http://cnodejs.net/regist?code=OhKfyKQKJmo">http://cnodejs.net/regist?code=OhKfyKQKJmo</a>  </p>
<p><a href="http://cnodejs.net/regist?code=G3S9Slfzcqf">http://cnodejs.net/regist?code=G3S9Slfzcqf</a><br><a href="http://cnodejs.net/regist?code=0xed7lWqw84">http://cnodejs.net/regist?code=0xed7lWqw84</a><br><a href="http://cnodejs.net/regist?code=6WmCiRa8Rrp">http://cnodejs.net/regist?code=6WmCiRa8Rrp</a><br><a href="http://cnodejs.net/regist?code=UlQOnySw1TR">http://cnodejs.net/regist?code=UlQOnySw1TR</a><br><a href="http://cnodejs.net/regist?code=ZUqKB1E75tg">http://cnodejs.net/regist?code=ZUqKB1E75tg</a></p>
<p><a href="http://cnodejs.net/regist?code=0xed7lWqw84">http://cnodejs.net/regist?code=0xed7lWqw84</a> 己用</p>
<p>求注册码</p>
<p><a href="http://cnodejs.net/regist?code=HOOzPIXSqui已用">http://cnodejs.net/regist?code=HOOzPIXSqui已用</a></p>
<p>求注册码</p>
<p>求注册码</p>
<p>cJmxNAjui71 已经成功   谢谢！</p>
<p>   求邀请</p>
<p>求邀请</p>
<p><a href="http://cnodejs.net/regist?code=sRaZLemW2oa">http://cnodejs.net/regist?code=sRaZLemW2oa</a>  已用</p>
<p>求注册码</p>
<p> 求邀请</p>
<p>这才对嘛~</p>
<p>哪个高人给我发一个啊？</p>
<p>OhKfyKQKJmo已使用</p>
<p>求注册码</p>
<p>求注册码</p>
<p>厄。。。好厉害</p>
<div class="title"><a href="http://cnodejs.org/topic/51dccbf7d44cbfa30427664b" target="_blank">
      express老是丢session是怎么回事啊
    </a>10 小时前</div><p>就是我nodejs应用中，老是莫名其妙的session就没了(express)</p>
<p>比如req.session.userid  初始化为123456</p>
<p>过阵子req.session.userid变成了undefined..</p>
<p>但是我没权限读写公共redis。后来我跟后端商量了下让他写了个读写session的口子暴露给我。(get set del)</p>
<p>这个丢session是怎么造成的啊？ 对于这个问题我这么处理可以么?</p>
<p>去express 的github 提issue...</p>
<p>session过期了吧</p>
<p>这个问题肯定是你们程序的问题啊,首先判断客户端的cookie中的sid还在不在?如果在然后看redis中sid对应的记录还在不在,排除到是不是过期问题.</p>
<p>如果是过期了，应该怎么办？@<a href="/user/leizongmin">leizongmin</a> ，从新创建session 吗？</p>
<p>Session被“过期”有两种情况：</p>
<ul>
<li><p>Session ID (存储在Cookie中的）过期了，Session ID过期后，服务器会分配一个新的Session ID给当前客户端，这样的话，原来的Session数据也相当于失效了</p>
</li>
<li><p>用来存储Session的数据库没有对应的数据了（比如Redis中设置了过期时间）</p>
</li>
</ul>
<p>以上任意一种情况都会导致Session数据没有了。<br>看你具体使用那个Sesison中间件，我不太清楚，你自己去看文档。</p>
<p>这不是丢session，而是session没有同步的问题吧……</p>
<div class="title"><a href="http://cnodejs.org/topic/51d3c105d44cbfa304316fd4" target="_blank">
      CNODE 模块proxy 的功能是什么
    </a>10 小时前</div><h2>社区的源码中proxy 模块功能是做什么的，有点不懂，有没有人了解的说下，</h2>
<p>不要只是简单说：代理、什么的，不是请你翻译。<br>谢谢了。</p>
<p><strong>EventProxy</strong>吧？</p>
<p>恩，是的？能解释下吗？</p>
<p><a href="https://npmjs.org/package/eventproxy">https://npmjs.org/package/eventproxy</a></p>
<p>哈哈，事件绑定，事件触发，异常处理，避免代码嵌套，对代码的可维护性很有好处</p>
<p>eventproxy 不错，不用多层嵌套了。</p>
<p>不过嵌套有个好处，外层的变量可以用在内层（在scope里），不用传来传去。eventproxy 怎么解决这个问题的？</p>
<p>你说的是proxy目录吧？数据代理层。</p>
<div class="title"><a href="http://cnodejs.org/topic/519f129e776b2e7f030ab605" target="_blank">
      如何用node.js写soap的client端？
    </a>12 小时前</div><p>原来是用java写的，现在初学node.js，要改写。怎么弄啊，哪位大侠可以指点一下？原来的那个xml文档里面的内容要怎么写到args里面呢？还有Header里面的东西。<br>headers.setHeader(&quot;Content-Type&quot;,&quot;text/xml&quot;);<br>headers.setHeader(&quot;SOAPAction&quot;,&quot;<a href="http://xxx.com/runQuery">http://xxx.com/runQuery</a>&quot;); </p>
<p>文档太少了。用的是node.js v0.10.7和milewise的soap模块。</p>
<p>  var soap = require(&#39;soap&#39;);<br>  var url = &#39;<a href="http://xxx.com/xxx.asmx">http://xxx.com/xxx.asmx</a>&#39;;<br>  var args = {xxx:&#39;abc&#39;};<br>  soap.createClient(url, function(err, client) {<br>      client.RunQuery(args, function(err, result) {<br>          console.log(result);<br>      });<br>  });</p>
<p>报错：<br>Error: Unexpected root element of WSDL or include<br>    at null.&lt;anonymous&gt; (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:907:23)<br>    at EventEmitter.emit (events.js:98:17)<br>    at Parser.parse (/home/taxi/nodeapp/node_modules/soap/node_modules/node-expat/lib/node-expat.js:18:22)<br>    at WSDL._parse (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:920:12)<br>    at WSDL._fromXML (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:928:29)<br>    at /home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:584:18<br>    at process._tickCallback (node.js:415:13)</p>
<p>顶下</p>
<div class="title"><a href="http://cnodejs.org/topic/51524cff5dff253b370753ed" target="_blank">
      用http.get如何添加cookie啊？
    </a>10 小时前</div><p>需要模拟登陆一个网站，发现它那个cookie是js设置的，模拟的时候也需要带上，这个如何搞？</p>
<p>cookie 是设在域下面的，http response 头 中 含有 set-cookie 可以设置浏览器cookie</p>
<p><code>function (res) {
        res.setCookie(&quot;name=value&quot;);</code><br>这样不行啊！提示：has no method setCookie<br>在option中加入<br><code>headers: { &quot;set-cookie&quot;: &quot;name=value&quot; }</code><br>好像也不行，响应的结果和没加cookie是一样的。</p>
<p>你要模拟客户端请求 你打开firefox查看请求头就可以了撒 格式是这样的 headers: { &quot;Cookie&quot;: &quot;name=value&quot; }</p>
<p>好像也不行呢！如果有两个cookie，这样写是否可以：<br>headers: { &quot;Cookie&quot;: &quot;name=value&quot;, &quot;Cookie&quot;: &quot;name1=value1&quot;}</p>
<p>(&quot;Set-Cookie&quot;,[&quot;type=ninja&quot;,&quot;language=javascript&quot;]);<br>尝试这样。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd6291d44cbfa3043d30c9" target="_blank">
      新人学习node.js求助
    </a>13 小时前</div><p>现在正在看《node.js入门经典》，里面有段代码不知道问什么无法执行<br>app.js代码如下<br>    var express = require(&#39;express&#39;);</p>
<pre class="prettyprint"><code>var app = express();

var io = require(&#39;socket.io&#39;).listen(app);

app.listen(3000);

app.get(&#39;/&#39;, function (req, res){
    res.sendfile(__dirname + &#39;/index.html&#39;);
});

io.sockets.on(&#39;connection&#39;, function (socket){
    socket.emit(&#39;welcome&#39;, {text: &#39;OH HAI! U R CONNECTED!&#39;});
});</code></pre>
<p>index.html代码如下<br>    &lt;!DOCTYPE html&gt;<br>    &lt;html lang="en"&gt;<br>      &lt;head&gt;<br>            &lt;meta charset="utf-8"/&gt;<br>            &lt;title&gt;Socket.IO Express Example&lt;/title&gt;<br>        &lt;/head&gt;<br>        &lt;body&gt;<br>            <h1>Socket.IO Express Example</h1><br>            &lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br>            &lt;script&gt;<br>                var socket = io.connect();<br>                socket.on(&#39;welcome&#39;, function (data){<br>                    console.log(&#39;data.text&#39;);<br>                });<br>            &lt;/script&gt;</p>
<pre class="prettyprint"><code>    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>总是报错无法找到/socket.io/socket.io.js</p>
<p>新人不太懂格式，看起来有点奇怪，还请各位大神将就点看哈</p>
<p>/socket.io/socket.io.js 由 socket.io 模块提供。你的 socket.io 模块安装了吗？</p>
<p>下面这行，执行时有没有错误信息？<br>var io = require(&#39;socket.io&#39;).listen(app); </p>
<p>程序执行没有错误，但是看javascript的输出时会提示无法io是未定义变量</p>
<div class="title"><a href="http://cnodejs.org/topic/51de0afdf4963ade0e0971e7" target="_blank">
      关于SWIG工具的疑惑，请答疑
    </a>13 小时前</div><div class="title"><a href="http://cnodejs.org/topic/51dd2c64d44cbfa3043655b0" target="_blank">
      框架里面路由的地址配置的问题
    </a>13 小时前</div><p>大部分框架的路由地址都是相对的<br>有没有像微软mvc里面的路由地址是正则匹配的</p>
<p>/u/:id不是正则是什么?</p>
<p>微软mvc里面是 例如&#39;{controller}/{action}.html&#39; 这样会调用相应的控制器 里面的方法，然后可以为这个正则设置默认值,因为那个分层开发挺方便的 可能我意思表达有误吧</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd88fbd44cbfa3044200b7" target="_blank">
      关于sudo的一个诡异问题
    </a>20 小时前</div><p>想要安装个<code>n</code>,<code>npm install -g n</code>,报错</p>
<pre class="prettyprint"><code>npm http GET http://npm.hacknodejs.com/n
npm http 404 http://npm.hacknodejs.com/n
npm ERR! registry error parsing json
npm ERR! Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;
npm ERR!  { [Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;]
npm ERR!   errno: 3,
npm ERR!   code: &#39;EACCES&#39;,
npm ERR!   path: &#39;/usr/lib/node_modules&#39;,
npm ERR!   fstream_type: &#39;Directory&#39;,
npm ERR!   fstream_path: &#39;/usr/lib/node_modules/n&#39;,
npm ERR!   fstream_class: &#39;DirWriter&#39;,
npm ERR!   fstream_stack: 
npm ERR!    [ &#39;/usr/lib/nodejs/npm/node_modules/fstream/lib/writer.js:171:23&#39;,
npm ERR!      &#39;/usr/lib/nodejs/npm/node_modules/mkdirp/index.js:37:53&#39;,
npm ERR!      &#39;Object.oncomplete (fs.js:107:15)&#39; ] }
npm ERR! 
npm ERR! Please try running this command again as root/Administrator.

npm ERR! System Linux 3.8.0-19-generic
npm ERR! command &quot;node&quot; &quot;/usr/bin/npm&quot; &quot;install&quot; &quot;-g&quot; &quot;n&quot;
npm ERR! cwd /home/shukri
npm ERR! node -v v0.10.12
npm ERR! npm -v 1.2.32
npm ERR! path /usr/lib/node_modules
npm ERR! fstream_path /usr/lib/node_modules/n
npm ERR! fstream_type Directory
npm ERR! fstream_class DirWriter
npm ERR! code EACCES
npm ERR! errno 3
npm ERR! stack Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;
npm ERR! fstream_stack /usr/lib/nodejs/npm/node_modules/fstream/lib/writer.js:171:23
npm ERR! fstream_stack /usr/lib/nodejs/npm/node_modules/mkdirp/index.js:37:53
npm ERR! fstream_stack Object.oncomplete (fs.js:107:15)
npm ERR! 
npm ERR! Additional logging details can be found in:
npm ERR!     /home/shukri/npm-debug.log
npm ERR! not ok code 0</code></pre>
<p>然后 <code>sudo npm install -g n</code>，但是输入密码之后就没有反应了<br>然后试着&#39;npm -v&#39;</p>
<pre class="prettyprint"><code>1.2.32</code></pre>
<p>然后 <code>sudo npm -v</code>，命令行又什么都没输出，也没反应。。。 </p>
<p>系统是<code>linuxmint15</code>，刚装的系统，应该没问题啊</p>
<p>sudo su 转成 superuser mode, 再试试看。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd05c7d44cbfa3042ed784" target="_blank">
      [招聘] Javascript程序员（上海）
    </a>20 小时前</div><h2>公司简介</h2>
<p>上海意派信息科技专注于跨平台数字出版解决方案的研发，既往已完成有“旅游时报 iOS APP”、“罗莱家纺产品营销展示系统 IPad APP”等客户项目系统开发，目前承担中国商飞的在线飞行培训系统的研制。</p>
<p>网站： <a href="http://www.21epub.com">http://www.21epub.com</a><br>地址：上海静安区延平路121号三和大厦20CD</p>
<h2>岗位职责</h2>
<ul>
<li>负责公司自主研发的在线可视化交互内容编撰系统开发</li>
<li>负责公司自主研发的多通道内容管理系统（CMS）后台UI开发</li>
<li>Web APP开发</li>
<li>网站/门户系统UI开发</li>
<li>参与JS开发框架的设计与持续完善</li>
</ul>
<h2>岗位要求</h2>
<ul>
<li>HTML/CSS/JQuery至少1年开发经验</li>
<li>熟悉Backbone，或具有其他JS MVC 框架经验</li>
<li>对交互体验有兴趣，有意愿对代码进行持续地优化和完善</li>
<li>有参与敏捷开发的经验尤佳</li>
<li>如果有掌握至少一种服务器端语言或框架尤佳</li>
<li>使用Git/SVN进行版本管理</li>
</ul>
<h2>应聘要求</h2>
<ul>
<li>请提供既往项目/工作成果，便于我们了解，在线网址 或 程序文件包都可。</li>
<li>简历请发送至 <a href="mailto:zhaoyuyong@21epub.com">zhaoyuyong@21epub.com</a></li>
</ul>
<div class="title"><a href="http://cnodejs.org/topic/51dcc6b9d44cbfa304269cff" target="_blank">
      我在客户端始终无法响应res的end事件，小白提问。
    </a>13 小时前</div><pre class="prettyprint"><code> var http=require(&#39;http&#39;);
  var qs=require(&#39;querystring&#39;);
  var post_data={a:123,time:new Date().getTime()};//这是需要提交的数据
  var content=qs.stringify(post_data);

  var options = {
    host: &#39;localhost&#39;,
    port: 3000,
    path: &#39;/&#39;,
    method: &#39;POST&#39;,
    headers:{
    &#39;Content-Type&#39;:&#39;application/x-www-form-urlencoded&#39;,
    &#39;Content-Length&#39;:content.length
    }
  };
  console.log(&quot;post options:\n&quot;,options);
  console.log(&quot;content:&quot;,content);
  console.log(&quot;\n&quot;);

  var req = http.request(options, function(res) {
    console.log(&quot;statusCode: &quot;, res.statusCode);
    console.log(&quot;headers: &quot;, res.headers);
    var _data=&#39;&#39;;
    res.on(&#39;data&#39;, function(chunk){
       _data += chunk;
      console.log(_data);
    });
    res.on(&#39;end&#39;, function(){
       //data = qs.parse(_data);
      console.log(&#39;end is emitted&#39;);
      console.log(&quot;\n---&gt;&gt;\nresult:&quot;,_data)
    });
  });

  req.write(content);
  req.end();

  //服务器
  var http = require(&#39;http&#39;);
  var url = require(&#39;url&#39;);
  var util = require(&#39;util&#39;);
  var qs = require(&#39;querystring&#39;);
  http.createServer(function(req,res){
    var data = &#39;&#39;;
      req.on(&#39;data&#39;,function(chunk){
          data+=chunk;
      });

  req.on(&#39;end&#39;,function(){
      res.writeHead(200, {
        &#39;Content-Length&#39;: data.length,
      &#39;Content-Type&#39;: &#39;text/plain&#39; });
      data = qs.parse(data);
      console.log(data.a.toString());
      res.write(data.a.toString());
      res.end(&#39;hello&#39;);
      //data = qs.parse(data);
      console.log(data);
  });
  }).listen(3000);
  console.log(&quot;!!!&quot;);</code></pre>
<p>  在客户端<br>  我的res.on（end）事件始终没有反应……这是为什么？</p>
<p>req.on(&#39;end&#39;) ?</p>
<p>哥哥,你的req.end()调用的时候服务器还没启动呢?我给你的代码稍微改了下.<br>req.write(content);req.end();放到.listen(3000);的回调函数里面得到了你想要的结果.</p>
<p><pre><code><br>listen(3000,function(){<br>    req.write(content);<br>    req.end();<br>});<br></code></pre></p>
<p>我猜他是Server.js跟Client.js分開的。</p>
<p>只是他把Server &amp; Client的Code貼在一起了</p>
<p>经过哥的深入分析，原来是这里的问题：</p>
<pre class="prettyprint"><code>res.writeHead(200, {
        &#39;Content-Length&#39;: data.length,      // 应该去掉这一行
      &#39;Content-Type&#39;: &#39;text/plain&#39; });</code></pre>
<p>一般情况下是不需要自己去手动设置这个 <code>Content-Length</code> 的，但是你奇葩地去做了；<br>如果你没有设置 <code>Contebt-Length</code> ，http模块内部是会自动帮你计算的，但是你设置了这个值，而你实际返回的数据长度却没有这么多，于是http客户端请求时就在那傻傻地等（即使你已经 <code>res.end()</code> 了），直到连接关闭后才触发 <code>end</code> 事件。</p>
<p>设置了不正确的 <code>Content-Length</code> 的后果就是，如果实际数据长度超过了这个值，后面会被截断，如果实际没有这么大，就形成了 “无法触发end事件” 的假象。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd8d02d44cbfa304423e28" target="_blank">
      分享一个用 Flash Socket 连 Pomelo TCP 服务器的组件
    </a>22 小时前</div><div class="title"><a href="http://cnodejs.org/topic/51dd601ed44cbfa3043cb752" target="_blank">
      用socket.io隧道实现的一个应用
    </a>20 小时前</div><p>本人开发的一个项目，发布在Github上。地址为<a href="https://github.com/yeefont/http4gfw"><a href="https://github.com/yeefont/http4gfw">https://github.com/yeefont/http4gfw</a></a><br>对Socket, Stream的事件处理是否合理，不是很有把握。欢迎大家指教。<br>以下说明就是README</p>
<p>Http4GFW is a free and open source project developed by <a href="http://www.yeefont.com">Yeefont</a>. It aims to make web traffic pass through some sensitive firewall in internet.<br>Thanks to <strong>socket.io</strong> , the task on HTTP-traffic is much simpler now.</p>
<h1>How It Works</h1>
<p><img src="http://www.yeeads.com/img/github/node4gfw.jpg" alt="System Architecture of Http4gfw"></p>
<h1>Config &amp; Run</h1>
<ol>
<li>upload the project to Http-Host Server supporting Node.js, <strong>app.js</strong> is the  start script.</li>
<li>in local machine, run SOCKS5 script <strong>localA.js</strong> </li>
<li>in local machine, run DNS-Server Script <strong>localB.js</strong></li>
<li>in local machine, set Browser&#39;s SOCKS5 proxy address(default is <em>127.0.0.1:8888</em>, set interface&#39;s DNS-Server address(default is <em>127.0.0.1</em>)</li>
</ol>
<p>Please modify <strong>config.js</strong> according to your environment.</p>
<h1>Debug</h1>
<p>You can run the proxy-server in local machine.</p>
<hr>
<h1>Issues</h1>
<ol>
<li>the speed is much slower than normal VPN</li>
<li>it is just an experimental project, must have many bugs.</li>
</ol>
<div class="title"><a href="http://cnodejs.org/topic/51dd2dd4d44cbfa304369046" target="_blank">
      npm install -g formidable 不成功,怎么回事啊,在win7上装的
    </a>7-10 19:22</div><p>npm http GET <a href="https://registry.npmjs.org/formidable">https://registry.npmjs.org/formidable</a><br>npm http 304 <a href="https://registry.npmjs.org/formidable">https://registry.npmjs.org/formidable</a><br>npm WARN package.json bytes@0.2.1 No repository field.<br>npm WARN package.json fresh@0.1.0 No repository field.<br>npm WARN package.json repository@0.2.0 No repository field.<br>npm WARN package.json cookie-signature@1.0.1 No repository field.<br>npm WARN package.json methods@0.0.1 No repository field.<br>npm WARN package.json range-parser@0.0.4 No repository field.<br>npm WARN package.json policyfile@0.0.4 &#39;repositories&#39; (plural) Not supported.<br>npm WARN package.json Please pick one as the &#39;repository&#39; field<br>npm WARN package.json dateformat@1.0.6-1.2.3 No repository field.<br>npm WARN package.json growl@1.7.0 No repository field.<br>npm WARN package.json bytes@0.2.0 No repository field.<br>npm WARN package.json pause@0.0.1 No repository field.<br>npm WARN package.json uid2@0.0.2 No repository field.<br>formidable@1.0.14 C:\Users\Administrator\AppData\Roaming\npm\node_modules\formidable</p>
<p>添加:<br>var formidable = require(&#39;formidable&#39;);<br>之后:</p>
<p>module.js:340<br>    throw err;<br>          ^<br>Error: Cannot find module &#39;formidable&#39;<br>    at Function.Module._resolveFilename (module.js:338:15)<br>    at Function.Module._load (module.js:280:25)<br>    at Module.require (module.js:364:17)<br>    at require (module.js:380:17)<br>    at Object.&lt;anonymous&gt; (D:\node\test\server.js:5:18)<br>    at Module._compile (module.js:456:26)<br>    at Object.Module._extensions..js (module.js:474:10)<br>    at Module.load (module.js:356:32)<br>    at Function.Module._load (module.js:312:12)<br>    at Module.require (module.js:364:17)</p>
<div class="title"><a href="http://cnodejs.org/topic/51dbf215d44cbfa304149925" target="_blank">
      关于Http模块疑惑
    </a>7-10 20:47</div><p>我创建了一个http服务端，在接收请求函数中查找数据库里面的数据，将数据传回给客户端，当另外一个请求来临时，他要等到前面那个请求查找完数据返回客户端后，才能执行。如何解决该问题，是否要创建子进程去处理数据查询。</p>
<ol>
<li>用的什么数据库客户端？它只支持同步模式？</li>
<li>如果支持异步模式。那么与数据库的连接数多少，是否只有1；查询数据量大不大？如果以上皆是，增加连接数。</li>
</ol>
<p>用oracle，数据库的数据是亿级的，异步了也没用，还是要等待数据返回给客户端，另外一个请求才能获得请求，就像我们在http响应函数里面，计算一个长时间的计算一样。有什么好的办法吗，用child_process的话，几个请求就把CPU的用光了</p>
<p>@<a href="/user/zhs077">zhs077</a> <blockquote>几个请求就把CPU的用光</blockquote><br>你真的不是在做cpu密集型计算？</p>
<p>@<a href="/user/shiedman">shiedman</a> 查数据库耗时比较久</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd3d5bd44cbfa30438ce2b" target="_blank">
      Jul 10, 今天 Grunt 无法正常安装
    </a>7-10 18:54</div><div class="title"><a href="http://cnodejs.org/topic/518b679763e9f8a5424406e9" target="_blank">
      nodejs多线程，真正的非阻塞
    </a>7-10 19:55</div><p>node从他推出至今，充满赞美和饱受诟病的都是其单线程模型，所有的任务都在一个线程中完成（I/O等例外），优势的地方自然是免去了频繁切换线程的开销，以及减少资源互抢的问题等等，但是当nodejs面对cpu密集型模型的时候就力不从心了。尽管node拥有异步机制，可以把一些耗时算法丢入eventloop等待下个事件循环再做，但是因为其任然是单线程模型，所以终究会造成阻塞。</p>
<p>先解释一下两个名词，Fibers 和 Threads。<br>Fibers 又称纤程，可以理解为协同程序，类似py和lua都有这样的模型。使用Fibers可以避免对资源的互抢，减少cpu和内存的消耗，但是Fibers并不能够真正的并行执行，同一时刻只有一个Fibers在执行，如果在其中一个Fibers中执行过多的cpu操作或者写了个死循环，则整个主程序将卡死住。node中的异步事件循环模型就有点象这个。</p>
<p>Threads 又称线程，他可以在同一时刻并行的执行，他们共享主进程的内存，在其中某一时刻某一个threads锁死了，是不会影响主线程以及其他线程的执行。但是为了实现这个模型，我们不得不消耗更多的内存和cpu为线程切换的开销，同时也存在可能多个线程对同一内存单元进行读写而造成程序崩溃的问题。</p>
<p>很多让node支持多线程的方法是使用c/c++的addon来实现，在需要进行cpu密集型计算的地方，把js代码改写成c/c++代码，但是如果开发人员对c++不是很熟悉，一来开发效率会降低不少，二来也容易出bug，而且我们知道在addon中的c++代码除了编译出错外，是很难调试的，毕竟没有vs调试c++代码方便。</p>
<p>令人振奋的消息，我们为什么不让node也支持多线程模型呢？于是Jorge为我们开发出了一个让node支持多线程模型的模块：threads_a_gogo<br>github地址：<a href="https://github.com/xk/node-threads-a-gogo"><a href="https://github.com/xk/node-threads-a-gogo">https://github.com/xk/node-threads-a-gogo</a></a></p>
<p>有了threads-a-gogo（以下简称TAGG）这个模块之后，我们可以让node做更多的事情，我记得以前我看过一篇文章，说node只能应付i/o密集型场景，在cpu密集型场景将完败给apache，因为apache是为每一个请求起一条线程的，所以在处理cpu密集型任务时一个线程的高强度计算不会很大程度的影响其他线程，类似的还有php的fastcgi，这也是很多拿node和php进行比较时，php的拥护者们一直提出的理论。</p>
<p>我们先来做一个简单的测试，用我们suqian大大最喜欢的斐波那契数组来看一下，加入了多线程的node有多么的强悍：（测试机器为4CPU）<br>没有使用TAGG的正常情况，异步也帮不了我们应对cpu密集型任务</p>
<pre class="prettyprint"><code>    function fibo (n) {
      return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
    }
    var n=8
    function back(){
        if(!--n) return console.timeEnd(&#39;no thread&#39;);
    }
    console.time(&#39;no thread&#39;);

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})</code></pre>
<p>我们模拟了8个异步的行为，测试用的node v0.8.16版本，所以 process.nextTick还是异步方法。最后我们输出结果为：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
no thread: 23346ms</code></pre>
<p>接下来我们使用TAGG模块来测试同样的执行8次斐波那契数组计算，看看成绩如何？</p>
<pre class="prettyprint"><code>function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 thread&#39;);
var numThreads= 8; //创建线程池，最大数为8
var threadPool= require(&#39;threads_a_gogo&#39;).createPool(numThreads).all.eval(fibo); //为线程池注册程序
var i=8;
var cb = function(err,data){ //注册线程执行完毕的回调函数
    console.log(data);
    if(!--i){
        threadPool.destroy();
        console.timeEnd(&#39;8 thread&#39;);
    }
}
threadPool.any.eval(&#39;fibo(40)&#39;, cb); //开始向线程池中执行fibo(40)这个任务

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);</code></pre>
<p>最重的结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 thread: 9510ms</code></pre>
<p>相比不使用多线程模型的node，使用了TAGG模块之后，我们在4CPU服务器上的测试结果要快上一倍还不止。<br>到这里我们看上去找到了一个比较完美的解决方案应对CPU密集型任务，但是可能有同学会说，我可以使用cluster来做相同的事情，下面我们来做一个使用cluster计算这些任务的情况：</p>
<pre class="prettyprint"><code>var cluster = require(&#39;cluster&#39;);
var numCPUs = 8;
function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 cluster&#39;);
if (cluster.isMaster) {
  // Fork workers.
  for (var i = 0; i &lt; numCPUs; i++) {
    cluster.fork();
  }
  var i = 8;
  cluster.on(&#39;exit&#39;, function(worker, code, signal) {
        if(!--i){
            console.timeEnd(&#39;8 cluster&#39;);
            process.exit(0);
        }
  });
} else {
    console.log(fibo (40));
    process.exit(0);
}</code></pre>
<p>代码上的复杂程度比使用TAGG要高的多，而且如果是动态计算斐波那契数组的结果，编码将更加困难，需要在fork时挂上不同的参数，出错的几率也更大。同时还有更重要的一个事情，如果是创建一个http服务器，如果4个cluster都在计算fibo，那第5个请求node将无法处理，而是用TAGG则还是能够正常处理的，所以cluster并不能解决单线程模型的cpu密集计算带来的阻塞问题，我们看下测试结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 cluster: 11925ms</code></pre>
<p>TAGG模块还有其他更多的功能，比如事件触发，平滑退出，查看线程工作状态等等，总之TAGG模块给node注入了新的活力，让node一直饱受诟病的处理cpu密集任务问题得到了一个妥善的解决，就算你不擅长c++代码，也能够轻松编写出多线程的真正的非阻塞node程序了。</p>
<p>最后分享一篇干货文章，相当很精彩的一篇博客：<br><a href="http://bjouhier.wordpress.com/2012/03/11/fibers-and-threads-in-node-js-what-for/">Fibers and Threads in node.js – what for?</a></p>
<p>tagg2，nodejs多线程模块，更好的api，支持nodejs原生模块，跨平台支持，windows，linux和mac<br><a href="http://cnodejs.org/topic/51976afe63e9f8a542484e66">跨平台模块tagg2，让node多线程支持</a></p>
<p>干货分析，感谢。收藏了</p>
<p>最后文章的连接无法打开。。</p>
<p>修改了，不过貌似被墙了。。。爱、唉</p>
<p>threads_a_gogo貌似不支持windows哦  回去用linux试试看</p>
<p>代码使用的pthread标准库，貌似windows下没法使用</p>
<p>居然用 <code>eval</code>, 会不会蛋疼的... 文章好棒.<br>现在有没有其他多线程实现出来呢?</p>
<p>此 eval 可能非彼 eval 也</p>
<p> @<a href="/user/seasonx4">seasonx4</a> 既然传字符串了.. 我想到除了 <code>eval</code> 只有存成文件调用的...</p>
<p> @<a href="/user/jiyinyiyong">jiyinyiyong</a> 这个eval和js的eval没关系，只是表示执行的意思</p>
<p>真真是极好的.....</p>
<p>node官方是什么反应呢 Jorge又是什么来头</p>
<p>不着调jorge什么来头，官方没反应。。。。</p>
<p>貌似最近更新在1年前了诶....</p>
<p>Fibers and Threads in node.js – what for? 访问不了？看看这个截图</p>
<p><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png"><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png">http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png</a></a></p>
<div class="title"><a href="http://cnodejs.org/topic/519e01c563e9f8a542fa68f9" target="_blank">
      【一起学node.js】再版啦~
    </a>7-10 13:53</div><p>最近又把教程彻底重写了一遍，内容更加详细，条理更加清晰。已发布到 github ，地址为<br><a href="https://github.com/nswbmw/N-blog"><a href="https://github.com/nswbmw/N-blog">https://github.com/nswbmw/N-blog</a></a></p>
<p>前面的教程现已废弃。</p>
<p>若在学习过程之中遇到错误，给所有读者以下建议：</p>
<p>1.自己通过错误信息分析哪里出错<br>2.对比 github 上的源码找出错误<br>3.清空数据库，重新运行 app.js （这点很重要）<br>4.把错误的代码打包发到 gxqzk@126.com ，我帮你解决问题</p>
<p>学习了，楼主写的很详细些，手把手新手入门啊~</p>
<p>@<a href="/user/snoopy">snoopy</a> 能不能讲讲mongoose 啊！！</p>
<p>不用mongoose的啊~</p>
<p> @<a href="/user/snoopy">snoopy</a> -orz<br>那您推荐一个吧</p>
<p>小哥，出来混要打扮下的——css用twitter bootstrap；这样才能吸引妹子啊</p>
<p>这里能有几个妹子啊 = =</p>
<p> @<a href="/user/nswbmw">nswbmw</a> 他就是妹子！</p>
<p>很详细，加油！</p>
<p>不错，置顶！</p>
<p>我擦，吃晚饭，刷一下，变样子了~</p>
<p> @<a href="/user/snoopy">snoopy</a> 哈哈，先上线让大家吐槽吐槽。</p>
<p>支持！！！</p>
<p>求mongoose教程</p>
<p>去看我之前翻译的文档，绝大部分查看api就可以使用了</p>
<p> @<a href="/user/a272121742">a272121742</a> 看完了，真心不错，谢了。不过因为网站模版改了，教程排版比较乱，看着有点吃力</p>
<p>顶一个, 很有奉献精神</p>
<p>必须支持，给我们新手来说帮助太大了，呵呵。</p>
<p>改版后没有什么层次感了！</p>
<p>一阵新鲜感哈</p>
<p>楼主很给力啊，辛苦了</p>
<p>就是要多点热爱分享的人，新手表示感谢</p>
<p>那个在安装flash 模块的时候，是在app.js中修改代码，不是在index.js中修改代码吧？</p>
<p>嗯，多谢指正，笔误。。。</p>
<p>感谢楼主奉献<br>我是Linux下,做到mongodb那里总是报错,说是连接不上数据库<br>&#39;throw new Error(&#39;Error connecting to database&#39;);&#39;<br>上面的是抛错,mongod是需要额外启动的么?</p>
<p>对，每一次都是先启动 mongod ，后启动 app。</p>
<p>可以把mongodb添加到开机启动脚本</p>
<p>@<a href="/user/nswbmw">nswbmw</a> 感谢,过这么久才来看,已经OK</p>
<p>@<a href="/user/soufii">soufii</a> 同样感谢~</p>
<p>good！</p>
<p>又可以省些时间自己写了哈···</p>
<p>怎么就没得人用MySQL咧</p>
<p>怎么不用pgsql。。  有node.JS jade教程么？</p>
<p>受益了，支持楼主，顶上~~</p>
<p>好文章啊，传说中的深入浅出～～</p>
<p>多谢啊！！！！！</p>
<p>楼主能不能完善下以auth方式启动的mongodb与connect-mongo的连接该如何配置用户名和密码啊。我照着你的系列搞，我的mongodb是以auth方式启动的，所以连接被拒绝，如果能把这完善下就完美了，本人能力有限，捣鼓半天也折腾不出来，期待楼主佳音</p>
<p>connect-mongo的说明里写了username和password其实是可选选项，加入到连接代码中即可。<br><a href="https://npmjs.org/package/connect-mongo">https://npmjs.org/package/connect-mongo</a><br>很多事情其实官方的文件都有说的，多看文档可以节约很多时间</p>
<p>后来又看了下，发现了点问题<br>node.js的创建数据库连接传递的参数没有用户名和密码（大部分地方都没写）<br>我还在查阅资料，看看格式具体是什么</p>
<p>后来重新看了遍文章，连接其实都是由mongodb这个package弄得，connect-mongodb是用来保存回话信息的。。<br>请在app.js的store: new MongoStore({下增加username和password来保证connect-mongodb的正常使用<br>mongodb的文档我还在翻阅，希望能找到方法</p>
<p>翻着url连接偶然想起一个方法<br>在setting.js的host的localhost前面加&quot;用户名:密码@&quot;（不要引号）就可以了<br>其实和url建立连接的原理相同<br>app.js的那个username必须是在指定数据库创建的，admin创建的全局用户不行</p>
<p>楼主，第四章的时候为什么我的评论写不到数据库中，评论的form是提交到post,但是index.js中的post是：<br> app.post(&#39;/post&#39;, checkLogin);<br>  app.post(&#39;/post&#39;,function(req,res){<br>        var currentUser = req.session.user,<br>      post = new Post(currentUser.name, req.body.title, req.body.post);<br>      post.save(function(err){<br>        if(err){<br>          req.flash(&#39;error&#39;, err);<br>          return res.redirect(&#39;/&#39;);<br>        }<br>        req.flash(&#39;success&#39;, &#39;发布成功!&#39;);<br>        res.redirect(&#39;/&#39;);<br>      });<br>  });<br>  并没有有关处理comment的内容啊？请问评论的内容是如果写入到数据库中的？？<br>  期待楼主指教，</p>
<p>咦？你的 comment.js 呢？ <code>app.post(&#39;/u/:name/:day/:title&#39;)</code> 是处理留言的。</p>
<p>不好意思贴错了：<br>app.post(&#39;/u/:name/:day/:title&#39;, function(req,res){<br>    var date = new Date(),<br>        time = date.getFullYear() + &quot;-&quot; + (date.getMonth()+1) + &quot;-&quot; + date.getDate() + &quot; &quot; + date.getHours() + &quot;:&quot; + date.getMinutes(),<br>        comment = {&quot;name&quot;:req.body.name, &quot;email&quot;:req.body.email, &quot;website&quot;:req.body.website, &quot;time&quot;:time, &quot;content&quot;:req.body.content};<br>    var newComment = new Comment(req.params.name, req.params.day, req.params.title, comment);<br>    newComment.save(function(err){<br>      if(err){<br>        req.flash(&#39;error&#39;,err);<br>        return res.redirect(&#39;/&#39;);<br>      }<br>      req.flash(&#39;success&#39;, &#39;留言成功!&#39;);<br>      res.redirect(&#39;back&#39;);<br>    });<br>  });</p>
<p>  comment.js是有的，留言的时候也提示留言成功了，也没有报错，</p>
<p>留言成功了，显示不了留言还是怎么？</p>
<p>显示留言成功了，但是我到数据库中查询的结果是：</p>
<blockquote>
<p>db.posts.find();<br>{ &quot;name&quot; : &quot;Dn9x&quot;, &quot;time&quot; : { &quot;date&quot; : ISODate(&quot;2013-06-01T07:29:48.298Z&quot;), &quot;yea<br>r&quot; : 2013, &quot;month&quot; : &quot;2013-6&quot;, &quot;day&quot; : &quot;2013-6-1&quot;, &quot;minute&quot; : &quot;2013-6-1 15:29&quot; }<br>, &quot;title&quot; : &quot;this is First&quot;, &quot;post&quot; : &quot;this is my First,\r\nI real happy!&quot;, &quot;com<br>ments&quot; : [ ], &quot;_id&quot; : ObjectId(&quot;51a9a2ec425e47c816000002&quot;) }<br>{ &quot;name&quot; : &quot;Dn9x&quot;, &quot;time&quot; : { &quot;date&quot; : ISODate(&quot;2013-06-01T07:30:30.592Z&quot;), &quot;yea<br>r&quot; : 2013, &quot;month&quot; : &quot;2013-6&quot;, &quot;day&quot; : &quot;2013-6-1&quot;, &quot;minute&quot; : &quot;2013-6-1 15:30&quot; }<br>, &quot;title&quot; : &quot;CSS: generated content 1&quot;, &quot;post&quot; : &quot;this is about css and Hmtl???\<br>r\ni like css  and html\r\n<em>this is good</em>&quot;, &quot;comments&quot; : [ ], &quot;_id&quot; : ObjectId(&quot;<br>51a9a316425e47c816000003&quot;) }</p>
</blockquote>
<p>所以就没有留言显示，但是保存的时候却提示留言成功！</p>
<p>贴出你的 comment.ejs 和 comment.js 我看看</p>
<p><a href="https://github.com/nswbmw/N-blog/wiki/%E7%AC%AC%E5%9B%9B%E7%AB%A0--%E5%AE%9E%E7%8E%B0%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD">https://github.com/nswbmw/N-blog/wiki/%E7%AC%AC%E5%9B%9B%E7%AB%A0--%E5%AE%9E%E7%8E%B0%E7%95%99%E8%A8%80%E5%8A%9F%E8%83%BD</a></p>
<p>楼主，我刚才是直接复制的你这一章的comment.js和comment.ejs的代码，上面的步骤我也是照着来的，</p>
<p>这个是comment.js</p>
<p>var mongodb = require(&#39;./db&#39;);</p>
<p>function Comment(name, day, title, comment) {<br>  this.name = name;<br>  this.day = day;<br>  this.title = title;<br>  this.comment = comment;<br>}</p>
<p>module.exports = Comment;</p>
<p>Comment.prototype.save = function(callback) {<br>  var name = this.name,<br>      day = this.day,<br>      title = this.title,<br>      comment = this.comment;<br>  mongodb.open(function (err, db) {<br>    if (err) {<br>      return callback(err);<br>    }<br>    db.collection(&#39;posts&#39;, function (err, collection) {<br>      if (err) {<br>        mongodb.close();<br>        return callback(err);<br>      }<br>      //通过用户名、发表日期及标题查找文档，并把一条留言添加到该文档的 comments 数组里<br>      collection.findAndModify({&quot;name&quot;:name,&quot;time.day&quot;:day,&quot;title&quot;:title}<br>      , &#39;time&#39;,-1<br>      , {$push:{&quot;comments&quot;:comment}}<br>      , {new: true}<br>      , function (err,comment) {<br>          mongodb.close();<br>          callback(null);<br>      });<br>    });<br>  });<br>};</p>
<p>@<a href="/user/xiuxu123">xiuxu123</a> 把你错误的代码打包发到 gxqzk@126.com 我看看哪里出问题了</p>
<p>@<a href="/user/nswbmw">nswbmw</a> 谢谢你了，我直接下载您的源码然后运行，我就直接看你的源码了，其实我主要是想使用MySql,不过也已经可以了，谢谢您了，以后还请多多指教</p>
<p>第四章我出了一个错误是</p>
<pre class="prettyprint"><code>doc.comments.forEach(function(comment){
  comment.content = markdown.toHTML(comment.content);
});</code></pre>
<p>说这个doc.comments是undefined，找了一天没找到原因，求助</p>
<div class="title"><a href="http://cnodejs.org/topic/50f6bc56df9e9fcc58745985" target="_blank">
      大家多用 Markdown 吧, 写了份说明, 方便找教程
    </a>7-10 12:07</div><p>希望不熟悉 Markdown 的同学参照 GFM 语法标记好代码, 别让页面太难看 :)<br><a href="http://jiyinyiyong.github.com/article/06-use-gfm-please/page/">原文</a></p>
<hr>
<h1>Markdown 是什么</h1>
<p>关于这一点, <a href="http://zh.wikipedia.org/zh/Markdown">Wiki</a> 上最为明确了, 直接就上用法<br>中文的好的教程还有 <a href="http://wowubuntu.com/markdown/">WOW Ubuntu</a> 的教程, 非常详细, 猜是<a href="http://markdown.tw/">翻译</a><br><a href="http://www.yangzhiping.com/tech/r-markdown-knitr.html">阳志平的个人网站</a>写的说明也听好动懂的<br>教程还有<a href="http://www.stack.nl/~dimitri/doxygen/manual/markdown.html">更多</a>以及<a href="http://www.showdown.im/">更多</a>的版本</p>
<p>Markdown 项目主页在 <a href="http://en.wikipedia.org/wiki/Daring_Fireball">Daring Fireball</a> 的<a href="http://daringfireball.net/projects/markdown/">网站上有具体的说明</a><br>一篇题名 <a href="http://www.codinghorror.com/blog/2012/10/the-future-of-markdown.html">The Future of Markdown</a> 讲述了 Markdown 的现状<br>Markdown 是一门缺乏标准的语言, 在 Github, StackOverflow 都有各自的特性<br>国内的 <a href="http://cnodejs.org/">CNode</a>, <a href="http://ruby-china.org/topics">Ruby-China</a>, <a href="http://python-china.org/">Python-China</a> 论坛应该借鉴自 Github</p>
<h2>个人经历</h2>
<p>目前 Markdown 有多个实现, 这个问题我当初非常纠结地问过,<br>逛 Github 多了, 慢慢熟悉了 Github 自己的 Markdown 方言 <a href="http://github.github.com/github-flavored-markdown/">GFM</a><br>我现在用 <a href="https://github.com/chjj/marked">Marked</a> 这个支持 GFM 的版本来麻页面</p>
<p>网上用的标记, 主要是链接, 代码, 其他在一般帖子里不太需要<br>至少, 这两样功能必须优化到极致的, 在编辑方面必须要足够轻松<br>而 Markdown 的好处, 也在于直接作为纯文本编辑, 不用多么复杂</p>
<h1>GFM 的语法</h1>
<h2>链接</h2>
<p>首先链接在 GFM 里是自动标记的, 而原始的版本要加 <code>&lt;&gt;</code>:</p>
<p><a href="http://daringfireball.net/">http://daringfireball.net/</a><br><a href="http://daringfireball.net/">http://daringfireball.net/</a></p>
<pre class="prettyprint"><code>http://daringfireball.net/
&lt;http://daringfireball.net/&gt;</code></pre>
<p>也可以直接嵌在文字当中, 比如标记一个 <a href="http://lyric.im/ma-de-markdown-wysiwyg-editor/">MaDe 编辑器</a></p>
<pre class="prettyprint"><code>也可以直接嵌在文字当中, 比如标记一个 [MaDe 编辑器](http://lyric.im/ma-de-markdown-wysiwyg-editor/)</code></pre>
<p>或者比如说<a href="http://markedapp.com/">另一个名叫 marked 的 iOS 应用</a>我没装过的 - -!</p>
<pre class="prettyprint"><code>或者比如说[另一个名叫 marked 的 iOS 应用][app]我没装过的 - -!
[app]: http://markedapp.com/</code></pre>
<h2>代码</h2>
<p>代码有句中的代码, 代码块, 都是用的 <code>` </code> 作为符号标记的<br>句中用 <code>1</code> 个或者 <code>2</code> 个, 而代码块用 <code>3</code> 个单独作为行的反引号<br>Github 也许无法很好解析这些细节, Marked 却是可以的</p>
<pre class="prettyprint"><code>代码有句中的代码, 代码块, 都是用的 `` ` `` 作为符号标记的
句中用 `1` 个或者 `2` 个, 而代码块用 `3` 个单独作为行的反引号
Github 也许无法很好解析这些细节, Marked 却是可以的</code></pre>
<p>另外 Github 上在代码块第一行反引号之后可以声明语法<br>比如 JS 下面这样就会被在 HTML 标记上一些属性<br>Github 站点上会直接对代码形成语法高亮, 其他很多模块也借鉴了</p>
<pre class="prettyprint">
```js
console.log('这里有问题, 我的反引号是写在下一行的 -&gt;');
```
</pre>

<p>另外 <a href="https://github.com/chjj/marked#usage">marked</a> 就可以配合 <a href="http://softwaremaniacs.org/soft/highlight/en/">Highlight.js</a> 在编译时高亮代码, 方便博客排版</p>
<h2>图片</h2>
<p>图片的标记和链接非常相似, 方括号文本部分在对应图片的 alt 属性, 后边括号是网址:</p>
<p><img src="http://d2o0t5hpnwv4c1.cloudfront.net/2063_markdown/preview.png" alt="Mark-Up"></p>
<p><img src="http://octodex.github.com/images/aidorucat.png" alt="Mark-Down"></p>
<p><a href="http://octodex.github.com/codercat"><img src="http://octodex.github.com/images/codercat.jpg" alt="Mark-Down"></a></p>
<pre class="prettyprint"><code>![Mark-Up](http://d2o0t5hpnwv4c1.cloudfront.net/2063_markdown/preview.png)

![Mark-Down][cat-girl]
[cat-girl]: http://octodex.github.com/images/aidorucat.png

[![Mark-Down][cat-boy]][octocat]
[cat-boy]: http://octodex.github.com/images/codercat.jpg
[octocat]: http://octodex.github.com/codercat</code></pre>
<p>带链接的图片比较搞, 其实还不如直接在里边写 HTML,<br>但说回来, 允许 HTML 实在是危险的, 有时候就要进行过滤, 比如 CNode 上做的</p>
<h2>文本样式</h2>
<p>另外还有 <code>&gt;</code> 开头的引用,</p>
<blockquote>
<p>Aaron Swartz</p>
</blockquote>
<p><code>**</code> 包围的 <strong>加粗</strong>, <code>*</code> 包围的 <em>斜体</em>, <code>~</code> 包围的删除线等等,<br>甚至用 HTML 标签直接添加 Markdown 不直接支持的样式可以</p>
<ul>
<li>还有列表之类的功能</li>
<li>这里是无序的列表, 用 <code>*</code> 写在巷头即可</li>
</ul>
<p>还有有序列表</p>
<ol>
<li>有序列表大概的样子和无序列表一样</li>
<li>然后数字写在行开头标记</li>
</ol>
<pre class="prettyprint"><code>另外还有 `&gt;` 开头的引用,

&gt; Aaron Swartz

`**` 包围的 **加粗**, `*` 包围的 *斜体*, `~` 包围的删除线等等,
甚至用 HTML 标签直接添加 Markdown 不直接支持的样式可以

* 还有列表之类的功能
* 这里是无序的列表, 用 `*` 写在巷头即可

还有有序列表

1. 有序列表大概的样子和无序列表一样
2. 然后数字写在行开头标记</code></pre>
<ul>
<li>标题</li>
</ul>
<p>标题是用 <code>#</code> 写在行头来标记的, 比如 <code># ## ### ######</code> 对应 <code>h1</code> 到 <code>h6</code> 标签<br>一个比较方便的写法是用 <code>------ ======</code> 线来标记标题, 比如下面的:</p>
<h3>h3</h3>
<h4>h4</h4>
<h2>h2</h2>
<h1>h1</h1>
<pre class="prettyprint"><code>### h3
#### h4

h2
------

h1
======</code></pre>
<p>不过在文本中肆意使用标题也不是多好的办法, 尽量保证文本清晰才好</p>
<p>还有注意换行, 因为 <code>------</code> 上下被空行包裹时是个 <code>&lt;hr&gt;</code> 分割线<br>Markdown 其实很多地方要留意空行的, 也许会出现意外</p>
<h1>多用 GFM</h1>
<p>更多的细节, 看文档比看我介绍一遍要轻松多了<br>论坛上看到好多 Markdown 标记失败的帖子, 别提多伤心了</p>
<p>作为 Coder, 对编辑器字体和高亮各种挑剔, 我想大多数人都是有体会的<br>没有高亮, 没有等宽字体, 甚至手写的代码, 那都是多不自在的<br>Markdown 无疑是对于网页一个更好的解决方式<br>除非有一天, 我们直接在网页上嵌入代码编辑器专门处理代码<br>或者有发明出强大的代码图片和链接可视化编辑工具, 那另当别论</p>
<p>最后链上一份各种标记语言的对比, 至少看下喜欢哪个 ;p<br><a href="http://www.worldhello.net/gotgithub/appendix/markups.html">http://www.worldhello.net/gotgithub/appendix/markups.html</a></p>
<p>我看你发的那个人用eido而非mk，这是什么东西，你能翻点东西给我们吗？<br>摘要那位大神的话</p>
<pre class="prettyprint"><code>现在的 typeof.net 里面一个动态文件也没有，所有的东西都是用 eidoc 从 .ed 文件生成的 HTML。你也许会问我为什么不用 markdown 这种流行物，我要说，markdown 没有宏，没法作出 eido 这种逆天的效果。整个 typeof.net 我没有写一行 HTML，所有的东西都是 eidoc 生成的。</code></pre>
<p>貌似是他自己做的标记语言, 相关的信息我找不出来, Github 链接他文章里倒是有</p>
<p>那个神人就是这个神人吧。<br>对 eidoc 同感兴趣。感觉和 MARKDOWN 平行的一种工具。</p>
<p>伤不起了, 这里跟 Marked 相比语法支持又少了, 大量出错 - -!</p>
<p>厄，我们就是使用它的啊</p>
<p>@<a href="/user/suqian">suqian</a> 这是半年前的帖子啊亲</p>
<p>支持md，以后基本都是fe基本技能了</p>
<p>方括号文本部分在对应图片的 title, 后边括号是网址</p>
<p>这个有问题吧，方括号是alt吧？</p>
<p>看得超细.. 我记混了, 订正了</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 赞~</p>
<p><code>this is cod test</code></p>
<p>模板引擎吗</p>
<p>标记语言而已, 不是模板引擎. 标记语言平常写博客和评论里加样式用的,<br>比如 ~呵呵~, <strong>呵呵</strong>, <strong>呵呵</strong></p>
<div class="title"><a href="http://cnodejs.org/topic/50ce892c637ffa41558e743b" target="_blank">
      如何从appfog导出数据库文件？
    </a>58 分钟前</div><p>我想把appfog上的mongodb的数据库文件导出来下载到本机，如何操作？求助</p>
<p>搭建一个phpMyAdmin来管理数据库！</p>
<p>phpMyAdmin可以管理mongo吗？我没试过，但是搜索出来都是Mysql管理工具phpMyAdmin</p>
<p> @<a href="/user/cony138">cony138</a> @<a href="/user/cony138">cony138</a> 是在用mongodb么？ mysql的也一样，详细请看文档~~<a href="http://blog.appfog.com/manage-your-appfog-data-from-your-workstation/">Manage your AppFog data from your workstation</a> ，还有这个<a href="http://blog.csdn.net/llmlx/article/details/7762367">nodejs与cloudfoundry之二:tunnel to mongodb</a></p>
<p>mygod,还要学php么。</p>
<div class="title"><a href="http://cnodejs.org/topic/516b64596d38277306407936" target="_blank">
      Node.js 异步异常的处理与domain模块解析
    </a>4-15 10:22</div><h3>异步异常处理</h3>
<h4>异步异常的特点</h4>
<p>由于node的回调异步特性，无法通过<code>try catch</code>来捕捉所有的异常：   </p>
<pre class="prettyprint"><code>try {
  process.nextTick(function () {
      foo.bar();
  });
} catch (err) {
  //can not catch it
}</code></pre>
<p>而对于web服务而言，其实是非常希望这样的：   </p>
<pre class="prettyprint"><code>//express风格的路由
app.get(&#39;/index&#39;, function (req, res) {
  try {
    //业务逻辑
  } catch (err) {
    logger.error(err);
    res.statusCode = 500;
    return res.json({success: false, message: &#39;服务器异常&#39;});
  }
});</code></pre>
<p>如果<code>try catch</code>能够捕获所有的异常，这样我们可以在代码出现一些非预期的错误时，能够记录下错误的同时，友好的给调用者返回一个500错误。可惜，<code>try catch</code>无法捕获异步中的异常。所以我们能做的只能是：  </p>
<pre class="prettyprint"><code>app.get(&#39;/index&#39;, function (req, res) {
  // 业务逻辑  
});

process.on(&#39;uncaughtException&#39;, function (err) {
  logger.error(err);
});</code></pre>
<p>这个时候，虽然我们可以记录下这个错误的日志，且进程也不会异常退出，但是我们是没有办法对发现错误的请求友好返回的，只能够让它超时返回。  </p>
<h4>domain</h4>
<p>在node v0.8+版本的时候，发布了一个模块<code>domain</code>。这个模块做的就是<code>try catch</code>所无法做到的：捕捉异步回调中出现的异常。<br>于是乎，我们上面那个无奈的例子好像有了解决的方案：   </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);

//引入一个domain的中间件，将每一个请求都包裹在一个独立的domain中
//domain来处理异常
app.use(function (req,res, next) {
  var d = domain.create();
  //监听domain的错误事件
  d.on(&#39;error&#39;, function (err) {
    logger.error(err);
    res.statusCode = 500;
    res.json({sucess:false, messag: &#39;服务器异常&#39;});
    d.dispose();
  });

  d.add(req);
  d.add(res);
  d.run(next);
});

app.get(&#39;/index&#39;, function (req, res) {
  //处理业务
});</code></pre>
<p>我们通过中间件的形式，引入domain来处理异步中的异常。当然，domain虽然捕捉到了异常，但是还是由于异常而导致的堆栈丢失会导致内存泄漏，所以出现这种情况的时候还是需要重启这个进程的，有兴趣的同学可以去看看<a href="https://github.com/fengmk2/domain-middleware">domain-middleware</a>这个domain中间件。  </p>
<h3>诡异的失效</h3>
<p>我们的测试一切正常，当正式在生产环境中使用的时候，发现<code>domain</code>突然失效了！它竟然没有捕获到异步中的异常，最终导致进程异常退出。经过一番排查，最后发现是由于引入了redis来存放session导致的。   </p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);
var connect = require(&#39;connect&#39;);
var RedisStore = require(&#39;connect-redis&#39;)(connect);
var domainMiddleware = require(&#39;domain-middleware&#39;);

var server = http.createServer();
var app = connect();
app.use(connect.session({
  key: &#39;key&#39;,
  secret: &#39;secret&#39;,
  store: new RedisStore(6379, &#39;localhost&#39;)
}));
//domainMiddleware的使用可以看前面的链接
app.use(domainMiddleware({
  server: server,
  killTimeout: 30000
}));</code></pre>
<p>此时，当我们的业务逻辑代码中出现了异常，发现竟然没有被<code>domain</code>捕获！经过一番尝试，终于将问题定位到了：  </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);
var redis = require(&#39;redis&#39;);
var cache = redis.createClient(6379, &#39;localhost&#39;);

function error() {
  cache.get(&#39;a&#39;, function () {
    throw new Error(&#39;something wrong&#39;);
  });
}

function ok () {
  setTimeout(function () {
    throw new Error(&#39;something wrong&#39;);
  }, 100);
}
var d = domain.create();
d.on(&#39;error&#39;, function (err) {
  console.log(err);
});

d.run(ok);    //domain捕获到异常
d.run(error); //异常被抛出</code></pre>
<p>奇怪了！都是异步调用，为什么前者被捕获，后者却没办法捕获到呢？   </p>
<h3>Domain剖析</h3>
<p>回过头来，我们来看看domain做了些什么来让我们捕获异步的请求(代码来自node v0.10.4，此部分可能正在快速变更优化)。如果对domain还不甚了解的同学可以先简单过一下domain的<a href="nodejs.org/api/domain.html">文档</a>。  </p>
<h4>node事件循环机制</h4>
<p>在看Domain的原理之前，我们先要了解一下<code>nextTick</code>和<code>_tickCallback</code>的<a href="https://github.com/joyent/node/blob/v0.10.4/src/node.js#L395">两个方法</a>。  </p>
<pre class="prettyprint"><code>function laterCall() {
  console.log(&#39;print me later&#39;);
}

process.nextTick(laterCallback);
console.log(&#39;print me first&#39;);</code></pre>
<p>上面这段代码写过node的人都很熟悉，<code>nextTick</code>的作用就是把laterCallback放到下一个事件循环去执行。而<code>_tickCallback</code>方法则是一个非公开的方法，这个方法是在当前时间循环结束之后，调用之以继续进行下一个事件循环的入口函数。  </p>
<p>换而言之，node为事件循环维持了一个队列，<code>nextTick</code>入队，<code>_tickCallback</code>出列。  </p>
<h4>domain的实现</h4>
<p>在了解了node的事件循环机制之后，我们再来看看domain做了些什么。<br>domain自身其实是一个<code>EventEmitter</code>对象，它通过事件的方式来传递捕获的错误。这样我们在研究它的时候，就简化到两个点：  </p>
<ul>
<li><p>什么时候触发domain的<code>error</code>事件：  </p>
<ul>
<li>进程抛出了异常，没有被任何的<code>try catch</code>捕获到，这时候将会触发整个process的<code>processFatal</code>，此时如果在domain包裹之中，将会在domain上触发<code>error</code>事件，反之，将会在process上触发<code>uncaughtException</code>事件。   </li>
</ul>
</li>
<li><p>domain如何在多个不同的事件循环中传递：     </p>
<ol>
<li>当domain被实例化之后，我们通常会调用它的<code>run</code>方法（如之前在web服务中的使用），来将某个函数在这个domain示例的包裹中执行。被包裹的函数在执行的时候，<code>process.domain</code>这个全局变量将会被指向这个domain实例。当这个事件循环中，抛出异常调用<code>processFatal</code>的时候，发现<code>process.domain</code>存在，就会在domain上触发<code>error</code>事件。   </li>
<li><p>在require引入domain模块之后，会重写全局的<code>nextTick</code>和<code>_tickCallback</code>,注入一些domain相关的<a href="https://github.com/joyent/node/blob/v0.10.4/src/node.js#L426">代码</a>：</p>
<pre class="prettyprint"><code>//简化后的domain传递部分代码
function nextDomainTick(callback) {
 nextTickQueue.push({callback: callback, domain: process.domain});
}

function _tickDomainCallback() {
 var tock = nextTickQueue.pop();
 //设置process.domain = tock.domain
 tock.domain &amp;&amp; tock.domain.enter();
 callback();
 //清除process.domain
 tock.domain &amp;&amp; tock.domain.exit();        
 }
};</code></pre>
</li>
</ol>
<p>这个是其在多个事件循环中传递domain的关键：<code>nextTick</code>入队的时候，记录下当前的domain，当这个被加入队列中的事件循环被<code>_tickCallback</code>启动执行的时候，将新的事件循环的<code>process.domain</code>置为之前记录的<code>domain</code>。这样，在被<code>domain</code>所包裹的代码中，不管如何调用<code>process.nextTick</code>, domain将会一直被传递下去。   </p>
<ol>
<li>当然，node的异步还有两种情况，一种是<code>event</code>形式。因此在<code>EventEmitter</code>的<a href="https://github.com/joyent/node/blob/master/lib/events.js#L28">构造函数</a>有如下代码：  </li>
</ol>
<pre class="prettyprint"><code>  if (exports.usingDomains) {
    // if there is an active domain, then attach to it.
    domain = domain || require(&#39;domain&#39;);
    if (domain.active &amp;&amp; !(this instanceof domain.Domain)) {
      this.domain = domain.active;
    }
  }</code></pre>
<p>实例化<code>EventEmitter</code>的时候，将会把这个对象和当前的domain绑定，当通过<code>emit</code>触发这个对象上的事件时，像<code>_tickCallback</code>执行的时候一样，回调函数将会重新被当前的<code>domain</code>包裹住。   </p>
<ol>
<li>而另一种情况，是<code>setTimeout</code>和<code>setInterval</code>，同样的，在<code>timer</code>的源码中，我们也可以发现这样的一句<a href="https://github.com/joyent/node/blob/master/lib/timers.js#L214">代码</a>:   </li>
</ol>
<pre class="prettyprint"><code> if (process.domain) timer.domain = process.domain;</code></pre>
<p>跟<code>EventEmmiter</code>一样，之后这些<code>timer</code>的回调函数也将被当前的domain包裹住了。   </p>
</li>
</ul>
<p><strong>node通过在<code>nextTick</code>, <code>timer</code>, <code>event</code>三个关键的地方插入domain的代码，让它们得以在不同的事件循环中传递。</strong></p>
<h4>更复杂的domain</h4>
<p>有些情况下，我们可能会遇到需要更加复杂的domain使用。   </p>
<ul>
<li>domain嵌套：我们可能会外层有domain的情况下，内层还有其他的domain，使用情景可以在文档中<a href="http://nodejs.org/api/domain.html#domain_explicit_binding">找到</a>  </li>
</ul>
<pre class="prettyprint"><code>// create a top-level domain for the server
var serverDomain = domain.create();

serverDomain.run(function() {
  // server is created in the scope of serverDomain
  http.createServer(function(req, res) {
    // req and res are also created in the scope of serverDomain
    // however, we&#39;d prefer to have a separate domain for each request.
    // create it first thing, and add req and res to it.
    var reqd = domain.create();
    reqd.add(req);
    reqd.add(res);
    reqd.on(&#39;error&#39;, function(er) {
      console.error(&#39;Error&#39;, er, req.url);
      try {
        res.writeHead(500);
        res.end(&#39;Error occurred, sorry.&#39;);
      } catch (er) {
        console.error(&#39;Error sending 500&#39;, er, req.url);
      }
    });
  }).listen(1337);
});</code></pre>
<p>为了实现这个功能，其实domain还会偷偷的自己维持一个domain的stack，有兴趣的童鞋可以在<a href="https://github.com/joyent/node/blob/v0.10.4/lib/domain.js#L44">这里</a>看到。   </p>
<h4>回头解决疑惑</h4>
<p>回过头来，我们再来看刚才遇到的问题：为什么两个看上去都是同样的异步调用，却有一个domain无法捕获到异常？理解了原理之后不难想到，肯定是调用了redis的那个异步调用在抛出错误的这个事件循环内，是不在domain的范围之内的。我们通过一段更加简短的代码来看看，到底在哪里出的问题。   </p>
<pre class="prettyprint"><code>var domain = require(&#39;domain&#39;);
var EventEmitter = require(&#39;events&#39;).EventEmitter;

var e = new EventEmitter();

var timer = setTimeout(function () {
  e.emit(&#39;data&#39;);  
}, 10);

function next() {
  e.once(&#39;data&#39;, function () {
    throw new Error(&#39;something wrong here&#39;);
  });
}

var d = domain.create();
d.on(&#39;error&#39;, function () {
  console.log(&#39;cache by domain&#39;);
});

d.run(next);</code></pre>
<p> 此时我们同样发现，错误不会被domain捕捉到，原因很清晰了：<code>timer</code>和<code>e</code>两个关键的对象在初始化的时候都时没有在domain的范围之内，因此，当在<code>next</code>函数中监听的事件被触发，执行抛出异常的回调函数时，其实根本就没有处于domain的包裹中，当然就不会被<code>domain</code>捕获到异常了！   </p>
<p>其实node针对这种情况，专门设计了一个<a href="http://nodejs.org/api/domain.html#domain_domain_add_emitter">API：domain.add</a>。它可以将domain之外的<code>timer</code>和<code>event</code>对象，添加到当前domain中去。对于上面那个例子：   </p>
<pre class="prettyprint"><code>d.add(timer);
//or
d.add(e);</code></pre>
<p>将<code>timer</code>或者<code>e</code>任意一个对象添加到domain上，就可以让错误被domain捕获了。   </p>
<p>再来看最开始<code>redis</code>导致domain无法捕捉到异常的问题。我们是不是也有办法可以解决呢？<br>看<a href="http://weibo.com/81715239">@python发烧友</a> 的这条<a href="http://weibo.com/1640328892/zrP7PdLkG">微博</a>我们就能理解，其实对于这种情况，还是没有办法实现最佳的解决方案的。现在对于非预期的异常产生的时候，我们只能够让当前请求超时，然后让这个进程停止服务，之后重新启动。<a href="https://github.com/fengmk2/graceful">graceful</a>模块配合<code>cluster</code>就可以实现这个解决方案。  </p>
<p><strong><code>domain</code>十分强大，但不是万能的。</strong>希望在看过这篇文章之后，大家能够正确的使用domian，避免踩坑。:)</p>
<hr>
<h4>题外推荐</h4>
<p>在整个问题排查与代码研究过程中，有一个工具起了巨大的作用：<code>node-inspector</code>，它可以让node代码在chrome下进行单步调试，能够跟进到node源码之中，<a href="http://weibo.com/goddyzhao">@<a href="/user/goddyzhao">goddyzhao</a></a>的文章<a href="http://blog.goddyzhao.me/post/11522397416/how-to-debug-node-with-node-inspector">使用node-inspector来调试node</a>详细介绍了如何使用<code>node-inspector</code>。</p>
<p>好文，支持，收藏了。</p>
<p>非常精彩的文章，domain运行机制剖析很明了。domain很美好，但要成长为一个成熟稳定的node模块，还有一段很长的路呢。</p>
<p>顶起.</p>
<p>不错，</p>
<p>好东西 ！～～～～～～～～～～～～</p>
<p>您好，DeNA在招聘资深Node.js的职位，您有兴趣了解一下吗？</p>
<p>可不可以这么说 目前的domain配合最后的退出进程再重启是现行最好的方案？</p>
<p>domain 不能捕获全部异常，还得配合 <code>process.on(&quot;uncaughtException&quot;)</code> 和 优雅退出。</p>
<p> @<a href="/user/suqian">suqian</a> 我很认同你说的话，<code>process.on(&quot;uncaughtException&quot;)</code>在servers中可以进行整个错误的抓包处理，domain我觉得楼主给的方案还不是很成熟，另外在写代码的时候应封装好，对错误做回调处理，如：<br><code>var login = function(fn) { var results = 1 + 2; return fn(err,results);}</code> 调用代码:</p>
<pre class="prettyprint"><code>login(function(err, cookie) {});</code></pre>
<p>之前nodejs官网并未发布异步回调所产生错误的解决方案我想应该是本身nodejs语言所致，所以我觉得能利用本身的语言特点去解决才最好</p>
<p>@<a href="/user/ym1623">ym1623</a> 所有的异步调用的异常，都是通过回调函数的第一个参数返回的。我们需要domain并不是因为想要去代替这种形式。尽管domain的api里面有这样的用法：   </p>
<pre class="prettyprint"><code>var d = domain.create();

function readSomeFile(filename, cb) {
  fs.readFile(filename, &#39;utf8&#39;, d.intercept(function(data) {
    // note, the first argument is never passed to the
    // callback since it is assumed to be the &#39;Error&#39; argument
    // and thus intercepted by the domain.

    // if this throws, it will also be passed to the domain
    // so the error-handling logic can be moved to the &#39;error&#39;
    // event on the domain instead of being repeated throughout
    // the program.
    return cb(null, JSON.parse(data));
  }));
}

d.on(&#39;error&#39;, function(er) {
  // an error occurred somewhere.
  // if we throw it now, it will crash the program
  // with the normal line number and stack message.
});</code></pre>
<p>这可能是node尝试通过domain来统一处理嵌套异步回调中的异常。 但是由于文章中所描述的domain的一些问题，这个暂时还不是很好用。不过异步流程工具已经很多了。只要按照约定，把错误放在callback的第一个参数返回。可以有很多种工具来优化代码。    </p>
<p>我们使用domain的原因，只是为了捕获那些意料之外的错误，例如：  </p>
<pre class="prettyprint"><code>if (!data.length) {
  //do something
}</code></pre>
<p>类似这种不小心出现的错误，如果真的在线上出现了，我们想要把这个错误记录下来以便之后的修改，同时可以给前端一个友好的500响应，而不是只能超时返回（因为用uncaughtException捕捉到的异常，我们也没有办法知道这个异常是在哪个请求出现的）。      </p>
<p>@dead_horse 我一般都是这样做的：process.on(&#39;uncaughtException&#39;, console.dir);直接把错误信息打印在控制台中或者写在日志中</p>
<p>@<a href="/user/ym1623">ym1623</a> 嗯， 为什么我们想要用domain替代这种方案的原因在node<a href="http://www.nodejs.org/api/process.html#process_event_uncaughtexception">文档</a>中提到了。</p>
<blockquote>
<p>Note that uncaughtException is a very crude mechanism for exception handling and may be removed in the future.<br>Don&#39;t use it, use domains instead. If you do use it, restart your application after every unhandled exception!</p>
</blockquote>
<p>所以我们最终在domain有缺陷的情况下，只能使用<a href="https://github.com/TBEDP/show-me-the-code/blob/master/2013/0419/suqian.md">graceful</a>的这个并不完美的解决方案。  </p>
<p>@dead_horse 我觉得还是写测试代码好点，在把项目推上去的时候先运行npm test一次，保证代码质量不出错，node服务抓错防止服务不挂掉也是不错的，但是现在没有一个成熟的方案出来，先写个process.on(&#39;uncaughtException&#39;, console.dir)用着也可以.</p>
<p>@<a href="/user/ym1623">ym1623</a> 那肯定是要自己代码保证不出错啊。domain和uncaoughtException都只是预防意外而已。:)</p>
<p>@dead_horse 我之前无意间用forever watch一个文件作为项目目录时，在出错的时候我将错误log指定到该项目中，这样的话项目一报错的话就会在在该项目下的错误log中写入错误日志，而forever watch此时就起作用了，以为项目有改动自动重启，不知道这个算不算一个取巧.</p>
<p>学习了，支持好文章</p>
<div class="title"><a href="http://cnodejs.org/topic/51deb54bf4963ade0e2b3433" target="_blank">
      fs.write函数参数里面position的作用
    </a>1 小时前</div><p>我写的函数：<br><code>writeToFileFromTop: (src, content)-&gt;
      content = new Buffer content
        fs.open src, &#39;a&#39;, (err, fd)-&gt;
            throw err if err
            position = 0
            fs.write fd, content, 0, content.length, position, (err)-&gt;
                throw err if err
                fs.closeSync fd</code><br>但是无论position设值为多少，他都把内容插入到文件的最后，position好像不起作用，<br>我是想把内容插入到文件的头部，请问应该怎么做？</p>
<pre class="prettyprint"><code>writeToFileFromTop: (src, content)-&gt;
  content = new Buffer content
  fs.open src, &#39;a&#39;, (err, fd)-&gt;
    throw err if err
    position = 0
    fs.write fd, content, 0, content.length, position, (err)-&gt;
      throw err if err
      fs.closeSync fd</code></pre>
<div class="title"><a href="http://cnodejs.org/topic/51d3dbb3d44cbfa30434df7d" target="_blank">
      前端程序媛实习森求node教学
    </a>24 分钟前</div><p>呃<br>一直听说nodejs酱紫神奇的东西<br>但是入门还是赶脚流程有点难以自学<br>求带上路<br>然后可以把我丢掉让我自己走<br>拜托啦~~<br>  Q 351896959</p>
<p>媛 非 猿 ?估计一群牛人有兴趣了..可惜我菜鸟一个帮不上忙...</p>
<p>媛.....</p>
<p>  共同学习呀。<br>  我也是按照wiki教程初学的。</p>
<p>加我Q 或者 微信 littletree001</p>
<p>对于这种程序猿，我只想对她说：“请联系我！”</p>
<p>怎么联系 求方式 ^_^</p>
<p>老雷我鄙视你~看见妹纸基友都不要了！</p>
<p>@<a href="/user/snoopy">snoopy</a> 物以稀为贵嘛</p>
<p>我勒个去大牛发话了!!!!!</p>
<p>呃 一起来~</p>
<p>哪天 Node 社区也来个 Model 就好了, 全部都变热心人了..<br>我能问下真是女生吗.. 为什么要学前端...</p>
<p>真的是女生啦 学前端都一年半了呀 现在在杭州实习</p>
<p>@<a href="/user/tree0515">tree0515</a> 貌似我碰到新手第一件事就是怂恿学 CoffeScript... JS 太难看了</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 太....难...看.... %&gt;_&lt;%</p>
<p>@<a href="/user/tree0515">tree0515</a> 认同，图灵社区里有本书叫《深入浅出 Coffeescript》，可以看一看。Coffee 确实优美得多<br>(虽然我刚开始用的时候经常不能正确编译成我想要的代码....(光速逃</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd1bd9d44cbfa304338f31" target="_blank">
      Node 中文文档,不可用?
    </a>2 小时前</div><p><a href="http://docs.cnodejs.net/cman/">http://docs.cnodejs.net/cman/</a></p>
<p>404 Not Found : docs.cnodejs.net</p>
<p>这是意外吗?</p>
<p>我刚刚也发现了这问题</p>
<p>老问题.. 一起去 Github 上催一下吧: <a href="https://github.com/cnodejs/nodeclub/issues/191">https://github.com/cnodejs/nodeclub/issues/191</a></p>
<p>这个问题也太久了吧，应该有2个礼拜以上了，我还以为是故意关闭的！</p>
<p>直接看英文的吧,node变化挺快的</p>
<p>看英文吧。。。。没记错的话，中文版是0.6.X的</p>
<div class="title"><a href="http://cnodejs.org/topic/51de0b30f4963ade0e0986e4" target="_blank">
      fjdsajflksajflkjsfsadf
    </a>1 小时前</div><p>dfdsafjlksafdsaddfsdavxv</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a> 劣退, 有這功能嗎XD</p>
<div class="title"><a href="http://cnodejs.org/topic/51d9650ad44cbfa304d545f3" target="_blank">
      国内的前端到底有多牛, 而且为啥都没个论坛的?
    </a>1 小时前</div><p>刚才翻到一篇旧文章: <a href="http://hax.iteye.com/blog/1128269">关于国内前端和JS技术发展的乱想</a><br>讲到国内的前端技术能力上和国外的社区相差不多, 甚至很超前<br>文章里提到的一些人物, 我在关心 Node 时逛微博看 JS 的大神有机会看到过一些..<br>想想我还真是边缘啊, 今年也就蹭了几次 Ruby 线下聚会的样子, 前端哪有聚会?<br>文章还提到关于这个原因是前端的社区意识不强, 因而没有怎么怎么...<br>记得去阿里系工作的学长教我 JS 时说国外的 Backbone Bootstrap 什么, 其实他们早实现了</p>
<p>听到以后, 直到现在我也觉得有点不合理..<br>比国外的实现早, 不代表国外只有一种实现, 而且国外光是 Node 就重复造了很多遍轮子<br>中文社区的有做了类似的又怎么样, 哪里证明了更强了?<br>还有社区.. 国外的 JS 也是 JS 呀, 为什么他们有社区我们就没?</p>
<p>求解惑!!!</p>
<p>我知道有个QQ群 <strong>这可谓是国内最强的QQ群之一</strong></p>
<p><a href="http://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html">http://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html</a></p>
<p>自大到这种地步？</p>
<p>既然 QQ 群, 又要审核, 完全没有加入的欲望了<br>QQ 群是无法形成良好的积淀的地方,,<br>就跟写 JS 不用模块化方案分享代码一样, 用一次不开心一次</p>
<p>司徒正美大神的群啊</p>
<p>@<a href="/user/jiyinyiyong">jiyinyiyong</a>  前端再推荐一个群吧，w3cplus 主要是UI这部分，偏CSS</p>
<p>@<a href="/user/ldjking">ldjking</a> 有 QQ 有微博有 YY, 还是没有独立论坛哎</p>
<p>@<a href="/user/ldjking">ldjking</a> 只能说玩得还可以，称不上大神吧。</p>
<p>对于技术、语言什么的，感觉国外的人看待它们的思维更开放，对流行趋势把握得很准；相比之下国内开发者思维方式内略有些死，甚至只能跟在别人后面走。所以有些在国外很吃香的东西在国内不是那么受重视，例如JavaScript。。。</p>
<p>let&#39;s join here:  <a href="http://yaha.me/">http://yaha.me/</a><br>build with AngularJS<br>the backend is Nodejs(<a href="http://deployd.com">http://deployd.com</a>) </p>
<p>seems the deployd dev guy also team member of the AngularJS?</p>
<div class="title"><a href="http://cnodejs.org/topic/51de8204f4963ade0e25f511" target="_blank">
      有关nodejs-less相关的问题
    </a>5 小时前</div><p>parser.parse(less, function (err, tree) {<br>    //假设less里的变量如 @<a href="/user/color">color</a>:#000</p>
<pre class="prettyprint"><code>//我想操作 让@[color](/user/color)设置成 @[color](/user/color):#fff;
//我在tree里找到有@[color](/user/color)的相关rule，但无从改起，求破，求助攻</code></pre>
<p>});</p>
<div class="title"><a href="http://cnodejs.org/topic/51de6419f4963ade0e207bff" target="_blank">
      Mongo里面dropDatabase之后怎么数据还在。。。
    </a>5 小时前</div><p>网页查看rows, total_rows 全是空的了。<br>但是mongoskin里面还能读到数据。。。<br>怎么让清空数据立即生效。。。<br>= =！</p>
<div class="title"><a href="http://cnodejs.org/topic/51de0a33f4963ade0e094fce" target="_blank">
      如何用nodejs模拟get发送消息？小白提问
    </a>5 小时前</div><pre class="prettyprint"><code>http.get(&quot;http://www.google.com/index.html&quot;, function(res) {
  console.log(&quot;Got response: &quot; + res.statusCode);
}).on(&#39;error&#39;, function(e) {
  console.log(&quot;Got error: &quot; + e.message);
});</code></pre>
<p>我在文档上看到的例子。<br>微信平台验证的时候他们会把发一条GET消息，内容大概是</p>
<pre class="prettyprint"><code>/wechat?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264</code></pre>
<p>但是我想自己本地模拟这个get发一下，验证我的服务器写得对不对，但是，不知道第一参数到底要怎么写？<br>比如写成<br>&quot;<a href="http://127.0.0.1:80/wechat/?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264">http://127.0.0.1:80/wechat/?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=1373464121&amp;nonce=1373366264</a>&quot;<br>但是好像有点问题。</p>
<p>用requests</p>
<p>@<a href="/user/ggaaooppeenngg">ggaaooppeenngg</a> 你這樣寫是沒錯的, 你說的有點問題是出了什麼問題? 是在parse query string方面嗎?</p>
<p>供你參考:</p>
<p><strong>client.js</strong></p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);

http.get(&quot;http://127.0.0.1:3000/wechat?signature=d34f1983fb3ecf933b9435ad5c05b6e3a138a0e5&amp;echostr=5898562696761927225&amp;timestamp=137&quot;, function(res) {
  console.log(&quot;Got response: &quot; + res.statusCode);
}).on(&#39;error&#39;, function(e) {
  console.log(&quot;Got error: &quot; + e.message);
});</code></pre>
<p><strong>server.js</strong></p>
<pre class="prettyprint"><code>var http = require(&#39;http&#39;);
var url = require(&#39;url&#39;);
var qs = require(&#39;querystring&#39;);

http.createServer(function(req, res) {
    res.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});
    var query = url.parse(req.url).query;
    res.end(JSON.stringify(qs.parse(query)));
}).listen(3000);</code></pre>
<div class="title"><a href="http://cnodejs.org/topic/51de195bf4963ade0e0cf46e" target="_blank">
      NAE的文档中心打开失败
    </a>5 小时前</div><p>NAE的 [文档中心]<a href="http://blog.cnodejs.net/post/4e686c290716ac9910000009">http://blog.cnodejs.net/post/4e686c290716ac9910000009</a>)</p>
<div class="title"><a href="http://cnodejs.org/topic/51de5f52f4963ade0e1fd645" target="_blank">
      求解： 包含数组的数据发送到Node服务端后，左中括号被转换的问题
    </a>5 小时前</div><p>在前端， 数据被JSON.stringift 用POST方式发送到node服务端，本来是‘[’符号 被转换成了 &#39;: { &#39;</p>
<p>而为什么要用JSON.stringift，是因为公司的插件的原因。 所以在这里请教这是怎么回事，以及如何破解之妙方！</p>
<p>竟然有此等转换！谁干的！</p>
<div class="title"><a href="http://cnodejs.org/topic/51de1f23f4963ade0e0e42db" target="_blank">
      node.js运行appJS出错，弹出窗提示C++错误
    </a>5 小时前</div><p>如题：<br><img src="http://static.oschina.net/uploads/space/2013/0106/100852_fdmR_143411.png" alt="图"></p>
<p>直接执行APP.exe是可以运行，但是node --harmony app.js跑不起，直接报错了</p>
<p>环境：win7 32bit   node:0.8.18</p>
<p>assertion failed!<br>file: libcef_dll\wrapper\libcef_dll_wrapper.cc</p>
<p>for information on how your program can cause an assertion failure, see the visual c++ documentation on asserts</p>
<div class="title"><a href="http://cnodejs.org/topic/51de26e9f4963ade0e0fa06d" target="_blank">
      安装了node最新版，npm出错，什么情况
    </a>5 小时前</div><p>安装了node最新版本，10.13，但是在npm的时候出错</p>
<p>Cannot find module &#39;delayed-stream&#39;</p>
<p>什么情况</p>
<div class="title"><a href="http://cnodejs.org/topic/5033ab60f767cc9a51ad9bc1" target="_blank">
      AppFog拎包入住指南
    </a>5 小时前</div><p>你也可以在<a href="http://www.imjustfly.net">我的博客</a>阅读这片文章</p>
<p><strong>AppFog</strong>是国外的一个免费应用引擎，类似于SAE、GAE和NAE。它支持Java, Python, Node, .Net, Ruby, PHP, MySQL, Mongo, PostgreSQL等平台和数据库，几乎覆盖主流web开发平台，而且<a href="https://console.appfog.com/pricing">免费套餐诱人</a>，部署方便，所以吸引的不少人的目光，尤其是像我这样没钱的学生党。缺点，服务器在国外（最近的也在新加坡），延迟肯定是有的，<strong>另外</strong>，说不定某天就被长城给over掉了。</p>
<p>苦于没有NAE邀请码，博客暂时部署在appfog上，部署过程还算简单，这里以Linux Ubuntu+nodejs部署为例，简单介绍一下。</p>
<h4>Step1.<a href="https://console.appfog.com/signup">注册</a>服务。</h4>
<p>好吧，我知道你肯定会，就当我说废话。。。</p>
<h4>Step2.创建一个APP</h4>
<p>当你注册完成后，进入<a href="https://console.appfog.com/">https://console.appfog.com/</a> ,点击New App，你可以看到app创建分三歩走：</p>
<p>第一步，选择一类应用，我们看到有三种支持的nodejs应用，nodejs，node chat node express，不管你是否使用了node express，<strong>选第一个nodejs都可以</strong>，关键是你在上传代码时加上所有你依赖的库，也就是node moudles那个文件夹放到代码跟目录即可。</p>
<p>第二步，选择一个服务器，随便你了，要说里你最近的就是新加坡的那个，使用的是亚马逊的云存储服务。</p>
<p>第三步，输入你的app子域名，也就是你给你的app起的名称。</p>
<p>之后，点击Create App，你会看到一个进度列表，当你看到‘done’后，你的应用就创建完毕了，简单吧。接下来，你将进入配置界面。</p>
<h4>Step3.App配置</h4>
<p>一个dashboard呈现在你面前：<br><img src="http://ww1.sinaimg.cn/large/a74ecc4cjw1dw4isb7yufj.jpg" alt="dashboard"></p>
<p>看上去够简单吧，介绍下，Instances顾名思义，启动实例数目，memeory quota是内存分配，你有2G的内存，你自己根据应用大小决定分配给他多少内存。调整完后记得点击一下右下角蓝色的Update！显示Done之后就修改完成了。</p>
<h4>Step4.创建数据服务</h4>
<p>很大一部分的web应用还是需要数据库的，appfog提供了三种数据引擎，mongodb，postgresql，mysql。点击左侧边栏Services，选择一种数据服务，在下面输入名字，创建就好。<br><img src="http://ww2.sinaimg.cn/large/a74ecc4cjw1dw4j4exjt5j.jpg" alt="数据服务"><br><strong>注意</strong>，还没有完，你需要将创建的服务和应用绑定(Bind)才能使用，不过你稍等片刻，他会自动给你绑定上。</p>
<h4>Step5.修改代码并上传</h4>
<p>修改代码重要的是你的数据库连接的代码，上面创建服务的页面有三种语言的连接实例，但是貌似打不开，nodejs可以使用下面代码：</p>
<pre class="prettyprint"><code>if(process.env.VCAP_SERVICES){
var env = JSON.parse(process.env.VCAP_SERVICES);
var mongo = env[&#39;mongodb-1.8&#39;][0][&#39;credentials&#39;];
}
else{
    var mongo = {
    &quot;hostname&quot;:&quot;localhost&quot;,
    &quot;port&quot;:27017,
    &quot;username&quot;:&quot;你的用户名&quot;,
    &quot;password&quot;:&quot;你的密码&quot;,
    &quot;name&quot;:&quot;你的应用名&quot;,
    &quot;db&quot;:&quot;db&quot;
    }
}
var generate_mongo_url = function(obj){
    obj.hostname = (obj.hostname || &#39;localhost&#39;);
    obj.port = (obj.port || 27017);
    obj.db = (obj.db || &#39;test&#39;);
    if(obj.username &amp;&amp; obj.password){
        return &quot;mongodb://&quot; + obj.username + &quot;:&quot; + obj.password + &quot;@&quot; + obj.hostname + &quot;:&quot; + obj.port + &quot;/&quot; + obj.db;
    }
    else{
        return &quot;mongodb://&quot; + obj.hostname + &quot;:&quot; + obj.port + &quot;/&quot; + obj.db;
    }
}
var mongourl = generate_mongo_url(mongo);</code></pre>
<p>把mongourl赋值给你的数据库连接字符串就好了。</p>
<p>ps:我一开始忘记设置数据库连接，仍然保持开发时候的127.0.0.1配置应用也能正常运行，奇怪，后来改过来了。</p>
<p>上传代码你需要ruby gem 和gem下的af。ubuntu下，</p>
<pre class="prettyprint"><code>sudo apt-get install ruby1.9.1 ruby1.9.1-dev gem
gem install af
cd ‘你的应用目录’
af login（之后输入你的邮箱和密码）
af update ‘你的应用名’</code></pre>
<p>等待，一连串的ok后完成，回到dashboard点击右边Visit Live Site，看看是不是已经运行了？</p>
<p>ps：之前的Step2可以在代码根目录用af命令：af push来实现，过程就是做几个选择题和填空题。<br>pps：你需要将所有的依赖库node_moudles保留在根目录，肯定有人想用package.json让服务器自己npm install，这种方法当然可以，你需要npm shrinkwrap，具体方法在<a href="http://docs.appfog.com/frameworks/node">这里</a>，但不如直接上传来的直接，而且免除莫名其妙的问题。</p>
<h4>Step6.绑定域名</h4>
<p>你已经有了一个appfog提供的域名，但如果你想使用自己的域名怎么办？appfog使用cname的方法绑定域名（如果你不知道cname是神马东东，google之）。具体操作：</p>
<p>点击做侧边栏Domain Names，在空白框内写入你的域名，update。然后去你的域名服务商那里设置解析方式cname，地址为红色的cname01开头的网址，appfog会自动根据你添加的域名进行定向，然后等待所有dns同步好你的信息，你就能访问了。</p>
<p>ok，6步，不出什么差错的话部署应该胜利完成了。</p>
<p>关于CLI控制appfog，看这里，<a href="http://docs.appfog.com/getting-started/af-cli">http://docs.appfog.com/getting-started/af-cli</a><br>进阶请随时保持对文档的关注，但需要你一定的英文阅读的能力。</p>
<p>还有：<strong>求NAE邀请码。。。。</strong></p>
<p>顶LZ了，这个托管引擎做得蛮人性化的，不过国外的云服务访问速度终究是硬伤呐</p>
<p>前几个刚注册了。<br>话说，nae不稳定。。</p>
<p>这个很不错的样子。就是数据库太小了。每个限制100M</p>
<p>只要一登陆就500<img src="/upload/4efc278625fa69ac6900043c/1345608207045_pic.JPG" alt="enter image description here"></p>
<p>这个嘛，我就遇到过一次，而且刷新几下就好了</p>
<p>试过，这个其实比NAE还不稳定~~</p>
<p>真的吗，如此这般更加坚定我转移到nae的决心。继续求码</p>
<p>NAE不知道是否我RP问题... 至今未能稳定部署一个应用... 只有很早前的一个应用. 后续上传的都报什么make dir.</p>
<p>ps: NAE能否用express3和Socket.io?</p>
<p>国内都需要备案，国外速度又有点问题，还随时有可能被墙</p>
<p>您好，我在windows 下用af ，会出错<img src="/upload/5025513af767cc9a51130f0f/1346090426330_%E6%9C%AA%E5%91%BD%E5%90%8D12.jpg" alt="enter image description here"></p>
<p>请问下af 这里的操作是如何的，我要如何将我的代码弄上appfog呢</p>
<p>我只能告诉你，多尝试几次吧！<br>我的windows 8下面会报一个编码错误，<br>现在在家都是在虚拟机中的win7 update的，<br>这个确实有时候喜欢抽风的乱报错！</p>
<p>国内链接不上啊，难道又被伟大的GFW给封啦？</p>
<p>因为工作的原因好久没来了，这个绝对要顶的。</p>
<p><strong>收藏了</strong><br>正好需要这个测试</p>
<p>这个不能用socket.io啊</p>
<p>很不错，appfog给新手做部署练习</p>
<p>怎么上传没看懂</p>
<h2>遇到个问题，请教下</h2>
<blockquote>
<p>我用的是express来开发，本地开发的时候一切正常。<br>   当登陆admin后进行的一系列操作都要先验证session，如果session失效会跳转到login<br>   本地开发是一切正常，session可以用，当我配置到appfog后发现很经常出现session无效的情况<br>   就连登陆也经常无法登陆，一般点几次才能登陆，登陆后进行操作又会跳回login页。又看不到控制台的信息，纠结ing啊~~~~</p>
</blockquote>
<p>试试用一个 instance 跑，而不是多个</p>
<div class="title"><a href="http://cnodejs.org/topic/500bcd604764b72902ed495a" target="_blank">
      Nodeclipse -- Node的Eclipse插件
    </a>6 小时前</div><p>Nodeclipse是一个Eclipse插件，想让习惯Eclipse的童鞋更方便的在Eclipse下开发Node.<br>这是一个业余项目，开发很慢，但是会一直进行。如果您是RCP高手，期待您的帮助和加入。</p>
<p>目前支持新建Node项目和Node源文件，代码高亮，代码提示，NPM操作支持等。</p>
<p>可以通过下面的地址在线安装。<br>Update Site : <a href="http://www.nodeclipse.org/updates">http://www.nodeclipse.org/updates</a></p>
<p>代码托管在Github。<br>项目地址：<a href="https://github.com/lambgao/nodeclipse">https://github.com/lambgao/nodeclipse</a></p>
<p>我发布这个项目是因为开发中碰到了困难，我不擅长RCP的开发，开发是处于摸索状态。如果您是RCP高手又非常愿意花费时间来参与那么可以和我联系。可以站内留言，或者Github上面，或者dev@nodeclipse.org，或者 <a href="http://weibo.com/lambsand">@金氧</a>，或者你还用什么沟通方式你希望我提供的都可以给你。</p>
<p>你需要哪方面的帮助？</p>
<p>如何继承已有的jsdt的js编辑器，本来有的那些功能代码格式化 语法检查的功能我不想再开发了。</p>
<p> @<a href="/user/jin52yang">jin52yang</a> 我明天在回顾一下jsdt。为什么不在jsdt上附加扩展而是自己做一个编辑器呢？</p>
<p> @<a href="/user/saighost">saighost</a> 我是想扩展，不知道咋扩展。暂时现在新整了一个编辑器.你可否加我一下qq61357158?</p>
<div class="title"><a href="http://cnodejs.org/topic/51c50a4d73c638f3707216a8" target="_blank">
      浏览器端 JS 装逼资源
    </a>6 小时前</div><p>JS 是一门 Scheme 方言<br><a href="http://javascript.crockford.com/little.html">http://javascript.crockford.com/little.html</a></p>
<p>各种语言编译到 JS<br><a href="https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS">https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS</a><br>C++ 有没有<br><a href="https://github.com/kripken/emscripten/wiki">https://github.com/kripken/emscripten/wiki</a><br>LLVM 有没有<br><a href="http://kripken.github.io/llvm.js/demo.html">http://kripken.github.io/llvm.js/demo.html</a><br>还可以编译到 JS 哦<br><a href="https://github.com/mishoo/UglifyJS2">https://github.com/mishoo/UglifyJS2</a><br>用来写 JS 的解释器<br><a href="https://github.com/jterrace/js.js/">https://github.com/jterrace/js.js/</a><br>用来跑 Scala 和 Java<br><a href="http://www.infoq.com/news/2013/06/scalajs">http://www.infoq.com/news/2013/06/scalajs</a><br><a href="http://int3.github.io/doppio/about.html">http://int3.github.io/doppio/about.html</a></p>
<p>JS 被用来写 Linux 内核<br><a href="http://bellard.org/jslinux/tech.html">http://bellard.org/jslinux/tech.html</a><br>用来个机器人编程<br><a href="http://robotics.stackexchange.com/questions/287/programming-robots-with-javascript">http://robotics.stackexchange.com/questions/287/programming-robots-with-javascript</a><br><a href="http://baalexander.github.io/rosnodejs/">http://baalexander.github.io/rosnodejs/</a></p>
<p>Github 第一大语言, CoffeeScript 第十哦<br><a href="https://github.com/languages">https://github.com/languages</a></p>
<p>JS 图形的功能就像未来的工具穿越到了现在<br><a href="http://acko.net/">http://acko.net/</a><br><a href="http://threejs.org/">http://threejs.org/</a></p>
<p>JS 能直接上数据酷和桌面应用, 以及 Web 服务器<br><a href="http://docs.mongodb.org/ecosystem/drivers/javascript/">http://docs.mongodb.org/ecosystem/drivers/javascript/</a><br><a href="http://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx">http://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx</a><br><a href="https://live.gnome.org/Gjs">https://live.gnome.org/Gjs</a><br><a href="https://nodejsmodules.org/">https://nodejsmodules.org/</a></p>
<p>丰富的社区资源<br><a href="http://dailyjs.com/">http://dailyjs.com/</a><br><a href="https://plus.google.com/communities/100875929141897651837">https://plus.google.com/communities/100875929141897651837</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">https://developer.mozilla.org/en-US/docs/Web/JavaScript</a><br><a href="https://developer.chrome.com/extensions/api_index.html">https://developer.chrome.com/extensions/api_index.html</a><br><a href="http://nodejs.org/api/index.html">http://nodejs.org/api/index.html</a></p>
<p>JS 有先进的调试工具<br><a href="http://www.youtube.com/watch?v=bqfoYaKCYUI&amp;feature=player_embedded">http://www.youtube.com/watch?v=bqfoYaKCYUI&amp;feature=player_embedded</a><br><a href="https://developers.google.com/chrome-developer-tools/">https://developers.google.com/chrome-developer-tools/</a></p>
<p>很多的模块化方案<br><a href="http://wibblycode.wordpress.com/2013/01/01/the-state-of-javascript-package-management/comment-page-1/">http://wibblycode.wordpress.com/2013/01/01/the-state-of-javascript-package-management/comment-page-1/</a><br><a href="http://tagneto.blogspot.com/2012/01/simplicity-and-javascript-modules.html">http://tagneto.blogspot.com/2012/01/simplicity-and-javascript-modules.html</a></p>
<p>速度也算快<br><a href="http://arstechnica.com/information-technology/2013/05/native-level-performance-on-the-web-a-brief-examination-of-asm-js/">http://arstechnica.com/information-technology/2013/05/native-level-performance-on-the-web-a-brief-examination-of-asm-js/</a></p>
<p>JS 实现的 OT 和 Git<br><a href="http://sharejs.org/">http://sharejs.org/</a><br><a href="https://github.com/creationix/js-git">https://github.com/creationix/js-git</a></p>
<p>Ruby Python 社区的同学各种讨论 JS<br><a href="http://ruby-china.org/topics/node5">http://ruby-china.org/topics/node5</a><br><a href="http://python-china.org/node/javascript">http://python-china.org/node/javascript</a><br>Haskell 方言想要取代 JS 没有成功<br><a href="http://elm-lang.org/">http://elm-lang.org/</a></p>
<p>JS 有各种大公司的实现<br><a href="http://en.wikipedia.org/wiki/List_of_ECMAScript_engines">http://en.wikipedia.org/wiki/List_of_ECMAScript_engines</a></p>
<p>CoffeeScript 可以用了写 JS, JS 可以用来写 CoffeeScript<br><a href="http://js2coffee.org/">http://js2coffee.org/</a><br>JS 被用来写幻灯片, 幻灯片可以用来写 JS<br><a href="https://brendaneich.com/presentations/">https://brendaneich.com/presentations/</a></p>
<p>JS 是一种数据结构<br><a href="http://en.wikipedia.org/wiki/JSON">http://en.wikipedia.org/wiki/JSON</a></p>
<p>很多人对 JS 的记忆刻骨铭心<br><a href="http://bonsaiden.github.io/JavaScript-Garden/">http://bonsaiden.github.io/JavaScript-Garden/</a><br><a href="http://wtfjs.com/">http://wtfjs.com/</a></p>
<p>JS 可以用了模拟设计模式<br><a href="http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/">http://www.addyosmani.com/resources/essentialjsdesignpatterns/book/</a><br>JS 是函数式的语言<br><a href="http://www.ibm.com/developerworks/library/wa-javascript/index.html">http://www.ibm.com/developerworks/library/wa-javascript/index.html</a></p>
<p><strong>很多人对 JS 的记忆刻骨铭心</strong></p>
<p>js 各种神奇的问题...呵呵</p>
<p>内容很丰富，支持一下</p>
<p>顶一个</p>
<p>mark，有时间看一边学一下</p>
<p>mark，有时间看一边学一下</p>
<p>mark，有时间看一边学一下</p>
<p>可惜大部分都是英文的  英文看不懂 伤不起啊</p>
<div class="title"><a href="http://cnodejs.org/topic/51db6871d44cbfa3040397e8" target="_blank">
      有大连的软件公司用 nodejs 的吗？
    </a>7 小时前</div><p>调查一下，看看大连的 node 环境怎么样。</p>
<p>有在用</p>
<p>大连的公司不错嘛。握个手。</p>
<p>内部用，还是给客户用？</p>
<div class="title"><a href="http://cnodejs.org/topic/513ca7e7df9e9fcc58c36e17" target="_blank">
      【云里来软件 北京招聘】JavaScript(Node.js) 开发工程师（全职-可soho/实习）
    </a>5 小时前</div><p>【招聘职位】<br>JavaScript  (Node.js)  开发工程师 --可接受soho工作</p>
<p>【招聘要求】<br>1. 精通  JavaScript(jQuery、Backbone.js等) + css + div 开发, 精通node.js开发<br>2. 有良好的编程习惯和素养<br>3. 具备较强地沟通协作能力，善于学习，有较强地分析解决问题的能力<br>4. 对新技术的发展趋势保持关注，能不断学习最新技术，爱好创新<br>5. 有很好的英语读写能力</p>
<p>【招聘说明】<br>1. 全职、实习均可;<br>2. 实习一周最好有4天坐班时间，周末也可；<br>3. 要求踏实负责任。  </p>
<p>【薪水福利】<br>1. 全职月薪 8k - 16k，实习 200-400元/天；<br>2. 全职五险一金齐全；<br>3. 享受每月的午餐补助；<br>4. 我们非常欢迎实习生能够留下作为长期员工，届时薪水再议。  </p>
<p>如果您对我们的招聘感兴趣，欢迎将个人简历发信到 business(at)cloud603.com </p>
<p>联系我们：<br>北京云里来软件有限公司<br>email: business(at)cloud603.com </p>
<p>【北京云里来软件有限公司 简介】<br>北京云里来软件有限公司秉承“为企业信息化服务”的宗旨，立足于软件的开发、研制、技术服务，以最成熟的技术、最有效的经验和最务实的态度为客户提供最适用的解决方案，致力于内容管理、企业及政府信息化、电子商务、商业智能等软件研发及销售的一家新兴软件技术企业，秉持科技立身，创新为命的发展理念， 辅助客户预见不断变化的市场，提高用户的市场竞争能力，是云里来软件公司立足市场的根本。</p>
<p>欢迎大家投递简历啊！</p>
<p>公司在哪里，最近要换工作，挺看好这个职位</p>
<p> @<a href="/user/TearY">TearY</a> 是在北京，地铁5号线沿线， 你在做什么开发哦？ 有意向的话请发份简历吧。</p>
<p> @<a href="/user/haohello">haohello</a> 做.net，更详细的是html+css+ js+asp.net mvc,写了比较长时间js，有nodejs经验，主要想找js方面的工作</p>
<p> @<a href="/user/TearY">TearY</a> 你可以给我们发份简历哦。</p>
<p> @<a href="/user/haohello">haohello</a> 公司在天通苑啊，挺远的</p>
<p>有木有高手在这儿呢？</p>
<p>给你们发了一个邮件，咨询是否接受SOHO，但你们没回我，难道是被扔到垃圾邮箱去了？</p>
<p> @<a href="/user/conis">conis</a>  一会儿去查收一下哦，现在求贤若渴，如果合适的话，我们也愿意这种合作方式。</p>
<p> @<a href="/user/haohello">haohello</a> 好，方便的话，到时候给我回个邮件</p>
<p>有没有可以业余时间做的活呢？</p>
<p> @<a href="/user/firstgeniusboy">firstgeniusboy</a> 哦，这个木有哦</p>
<p> @<a href="/user/haohello">haohello</a> 我最近也在学Nodejs 也在考虑这方面的工作，有空聊聊吧。firstgeniusboy@163.com 我的邮箱，方便的话可以把qq发给我，简历忙过了这阵再发给你。</p>
<p> @<a href="/user/firstgeniusboy">firstgeniusboy</a> 嗯，好的。</p>
<p>官网发一个上来</p>
<p>官网在哪儿呢？</p>
<p>围观下。。。 cloud603.com 应该是官网吧 </p>
<p>嗯，是哦，是去年做的官网</p>
<p>只在北京工作吗？</p>
<p>对啊，我们都在北京办公的。</p>
<p>这种开发模式应该是前台后台分离，看了一下官网介绍，用的全是最前沿的技术，无论是webapp还是mobile app, 因此我很感兴趣</p>
<p>兄弟，可否发份简历过来呢。</p>
<p>还没见你的回复啊。</p>
<p> @<a href="/user/haohello">haohello</a> 已经发送了，具体可以和我qq联系</p>
<p> @<a href="/user/ym1623">ym1623</a> 哦，要不你私信告诉我你的名字和qq吧</p>
<p>北京很远</p>
<p>你在什么地方啊？</p>
<p> @<a href="/user/haohello">haohello</a> 广州</p>
<p> @<a href="/user/leizongmin">leizongmin</a> 你的node.js水平怎么样啊</p>
<p> @<a href="/user/haohello">haohello</a> 还可以吧 <a href="http://ucdok.com/">http://ucdok.com/</a></p>
<p> @<a href="/user/leizongmin">leizongmin</a> 老雷谦逊。</p>
<p> @<a href="/user/leizongmin">leizongmin</a>  你有没有QQ啥的？ 我加一下你吧，可以多向你请教问题。</p>
<p> @<a href="/user/yansong">yansong</a> 确实谦虚哦</p>
<p> @<a href="/user/haohello">haohello</a> 402450329</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd2e42d44cbfa30436a2a4" target="_blank">
      nodeclub 没有上传图片的功能？在线等待
    </a>9 小时前</div><p>最新版本的，在线等待</p>
<p>曾经有, broken 了: <a href="https://github.com/cnodejs/nodeclub/issues/143">https://github.com/cnodejs/nodeclub/issues/143</a></p>
<p>以前一直都有..后来某天就死了...<br>图片上传用这个..<br><a href="http://upload.cnodejs.net/">http://upload.cnodejs.net/</a></p>
<p>谢谢</p>
<div class="title"><a href="http://cnodejs.org/topic/51dccbf7d44cbfa30427664b" target="_blank">
      express老是丢session是怎么回事啊
    </a>10 小时前</div><p>就是我nodejs应用中，老是莫名其妙的session就没了(express)</p>
<p>比如req.session.userid  初始化为123456</p>
<p>过阵子req.session.userid变成了undefined..</p>
<p>但是我没权限读写公共redis。后来我跟后端商量了下让他写了个读写session的口子暴露给我。(get set del)</p>
<p>这个丢session是怎么造成的啊？ 对于这个问题我这么处理可以么?</p>
<p>去express 的github 提issue...</p>
<p>session过期了吧</p>
<p>这个问题肯定是你们程序的问题啊,首先判断客户端的cookie中的sid还在不在?如果在然后看redis中sid对应的记录还在不在,排除到是不是过期问题.</p>
<p>如果是过期了，应该怎么办？@<a href="/user/leizongmin">leizongmin</a> ，从新创建session 吗？</p>
<p>Session被“过期”有两种情况：</p>
<ul>
<li><p>Session ID (存储在Cookie中的）过期了，Session ID过期后，服务器会分配一个新的Session ID给当前客户端，这样的话，原来的Session数据也相当于失效了</p>
</li>
<li><p>用来存储Session的数据库没有对应的数据了（比如Redis中设置了过期时间）</p>
</li>
</ul>
<p>以上任意一种情况都会导致Session数据没有了。<br>看你具体使用那个Sesison中间件，我不太清楚，你自己去看文档。</p>
<p>这不是丢session，而是session没有同步的问题吧……</p>
<div class="title"><a href="http://cnodejs.org/topic/51d3c105d44cbfa304316fd4" target="_blank">
      CNODE 模块proxy 的功能是什么
    </a>10 小时前</div><h2>社区的源码中proxy 模块功能是做什么的，有点不懂，有没有人了解的说下，</h2>
<p>不要只是简单说：代理、什么的，不是请你翻译。<br>谢谢了。</p>
<p><strong>EventProxy</strong>吧？</p>
<p>恩，是的？能解释下吗？</p>
<p><a href="https://npmjs.org/package/eventproxy">https://npmjs.org/package/eventproxy</a></p>
<p>哈哈，事件绑定，事件触发，异常处理，避免代码嵌套，对代码的可维护性很有好处</p>
<p>eventproxy 不错，不用多层嵌套了。</p>
<p>不过嵌套有个好处，外层的变量可以用在内层（在scope里），不用传来传去。eventproxy 怎么解决这个问题的？</p>
<p>你说的是proxy目录吧？数据代理层。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd27b3d44cbfa30435926c" target="_blank">
      Git 新手使用必看教程
    </a>10 小时前</div><p>对于我来说，使用git真的是走了不少弯路，目测弯路的代价达到了10个小时，</p><br><p>只是一个工具而已，花这么长时间几乎快把我的耐心用完了。</p><br><p>为了能让大家少走弯路，不走弯路，我觉得有必要把我的心酸历程写下来。</p><br><p>今天下班来不及了，明天来继续写。</p>




<p>坐等，呵呵</p>
<p>虽然这么说.. Git 教程已经太多了. 而且如果是教程, 我觉得翻译更靠谱<br>目前其他能替代 Git 的工具都不如 Git 广泛和好用, 还是花点时间学吧</p>
<p>坐等更新学习啊~</p>
<p>围观</p>
<p>公司里面现在都是使用SVN，<br><a href="http://121.199.33.218/bzm/Home/Detail/96"><a href="http://121.199.33.218/bzm/Home/Detail/96">http://121.199.33.218/bzm/Home/Detail/96</a></a><br>这个是我昨天写的，也发出来大家看看</p>
<p><a href="http://gitbook.liuhui998.com/">http://gitbook.liuhui998.com/</a></p>
<div class="title"><a href="http://cnodejs.org/topic/519f129e776b2e7f030ab605" target="_blank">
      如何用node.js写soap的client端？
    </a>12 小时前</div><p>原来是用java写的，现在初学node.js，要改写。怎么弄啊，哪位大侠可以指点一下？原来的那个xml文档里面的内容要怎么写到args里面呢？还有Header里面的东西。<br>headers.setHeader(&quot;Content-Type&quot;,&quot;text/xml&quot;);<br>headers.setHeader(&quot;SOAPAction&quot;,&quot;<a href="http://xxx.com/runQuery">http://xxx.com/runQuery</a>&quot;); </p>
<p>文档太少了。用的是node.js v0.10.7和milewise的soap模块。</p>
<p>  var soap = require(&#39;soap&#39;);<br>  var url = &#39;<a href="http://xxx.com/xxx.asmx">http://xxx.com/xxx.asmx</a>&#39;;<br>  var args = {xxx:&#39;abc&#39;};<br>  soap.createClient(url, function(err, client) {<br>      client.RunQuery(args, function(err, result) {<br>          console.log(result);<br>      });<br>  });</p>
<p>报错：<br>Error: Unexpected root element of WSDL or include<br>    at null.&lt;anonymous&gt; (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:907:23)<br>    at EventEmitter.emit (events.js:98:17)<br>    at Parser.parse (/home/taxi/nodeapp/node_modules/soap/node_modules/node-expat/lib/node-expat.js:18:22)<br>    at WSDL._parse (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:920:12)<br>    at WSDL._fromXML (/home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:928:29)<br>    at /home/taxi/nodeapp/node_modules/soap/lib/wsdl.js:584:18<br>    at process._tickCallback (node.js:415:13)</p>
<p>顶下</p>
<div class="title"><a href="http://cnodejs.org/topic/51c1205057628b975f1d4da9" target="_blank">
      NAE邀请码发送....
    </a>9 小时前</div><p>使用的请注明使用了哪个,注册成功后可以继续邀请其他人.<br><a href="http://cnodejs.net/regist?code=Kc335g64riB">http://cnodejs.net/regist?code=Kc335g64riB</a><br><a href="http://cnodejs.net/regist?code=kPxF5KotMQE">http://cnodejs.net/regist?code=kPxF5KotMQE</a><br><a href="http://cnodejs.net/regist?code=qdMSozptUrO">http://cnodejs.net/regist?code=qdMSozptUrO</a><br><a href="http://cnodejs.net/regist?code=ByVWRALAKxx">http://cnodejs.net/regist?code=ByVWRALAKxx</a><br><a href="http://cnodejs.net/regist?code=PQfJjQoDaT9">http://cnodejs.net/regist?code=PQfJjQoDaT9</a></p>
<p><a href="http://cnodejs.net/regist?code=CP0KN5ubIGF">http://cnodejs.net/regist?code=CP0KN5ubIGF</a><br><a href="http://cnodejs.net/regist?code=4BdvcdoRqCi">http://cnodejs.net/regist?code=4BdvcdoRqCi</a><br><a href="http://cnodejs.net/regist?code=cJmxNAjui71">http://cnodejs.net/regist?code=cJmxNAjui71</a><br><a href="http://cnodejs.net/regist?code=p0aBo0TbI2V">http://cnodejs.net/regist?code=p0aBo0TbI2V</a><br><a href="http://cnodejs.net/regist?code=FqIz9Y9Kmdi">http://cnodejs.net/regist?code=FqIz9Y9Kmdi</a></p>
<p>顶！</p>
<p>已用：<a href="http://cnodejs.net/regist?code=Kc335g64riB">http://cnodejs.net/regist?code=Kc335g64riB</a></p>
<p>@<a href="/user/showen">showen</a> 求邀请啊</p>
<p>@<a href="/user/wangzefu">wangzefu</a><br><a href="http://cnodejs.net/regist?code=QfgBWgGSEKX">http://cnodejs.net/regist?code=QfgBWgGSEKX</a><br><a href="http://cnodejs.net/regist?code=diOIngx5VYL">http://cnodejs.net/regist?code=diOIngx5VYL</a><br><a href="http://cnodejs.net/regist?code=F0MPxrdsj5r">http://cnodejs.net/regist?code=F0MPxrdsj5r</a><br><a href="http://cnodejs.net/regist?code=7McP0sRVC1h">http://cnodejs.net/regist?code=7McP0sRVC1h</a><br><a href="http://cnodejs.net/regist?code=emimB8GAc8q">http://cnodejs.net/regist?code=emimB8GAc8q</a></p>
<p>@<a href="/user/showen">showen</a> 谢谢哥</p>
<p>@<a href="/user/showen">showen</a> 使用了F0MPxrdsj5r，谢谢，但是直接就是邀请名额已经用完了，对不起大家</p>
<p>FqIz9Y9Kmdi</p>
<p>已经激活..</p>
<p>已用：<a href="http://cnodejs.net/regist?code=qdMSozptUrO">http://cnodejs.net/regist?code=qdMSozptUrO</a><br>我的邀请码：<br><a href="http://cnodejs.net/regist?code=GV4sgKCFTz5">http://cnodejs.net/regist?code=GV4sgKCFTz5</a><br><a href="http://cnodejs.net/regist?code=JfCdjlARak1">http://cnodejs.net/regist?code=JfCdjlARak1</a><br><a href="http://cnodejs.net/regist?code=OuiUrHzsOQM">http://cnodejs.net/regist?code=OuiUrHzsOQM</a><br><a href="http://cnodejs.net/regist?code=xgvxyl21g6o">http://cnodejs.net/regist?code=xgvxyl21g6o</a></p>
<p>话说 nae 的 node 版本还是 0.6.x ?</p>
<p>p0aBo0TbI2V<br>已经激活.....</p>
<p>OuiUrHzsOQM</p>
<p>已经激活</p>
<p>求邀请啊</p>
<p>@<a href="/user/wangzefu">wangzefu</a> 我的邀请码已经发完了哦，呵呵</p>
<p>貌似版本小于0.8啊,一些包用不上，也不支持socket.io</p>
<p><a href="http://cnodejs.net/regist?code=CP0KN5ubIGF">http://cnodejs.net/regist?code=CP0KN5ubIGF</a>   已经激活</p>
<p><a href="http://cnodejs.net/regist?code=YNN2WtD5vvX">http://cnodejs.net/regist?code=YNN2WtD5vvX</a></p>
<p><a href="http://cnodejs.net/regist?code=5B4KbYAOlAz">http://cnodejs.net/regist?code=5B4KbYAOlAz</a></p>
<p><a href="http://cnodejs.net/regist?code=4xma7kvIXpp">http://cnodejs.net/regist?code=4xma7kvIXpp</a></p>
<p><a href="http://cnodejs.net/regist?code=UTFJQXbzTW5">http://cnodejs.net/regist?code=UTFJQXbzTW5</a></p>
<p><a href="http://cnodejs.net/regist?code=mm2mHVT3uZu">http://cnodejs.net/regist?code=mm2mHVT3uZu</a></p>
<p>我的邀请码</p>
<p>激活那么多，不留点机会给其他人么。。</p>
<p>@<a href="/user/hexie">hexie</a> 额……兄弟，你想多了，这个是我发出来的邀请码</p>
<p>@<a href="/user/thesadboy">thesadboy</a> OTZ ,误会你了，向你道歉。</p>
<p>@<a href="/user/hexie">hexie</a> 呵呵，木有关系</p>
<p>怎么安装express报错?Unsupported<br>npm ERR! Not compatible with your version of node/npm: connect@2.7.11<br>npm ERR! Required: {&quot;node&quot;:&quot;&gt;= 0.8.0&quot;}<br>npm ERR! Actual:   {&quot;npm&quot;:&quot;1.1.21&quot;,&quot;node&quot;:&quot;0.6.18&quot;}</p>
<p>可以考虑先安装完了将模块文件夹一起上传，我这样是成功了，呵呵</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 手动上传了node_moduels目录<br>启动提示<br>[INFO] <em> connection established !<br>[ERROR] tfrc start fail, process exit code: 1, sig:null<br>[INFO] </em> connection closed !</p>
<p>@<a href="/user/yakczh">yakczh</a> 不会啊，你是用客户端操作的吧？可以试试直接在页面操作，将源码打包zip上传，然后点击发布试试。</p>
<p>@<a href="/user/thesadboy">thesadboy</a>  我本地的express,jade是安装成全局的,页面打包上传以后提示没有jade,然后通过命令行把node_modules目录复制了一个,再上传就启动不起来了,另外页面上传是一次性的,下一次传又把上次的全覆盖了</p>
<p>@<a href="/user/yakczh">yakczh</a> 我是在项目目录执行了npm i将所有的模块安装后打包整个项目为zip上传上去，启动成功。但是很神奇的就是部分jade语法提示错误，再查查。</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 我的终于搞定了，原来是jade的版本问题，呵呵，有兴趣看看，没整完的。<a href="http://nwyb.cnodejs.net/">http://nwyb.cnodejs.net/</a></p>
<p>@<a href="/user/thesadboy">thesadboy</a> 你的jade什么版本</p>
<p>@<a href="/user/yakczh">yakczh</a> 0.30.0</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 我在本地安装了 npm install jade@0.30.0 可以启动app, nae sup 上传以后,还是提示找不到jade</p>
<p>@<a href="/user/yakczh">yakczh</a> 你是怎么上传的？</p>
<p>@<a href="/user/thesadboy">thesadboy</a> 本地安装了 npm install jade@0.30.0  node app能运行以后,把整个目录下的文件打包 成zip 上传<br>要不你的包含jade的zip文件发我一份 fieldset@sohu.com,谢谢</p>
<p>@<a href="/user/yakczh">yakczh</a> 已发送</p>
<p>jade也安装不了,这能干啥,专门与hello world的吗?</p>
<p>nae auth 提示success了 执行命令还是提示没有权限呢?<br> nae status myclub<br>ERROR] <em> you don&#39;t have the app&#39;s permission . auth failed !<br>INFO] </em> connection closed !</p>
<p>npm ERR! Unsupported<br>npm ERR! Not compatible with your version of node/npm: mongodb@1.2.11<br>npm ERR! Required: {&quot;node&quot;:&quot;&gt;=0.6.19&quot;}<br>npm ERR! Actual:   {&quot;npm&quot;:&quot;1.1.21&quot;,&quot;node&quot;:&quot;0.6.18&quot;}</p>
<p>有人好缺德= =用了也不说下<br><a href="http://cnodejs.net/regist?code=4xma7kvIXpp">http://cnodejs.net/regist?code=4xma7kvIXpp</a> 已用<br><a href="http://cnodejs.net/regist?code=DIXso6wT8fN">http://cnodejs.net/regist?code=DIXso6wT8fN</a><br><a href="http://cnodejs.net/regist?code=F7Rbb5coM21">http://cnodejs.net/regist?code=F7Rbb5coM21</a><br><a href="http://cnodejs.net/regist?code=Q7hDgxZY5Xk">http://cnodejs.net/regist?code=Q7hDgxZY5Xk</a><br><a href="http://cnodejs.net/regist?code=xQA1VYwPsCq">http://cnodejs.net/regist?code=xQA1VYwPsCq</a><br><a href="http://cnodejs.net/regist?code=HOOzPIXSqui">http://cnodejs.net/regist?code=HOOzPIXSqui</a></p>
<p><a href="http://cnodejs.net/regist?code=DIXso6wT8fN">http://cnodejs.net/regist?code=DIXso6wT8fN</a> 已用</p>
<p>xQA1VYwPsCq 已用</p>
<p><a href="http://cnodejs.net/regist?code=iSwkbff34XK">http://cnodejs.net/regist?code=iSwkbff34XK</a><br><a href="http://cnodejs.net/regist?code=P1mtZeG28jb">http://cnodejs.net/regist?code=P1mtZeG28jb</a><br><a href="http://cnodejs.net/regist?code=qiC8fOw8Ac0">http://cnodejs.net/regist?code=qiC8fOw8Ac0</a><br><a href="http://cnodejs.net/regist?code=sRaZLemW2oa">http://cnodejs.net/regist?code=sRaZLemW2oa</a><br><a href="http://cnodejs.net/regist?code=OhKfyKQKJmo">http://cnodejs.net/regist?code=OhKfyKQKJmo</a>  </p>
<p><a href="http://cnodejs.net/regist?code=G3S9Slfzcqf">http://cnodejs.net/regist?code=G3S9Slfzcqf</a><br><a href="http://cnodejs.net/regist?code=0xed7lWqw84">http://cnodejs.net/regist?code=0xed7lWqw84</a><br><a href="http://cnodejs.net/regist?code=6WmCiRa8Rrp">http://cnodejs.net/regist?code=6WmCiRa8Rrp</a><br><a href="http://cnodejs.net/regist?code=UlQOnySw1TR">http://cnodejs.net/regist?code=UlQOnySw1TR</a><br><a href="http://cnodejs.net/regist?code=ZUqKB1E75tg">http://cnodejs.net/regist?code=ZUqKB1E75tg</a></p>
<p><a href="http://cnodejs.net/regist?code=0xed7lWqw84">http://cnodejs.net/regist?code=0xed7lWqw84</a> 己用</p>
<p>求注册码</p>
<p><a href="http://cnodejs.net/regist?code=HOOzPIXSqui已用">http://cnodejs.net/regist?code=HOOzPIXSqui已用</a></p>
<p>求注册码</p>
<p>求注册码</p>
<p>cJmxNAjui71 已经成功   谢谢！</p>
<p>   求邀请</p>
<p>求邀请</p>
<p><a href="http://cnodejs.net/regist?code=sRaZLemW2oa">http://cnodejs.net/regist?code=sRaZLemW2oa</a>  已用</p>
<p>求注册码</p>
<p> 求邀请</p>
<p>这才对嘛~</p>
<p>哪个高人给我发一个啊？</p>
<p>OhKfyKQKJmo已使用</p>
<p>求注册码</p>
<p>求注册码</p>
<p>厄。。。好厉害</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd6291d44cbfa3043d30c9" target="_blank">
      新人学习node.js求助
    </a>13 小时前</div><p>现在正在看《node.js入门经典》，里面有段代码不知道问什么无法执行<br>app.js代码如下<br>    var express = require(&#39;express&#39;);</p>
<pre class="prettyprint"><code>var app = express();

var io = require(&#39;socket.io&#39;).listen(app);

app.listen(3000);

app.get(&#39;/&#39;, function (req, res){
    res.sendfile(__dirname + &#39;/index.html&#39;);
});

io.sockets.on(&#39;connection&#39;, function (socket){
    socket.emit(&#39;welcome&#39;, {text: &#39;OH HAI! U R CONNECTED!&#39;});
});</code></pre>
<p>index.html代码如下<br>    &lt;!DOCTYPE html&gt;<br>    &lt;html lang="en"&gt;<br>      &lt;head&gt;<br>            &lt;meta charset="utf-8"/&gt;<br>            &lt;title&gt;Socket.IO Express Example&lt;/title&gt;<br>        &lt;/head&gt;<br>        &lt;body&gt;<br>            <h1>Socket.IO Express Example</h1><br>            &lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br>            &lt;script&gt;<br>                var socket = io.connect();<br>                socket.on(&#39;welcome&#39;, function (data){<br>                    console.log(&#39;data.text&#39;);<br>                });<br>            &lt;/script&gt;</p>
<pre class="prettyprint"><code>    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>总是报错无法找到/socket.io/socket.io.js</p>
<p>新人不太懂格式，看起来有点奇怪，还请各位大神将就点看哈</p>
<p>/socket.io/socket.io.js 由 socket.io 模块提供。你的 socket.io 模块安装了吗？</p>
<p>下面这行，执行时有没有错误信息？<br>var io = require(&#39;socket.io&#39;).listen(app); </p>
<p>程序执行没有错误，但是看javascript的输出时会提示无法io是未定义变量</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd2c64d44cbfa3043655b0" target="_blank">
      框架里面路由的地址配置的问题
    </a>13 小时前</div><p>大部分框架的路由地址都是相对的<br>有没有像微软mvc里面的路由地址是正则匹配的</p>
<p>/u/:id不是正则是什么?</p>
<p>微软mvc里面是 例如&#39;{controller}/{action}.html&#39; 这样会调用相应的控制器 里面的方法，然后可以为这个正则设置默认值,因为那个分层开发挺方便的 可能我意思表达有误吧</p>
<div class="title"><a href="http://cnodejs.org/topic/51de0afdf4963ade0e0971e7" target="_blank">
      关于SWIG工具的疑惑，请答疑
    </a>13 小时前</div><div class="title"><a href="http://cnodejs.org/topic/51524cff5dff253b370753ed" target="_blank">
      用http.get如何添加cookie啊？
    </a>10 小时前</div><p>需要模拟登陆一个网站，发现它那个cookie是js设置的，模拟的时候也需要带上，这个如何搞？</p>
<p>cookie 是设在域下面的，http response 头 中 含有 set-cookie 可以设置浏览器cookie</p>
<p><code>function (res) {
        res.setCookie(&quot;name=value&quot;);</code><br>这样不行啊！提示：has no method setCookie<br>在option中加入<br><code>headers: { &quot;set-cookie&quot;: &quot;name=value&quot; }</code><br>好像也不行，响应的结果和没加cookie是一样的。</p>
<p>你要模拟客户端请求 你打开firefox查看请求头就可以了撒 格式是这样的 headers: { &quot;Cookie&quot;: &quot;name=value&quot; }</p>
<p>好像也不行呢！如果有两个cookie，这样写是否可以：<br>headers: { &quot;Cookie&quot;: &quot;name=value&quot;, &quot;Cookie&quot;: &quot;name1=value1&quot;}</p>
<p>(&quot;Set-Cookie&quot;,[&quot;type=ninja&quot;,&quot;language=javascript&quot;]);<br>尝试这样。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd88fbd44cbfa3044200b7" target="_blank">
      关于sudo的一个诡异问题
    </a>20 小时前</div><p>想要安装个<code>n</code>,<code>npm install -g n</code>,报错</p>
<pre class="prettyprint"><code>npm http GET http://npm.hacknodejs.com/n
npm http 404 http://npm.hacknodejs.com/n
npm ERR! registry error parsing json
npm ERR! Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;
npm ERR!  { [Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;]
npm ERR!   errno: 3,
npm ERR!   code: &#39;EACCES&#39;,
npm ERR!   path: &#39;/usr/lib/node_modules&#39;,
npm ERR!   fstream_type: &#39;Directory&#39;,
npm ERR!   fstream_path: &#39;/usr/lib/node_modules/n&#39;,
npm ERR!   fstream_class: &#39;DirWriter&#39;,
npm ERR!   fstream_stack: 
npm ERR!    [ &#39;/usr/lib/nodejs/npm/node_modules/fstream/lib/writer.js:171:23&#39;,
npm ERR!      &#39;/usr/lib/nodejs/npm/node_modules/mkdirp/index.js:37:53&#39;,
npm ERR!      &#39;Object.oncomplete (fs.js:107:15)&#39; ] }
npm ERR! 
npm ERR! Please try running this command again as root/Administrator.

npm ERR! System Linux 3.8.0-19-generic
npm ERR! command &quot;node&quot; &quot;/usr/bin/npm&quot; &quot;install&quot; &quot;-g&quot; &quot;n&quot;
npm ERR! cwd /home/shukri
npm ERR! node -v v0.10.12
npm ERR! npm -v 1.2.32
npm ERR! path /usr/lib/node_modules
npm ERR! fstream_path /usr/lib/node_modules/n
npm ERR! fstream_type Directory
npm ERR! fstream_class DirWriter
npm ERR! code EACCES
npm ERR! errno 3
npm ERR! stack Error: EACCES, mkdir &#39;/usr/lib/node_modules&#39;
npm ERR! fstream_stack /usr/lib/nodejs/npm/node_modules/fstream/lib/writer.js:171:23
npm ERR! fstream_stack /usr/lib/nodejs/npm/node_modules/mkdirp/index.js:37:53
npm ERR! fstream_stack Object.oncomplete (fs.js:107:15)
npm ERR! 
npm ERR! Additional logging details can be found in:
npm ERR!     /home/shukri/npm-debug.log
npm ERR! not ok code 0</code></pre>
<p>然后 <code>sudo npm install -g n</code>，但是输入密码之后就没有反应了<br>然后试着&#39;npm -v&#39;</p>
<pre class="prettyprint"><code>1.2.32</code></pre>
<p>然后 <code>sudo npm -v</code>，命令行又什么都没输出，也没反应。。。 </p>
<p>系统是<code>linuxmint15</code>，刚装的系统，应该没问题啊</p>
<p>sudo su 转成 superuser mode, 再试试看。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dcc6b9d44cbfa304269cff" target="_blank">
      我在客户端始终无法响应res的end事件，小白提问。
    </a>13 小时前</div><pre class="prettyprint"><code> var http=require(&#39;http&#39;);
  var qs=require(&#39;querystring&#39;);
  var post_data={a:123,time:new Date().getTime()};//这是需要提交的数据
  var content=qs.stringify(post_data);

  var options = {
    host: &#39;localhost&#39;,
    port: 3000,
    path: &#39;/&#39;,
    method: &#39;POST&#39;,
    headers:{
    &#39;Content-Type&#39;:&#39;application/x-www-form-urlencoded&#39;,
    &#39;Content-Length&#39;:content.length
    }
  };
  console.log(&quot;post options:\n&quot;,options);
  console.log(&quot;content:&quot;,content);
  console.log(&quot;\n&quot;);

  var req = http.request(options, function(res) {
    console.log(&quot;statusCode: &quot;, res.statusCode);
    console.log(&quot;headers: &quot;, res.headers);
    var _data=&#39;&#39;;
    res.on(&#39;data&#39;, function(chunk){
       _data += chunk;
      console.log(_data);
    });
    res.on(&#39;end&#39;, function(){
       //data = qs.parse(_data);
      console.log(&#39;end is emitted&#39;);
      console.log(&quot;\n---&gt;&gt;\nresult:&quot;,_data)
    });
  });

  req.write(content);
  req.end();

  //服务器
  var http = require(&#39;http&#39;);
  var url = require(&#39;url&#39;);
  var util = require(&#39;util&#39;);
  var qs = require(&#39;querystring&#39;);
  http.createServer(function(req,res){
    var data = &#39;&#39;;
      req.on(&#39;data&#39;,function(chunk){
          data+=chunk;
      });

  req.on(&#39;end&#39;,function(){
      res.writeHead(200, {
        &#39;Content-Length&#39;: data.length,
      &#39;Content-Type&#39;: &#39;text/plain&#39; });
      data = qs.parse(data);
      console.log(data.a.toString());
      res.write(data.a.toString());
      res.end(&#39;hello&#39;);
      //data = qs.parse(data);
      console.log(data);
  });
  }).listen(3000);
  console.log(&quot;!!!&quot;);</code></pre>
<p>  在客户端<br>  我的res.on（end）事件始终没有反应……这是为什么？</p>
<p>req.on(&#39;end&#39;) ?</p>
<p>哥哥,你的req.end()调用的时候服务器还没启动呢?我给你的代码稍微改了下.<br>req.write(content);req.end();放到.listen(3000);的回调函数里面得到了你想要的结果.</p>
<p><pre><code><br>listen(3000,function(){<br>    req.write(content);<br>    req.end();<br>});<br></code></pre></p>
<p>我猜他是Server.js跟Client.js分開的。</p>
<p>只是他把Server &amp; Client的Code貼在一起了</p>
<p>经过哥的深入分析，原来是这里的问题：</p>
<pre class="prettyprint"><code>res.writeHead(200, {
        &#39;Content-Length&#39;: data.length,      // 应该去掉这一行
      &#39;Content-Type&#39;: &#39;text/plain&#39; });</code></pre>
<p>一般情况下是不需要自己去手动设置这个 <code>Content-Length</code> 的，但是你奇葩地去做了；<br>如果你没有设置 <code>Contebt-Length</code> ，http模块内部是会自动帮你计算的，但是你设置了这个值，而你实际返回的数据长度却没有这么多，于是http客户端请求时就在那傻傻地等（即使你已经 <code>res.end()</code> 了），直到连接关闭后才触发 <code>end</code> 事件。</p>
<p>设置了不正确的 <code>Content-Length</code> 的后果就是，如果实际数据长度超过了这个值，后面会被截断，如果实际没有这么大，就形成了 “无法触发end事件” 的假象。</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd05c7d44cbfa3042ed784" target="_blank">
      [招聘] Javascript程序员（上海）
    </a>20 小时前</div><h2>公司简介</h2>
<p>上海意派信息科技专注于跨平台数字出版解决方案的研发，既往已完成有“旅游时报 iOS APP”、“罗莱家纺产品营销展示系统 IPad APP”等客户项目系统开发，目前承担中国商飞的在线飞行培训系统的研制。</p>
<p>网站： <a href="http://www.21epub.com">http://www.21epub.com</a><br>地址：上海静安区延平路121号三和大厦20CD</p>
<h2>岗位职责</h2>
<ul>
<li>负责公司自主研发的在线可视化交互内容编撰系统开发</li>
<li>负责公司自主研发的多通道内容管理系统（CMS）后台UI开发</li>
<li>Web APP开发</li>
<li>网站/门户系统UI开发</li>
<li>参与JS开发框架的设计与持续完善</li>
</ul>
<h2>岗位要求</h2>
<ul>
<li>HTML/CSS/JQuery至少1年开发经验</li>
<li>熟悉Backbone，或具有其他JS MVC 框架经验</li>
<li>对交互体验有兴趣，有意愿对代码进行持续地优化和完善</li>
<li>有参与敏捷开发的经验尤佳</li>
<li>如果有掌握至少一种服务器端语言或框架尤佳</li>
<li>使用Git/SVN进行版本管理</li>
</ul>
<h2>应聘要求</h2>
<ul>
<li>请提供既往项目/工作成果，便于我们了解，在线网址 或 程序文件包都可。</li>
<li>简历请发送至 <a href="mailto:zhaoyuyong@21epub.com">zhaoyuyong@21epub.com</a></li>
</ul>
<div class="title"><a href="http://cnodejs.org/topic/51dd8d02d44cbfa304423e28" target="_blank">
      分享一个用 Flash Socket 连 Pomelo TCP 服务器的组件
    </a>22 小时前</div><div class="title"><a href="http://cnodejs.org/topic/51dd601ed44cbfa3043cb752" target="_blank">
      用socket.io隧道实现的一个应用
    </a>20 小时前</div><p>本人开发的一个项目，发布在Github上。地址为<a href="https://github.com/yeefont/http4gfw"><a href="https://github.com/yeefont/http4gfw">https://github.com/yeefont/http4gfw</a></a><br>对Socket, Stream的事件处理是否合理，不是很有把握。欢迎大家指教。<br>以下说明就是README</p>
<p>Http4GFW is a free and open source project developed by <a href="http://www.yeefont.com">Yeefont</a>. It aims to make web traffic pass through some sensitive firewall in internet.<br>Thanks to <strong>socket.io</strong> , the task on HTTP-traffic is much simpler now.</p>
<h1>How It Works</h1>
<p><img src="http://www.yeeads.com/img/github/node4gfw.jpg" alt="System Architecture of Http4gfw"></p>
<h1>Config &amp; Run</h1>
<ol>
<li>upload the project to Http-Host Server supporting Node.js, <strong>app.js</strong> is the  start script.</li>
<li>in local machine, run SOCKS5 script <strong>localA.js</strong> </li>
<li>in local machine, run DNS-Server Script <strong>localB.js</strong></li>
<li>in local machine, set Browser&#39;s SOCKS5 proxy address(default is <em>127.0.0.1:8888</em>, set interface&#39;s DNS-Server address(default is <em>127.0.0.1</em>)</li>
</ol>
<p>Please modify <strong>config.js</strong> according to your environment.</p>
<h1>Debug</h1>
<p>You can run the proxy-server in local machine.</p>
<hr>
<h1>Issues</h1>
<ol>
<li>the speed is much slower than normal VPN</li>
<li>it is just an experimental project, must have many bugs.</li>
</ol>
<div class="title"><a href="http://cnodejs.org/topic/51dbf215d44cbfa304149925" target="_blank">
      关于Http模块疑惑
    </a>7-10 20:47</div><p>我创建了一个http服务端，在接收请求函数中查找数据库里面的数据，将数据传回给客户端，当另外一个请求来临时，他要等到前面那个请求查找完数据返回客户端后，才能执行。如何解决该问题，是否要创建子进程去处理数据查询。</p>
<ol>
<li>用的什么数据库客户端？它只支持同步模式？</li>
<li>如果支持异步模式。那么与数据库的连接数多少，是否只有1；查询数据量大不大？如果以上皆是，增加连接数。</li>
</ol>
<p>用oracle，数据库的数据是亿级的，异步了也没用，还是要等待数据返回给客户端，另外一个请求才能获得请求，就像我们在http响应函数里面，计算一个长时间的计算一样。有什么好的办法吗，用child_process的话，几个请求就把CPU的用光了</p>
<p>@<a href="/user/zhs077">zhs077</a> <blockquote>几个请求就把CPU的用光</blockquote><br>你真的不是在做cpu密集型计算？</p>
<p>@<a href="/user/shiedman">shiedman</a> 查数据库耗时比较久</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd2dd4d44cbfa304369046" target="_blank">
      npm install -g formidable 不成功,怎么回事啊,在win7上装的
    </a>7-10 19:22</div><p>npm http GET <a href="https://registry.npmjs.org/formidable">https://registry.npmjs.org/formidable</a><br>npm http 304 <a href="https://registry.npmjs.org/formidable">https://registry.npmjs.org/formidable</a><br>npm WARN package.json bytes@0.2.1 No repository field.<br>npm WARN package.json fresh@0.1.0 No repository field.<br>npm WARN package.json repository@0.2.0 No repository field.<br>npm WARN package.json cookie-signature@1.0.1 No repository field.<br>npm WARN package.json methods@0.0.1 No repository field.<br>npm WARN package.json range-parser@0.0.4 No repository field.<br>npm WARN package.json policyfile@0.0.4 &#39;repositories&#39; (plural) Not supported.<br>npm WARN package.json Please pick one as the &#39;repository&#39; field<br>npm WARN package.json dateformat@1.0.6-1.2.3 No repository field.<br>npm WARN package.json growl@1.7.0 No repository field.<br>npm WARN package.json bytes@0.2.0 No repository field.<br>npm WARN package.json pause@0.0.1 No repository field.<br>npm WARN package.json uid2@0.0.2 No repository field.<br>formidable@1.0.14 C:\Users\Administrator\AppData\Roaming\npm\node_modules\formidable</p>
<p>添加:<br>var formidable = require(&#39;formidable&#39;);<br>之后:</p>
<p>module.js:340<br>    throw err;<br>          ^<br>Error: Cannot find module &#39;formidable&#39;<br>    at Function.Module._resolveFilename (module.js:338:15)<br>    at Function.Module._load (module.js:280:25)<br>    at Module.require (module.js:364:17)<br>    at require (module.js:380:17)<br>    at Object.&lt;anonymous&gt; (D:\node\test\server.js:5:18)<br>    at Module._compile (module.js:456:26)<br>    at Object.Module._extensions..js (module.js:474:10)<br>    at Module.load (module.js:356:32)<br>    at Function.Module._load (module.js:312:12)<br>    at Module.require (module.js:364:17)</p>
<div class="title"><a href="http://cnodejs.org/topic/51dd3d5bd44cbfa30438ce2b" target="_blank">
      Jul 10, 今天 Grunt 无法正常安装
    </a>7-10 18:54</div><div class="title"><a href="http://cnodejs.org/topic/518b679763e9f8a5424406e9" target="_blank">
      nodejs多线程，真正的非阻塞
    </a>7-10 19:55</div><p>node从他推出至今，充满赞美和饱受诟病的都是其单线程模型，所有的任务都在一个线程中完成（I/O等例外），优势的地方自然是免去了频繁切换线程的开销，以及减少资源互抢的问题等等，但是当nodejs面对cpu密集型模型的时候就力不从心了。尽管node拥有异步机制，可以把一些耗时算法丢入eventloop等待下个事件循环再做，但是因为其任然是单线程模型，所以终究会造成阻塞。</p>
<p>先解释一下两个名词，Fibers 和 Threads。<br>Fibers 又称纤程，可以理解为协同程序，类似py和lua都有这样的模型。使用Fibers可以避免对资源的互抢，减少cpu和内存的消耗，但是Fibers并不能够真正的并行执行，同一时刻只有一个Fibers在执行，如果在其中一个Fibers中执行过多的cpu操作或者写了个死循环，则整个主程序将卡死住。node中的异步事件循环模型就有点象这个。</p>
<p>Threads 又称线程，他可以在同一时刻并行的执行，他们共享主进程的内存，在其中某一时刻某一个threads锁死了，是不会影响主线程以及其他线程的执行。但是为了实现这个模型，我们不得不消耗更多的内存和cpu为线程切换的开销，同时也存在可能多个线程对同一内存单元进行读写而造成程序崩溃的问题。</p>
<p>很多让node支持多线程的方法是使用c/c++的addon来实现，在需要进行cpu密集型计算的地方，把js代码改写成c/c++代码，但是如果开发人员对c++不是很熟悉，一来开发效率会降低不少，二来也容易出bug，而且我们知道在addon中的c++代码除了编译出错外，是很难调试的，毕竟没有vs调试c++代码方便。</p>
<p>令人振奋的消息，我们为什么不让node也支持多线程模型呢？于是Jorge为我们开发出了一个让node支持多线程模型的模块：threads_a_gogo<br>github地址：<a href="https://github.com/xk/node-threads-a-gogo"><a href="https://github.com/xk/node-threads-a-gogo">https://github.com/xk/node-threads-a-gogo</a></a></p>
<p>有了threads-a-gogo（以下简称TAGG）这个模块之后，我们可以让node做更多的事情，我记得以前我看过一篇文章，说node只能应付i/o密集型场景，在cpu密集型场景将完败给apache，因为apache是为每一个请求起一条线程的，所以在处理cpu密集型任务时一个线程的高强度计算不会很大程度的影响其他线程，类似的还有php的fastcgi，这也是很多拿node和php进行比较时，php的拥护者们一直提出的理论。</p>
<p>我们先来做一个简单的测试，用我们suqian大大最喜欢的斐波那契数组来看一下，加入了多线程的node有多么的强悍：（测试机器为4CPU）<br>没有使用TAGG的正常情况，异步也帮不了我们应对cpu密集型任务</p>
<pre class="prettyprint"><code>    function fibo (n) {
      return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
    }
    var n=8
    function back(){
        if(!--n) return console.timeEnd(&#39;no thread&#39;);
    }
    console.time(&#39;no thread&#39;);

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})</code></pre>
<p>我们模拟了8个异步的行为，测试用的node v0.8.16版本，所以 process.nextTick还是异步方法。最后我们输出结果为：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
no thread: 23346ms</code></pre>
<p>接下来我们使用TAGG模块来测试同样的执行8次斐波那契数组计算，看看成绩如何？</p>
<pre class="prettyprint"><code>function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 thread&#39;);
var numThreads= 8; //创建线程池，最大数为8
var threadPool= require(&#39;threads_a_gogo&#39;).createPool(numThreads).all.eval(fibo); //为线程池注册程序
var i=8;
var cb = function(err,data){ //注册线程执行完毕的回调函数
    console.log(data);
    if(!--i){
        threadPool.destroy();
        console.timeEnd(&#39;8 thread&#39;);
    }
}
threadPool.any.eval(&#39;fibo(40)&#39;, cb); //开始向线程池中执行fibo(40)这个任务

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);</code></pre>
<p>最重的结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 thread: 9510ms</code></pre>
<p>相比不使用多线程模型的node，使用了TAGG模块之后，我们在4CPU服务器上的测试结果要快上一倍还不止。<br>到这里我们看上去找到了一个比较完美的解决方案应对CPU密集型任务，但是可能有同学会说，我可以使用cluster来做相同的事情，下面我们来做一个使用cluster计算这些任务的情况：</p>
<pre class="prettyprint"><code>var cluster = require(&#39;cluster&#39;);
var numCPUs = 8;
function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 cluster&#39;);
if (cluster.isMaster) {
  // Fork workers.
  for (var i = 0; i &lt; numCPUs; i++) {
    cluster.fork();
  }
  var i = 8;
  cluster.on(&#39;exit&#39;, function(worker, code, signal) {
        if(!--i){
            console.timeEnd(&#39;8 cluster&#39;);
            process.exit(0);
        }
  });
} else {
    console.log(fibo (40));
    process.exit(0);
}</code></pre>
<p>代码上的复杂程度比使用TAGG要高的多，而且如果是动态计算斐波那契数组的结果，编码将更加困难，需要在fork时挂上不同的参数，出错的几率也更大。同时还有更重要的一个事情，如果是创建一个http服务器，如果4个cluster都在计算fibo，那第5个请求node将无法处理，而是用TAGG则还是能够正常处理的，所以cluster并不能解决单线程模型的cpu密集计算带来的阻塞问题，我们看下测试结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 cluster: 11925ms</code></pre>
<p>TAGG模块还有其他更多的功能，比如事件触发，平滑退出，查看线程工作状态等等，总之TAGG模块给node注入了新的活力，让node一直饱受诟病的处理cpu密集任务问题得到了一个妥善的解决，就算你不擅长c++代码，也能够轻松编写出多线程的真正的非阻塞node程序了。</p>
<p>最后分享一篇干货文章，相当很精彩的一篇博客：<br><a href="http://bjouhier.wordpress.com/2012/03/11/fibers-and-threads-in-node-js-what-for/">Fibers and Threads in node.js – what for?</a></p>
<p>tagg2，nodejs多线程模块，更好的api，支持nodejs原生模块，跨平台支持，windows，linux和mac<br><a href="http://cnodejs.org/topic/51976afe63e9f8a542484e66">跨平台模块tagg2，让node多线程支持</a></p>
<p>干货分析，感谢。收藏了</p>
<p>最后文章的连接无法打开。。</p>
<p>修改了，不过貌似被墙了。。。爱、唉</p>
<p>threads_a_gogo貌似不支持windows哦  回去用linux试试看</p>
<p>代码使用的pthread标准库，貌似windows下没法使用</p>
<p>居然用 <code>eval</code>, 会不会蛋疼的... 文章好棒.<br>现在有没有其他多线程实现出来呢?</p>
<p>此 eval 可能非彼 eval 也</p>
<p> @<a href="/user/seasonx4">seasonx4</a> 既然传字符串了.. 我想到除了 <code>eval</code> 只有存成文件调用的...</p>
<p> @<a href="/user/jiyinyiyong">jiyinyiyong</a> 这个eval和js的eval没关系，只是表示执行的意思</p>
<p>真真是极好的.....</p>
<p>node官方是什么反应呢 Jorge又是什么来头</p>
<p>不着调jorge什么来头，官方没反应。。。。</p>
<p>貌似最近更新在1年前了诶....</p>
<p>Fibers and Threads in node.js – what for? 访问不了？看看这个截图</p>
<p><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png"><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png">http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png</a></a></p>
