<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <!-- meta -->
    <meta charset="utf-8" />
    <meta name='description' content='CNode：Node.js专业中文社区'>
    
    <meta name="author" content="EDP@TaoBao" />
    
    <meta property="wb:webmaster" content="617be6bd946c6b96" />
    
    <link title="RSS" type="application/rss+xml" rel="alternate" href="/rss" />
    <!-- style -->
    <link rel="stylesheet" href="http://cnodejs.qiniudn.com/public/stylesheets/index.min.3db2d1c8.css" media="all" />

    
    <script src="http://cnodejs.qiniudn.com/public/index.min.608faa1f.js"></script>

    
    
    <title>nodejs多线程，真正的非阻塞 - CNode</title>
    
  </head>
  <body>
    <!-- navbar -->
    <div class='navbar'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='brand' href='/'><img src="/public/images/logo.png" title="Node.js专业中文社区" /></a>
          <form id='search_form' class='navbar-search' action="/">
            <input type='text' id='q' name='q' class='search-query span3' value=''/>
          </form>
          <ul class='nav pull-right'>
            <li><a href='/'>首页</a></li>
            
            <li><a href="/tag/社区活动" target="">社区活动</a></li>
            
            <li><a href="http://cnodejs.net/" target="_blank">NAE</a></li>
            
            <li><a href="/topic/4f17948d9f40a8335200518e" target="">志愿者</a></li>
            
            <li><a href="/about" target="">关于我们</a></li>
            
            
            <li><a href='/signup'>注册</a></li>
            <li><a href='/signin'>登录</a></li>
            
          </ul>
        </div>
      </div>
    </div>
    <!-- wrapper -->
    <div id='wrapper'>
      <div id='main'>
        <div id='sidebar'>
  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>作者</span>
    </div>
    <div class='inner'>
      <div class='user_card'>
	<div>
		<a  class='user_avatar'  href="/user/snoopy">
			<img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
		</a>
		<span class='user_name'><a class='dark' href="/user/snoopy">snoopy</a></span>

		

		<div class='board clearfix'>
			<div class='floor'>
				<a href='/user/snoopy/tags/'><span class='big'>0</span> 标签收藏</a>
				<div class='space'></div>
				<a href='/user/snoopy/collections'><span class='big'>6</span> 话题收藏</a>
			</div>
			<div class='floor'>
				<a href='/user/snoopy/following'><span class='big'>27</span> 关注</a>
				<div class='space'></div>
				<a href='/user/snoopy/follower'><span class='big'>169</span> 粉丝</a>
				<div class='space'></div>
				<span class='big'>1140</span> 积分
			</div>

			
		</div>
	</div>
</div>



    </div>
  </div>

  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>作者其它话题</span>
    </div>
    <div class='inner'>
      
      <ul class='unstyled'>
      <li>
	<div><a class='dark' href="/topic/51c3ef9f73c638f37058e6bc" title="加装涡轮，提速expressjs">加装涡轮，提速expressjs</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51c3289573c638f370492f2e" title="高性能，跨平台，轻量级nodejs静态文件ifile模块">高性能，跨平台，轻量级nodejs静态文件ifile模块</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51ae2043555d34c678a95c95" title="高性能http/https的nodejs路由模块iroute">高性能http/https的nodejs路由模块iroute</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/50f90d8edf9e9fcc58a5ee0b" title="node-ccap模块生成captcha验证码">node-ccap模块生成captcha验证码</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/519ceb5263e9f8a542c19764" title="利用libuv编写异步多线程的addon实例">利用libuv编写异步多线程的addon实例</a></div>
</li>

      </ul>
      
    </div>
  </div>

  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>无人回复的话题</span>
    </div>
    <div class='inner'>
      
      <ul class='unstyled'>
      <li>
	<div><a class='dark' href="/topic/51de0afdf4963ade0e0971e7" title="关于SWIG工具的疑惑，请答疑">关于SWIG工具的疑惑，请答疑</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51dd8d02d44cbfa304423e28" title="分享一个用 Flash Socket 连 Pomelo TCP 服务器的组件">分享一个用 Flash Socket 连 Pomelo TCP 服务器的组件</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51dd3d5bd44cbfa30438ce2b" title="Jul 10, 今天 Grunt 无法正常安装">Jul 10, 今天 Grunt 无法正常安装</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51dccb43d44cbfa3042752c8" title="Node.js express 跨域问题">Node.js express 跨域问题</a></div>
</li>
<li>
	<div><a class='dark' href="/topic/51da5d80d44cbfa304ec19e6" title="node+socket.io+mysql 多房间聊天室的退出问题。">node+socket.io+mysql 多房间聊天室的退出问题。</a></div>
</li>

      </ul>
      
    </div>
  </div>
</div>

<div id='content'>
  <div class='panel'>
    <div class='header'>
      <ul class='breadcrumb'>
        <li><a href='/'>主页</a><span class='divider'>/</span></li>
        <li class='active'>话题详情</li>
      </ul>
    </div>
    <div class='inner topic'>
      <h3>
      
        nodejs多线程，真正的非阻塞
      </h3>
      <hr>
      <div class='topic_content'>
        <div class="markdown-text"><p>node从他推出至今，充满赞美和饱受诟病的都是其单线程模型，所有的任务都在一个线程中完成（I/O等例外），优势的地方自然是免去了频繁切换线程的开销，以及减少资源互抢的问题等等，但是当nodejs面对cpu密集型模型的时候就力不从心了。尽管node拥有异步机制，可以把一些耗时算法丢入eventloop等待下个事件循环再做，但是因为其任然是单线程模型，所以终究会造成阻塞。</p>
<p>先解释一下两个名词，Fibers 和 Threads。<br>Fibers 又称纤程，可以理解为协同程序，类似py和lua都有这样的模型。使用Fibers可以避免对资源的互抢，减少cpu和内存的消耗，但是Fibers并不能够真正的并行执行，同一时刻只有一个Fibers在执行，如果在其中一个Fibers中执行过多的cpu操作或者写了个死循环，则整个主程序将卡死住。node中的异步事件循环模型就有点象这个。</p>
<p>Threads 又称线程，他可以在同一时刻并行的执行，他们共享主进程的内存，在其中某一时刻某一个threads锁死了，是不会影响主线程以及其他线程的执行。但是为了实现这个模型，我们不得不消耗更多的内存和cpu为线程切换的开销，同时也存在可能多个线程对同一内存单元进行读写而造成程序崩溃的问题。</p>
<p>很多让node支持多线程的方法是使用c/c++的addon来实现，在需要进行cpu密集型计算的地方，把js代码改写成c/c++代码，但是如果开发人员对c++不是很熟悉，一来开发效率会降低不少，二来也容易出bug，而且我们知道在addon中的c++代码除了编译出错外，是很难调试的，毕竟没有vs调试c++代码方便。</p>
<p>令人振奋的消息，我们为什么不让node也支持多线程模型呢？于是Jorge为我们开发出了一个让node支持多线程模型的模块：threads_a_gogo<br>github地址：<a href="https://github.com/xk/node-threads-a-gogo"><a href="https://github.com/xk/node-threads-a-gogo">https://github.com/xk/node-threads-a-gogo</a></a></p>
<p>有了threads-a-gogo（以下简称TAGG）这个模块之后，我们可以让node做更多的事情，我记得以前我看过一篇文章，说node只能应付i/o密集型场景，在cpu密集型场景将完败给apache，因为apache是为每一个请求起一条线程的，所以在处理cpu密集型任务时一个线程的高强度计算不会很大程度的影响其他线程，类似的还有php的fastcgi，这也是很多拿node和php进行比较时，php的拥护者们一直提出的理论。</p>
<p>我们先来做一个简单的测试，用我们suqian大大最喜欢的斐波那契数组来看一下，加入了多线程的node有多么的强悍：（测试机器为4CPU）<br>没有使用TAGG的正常情况，异步也帮不了我们应对cpu密集型任务</p>
<pre class="prettyprint"><code>    function fibo (n) {
      return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
    }
    var n=8
    function back(){
        if(!--n) return console.timeEnd(&#39;no thread&#39;);
    }
    console.time(&#39;no thread&#39;);

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })
    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

    process.nextTick(function(){
        console.log(fibo (40));
        back();
    })

process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})
process.nextTick(function(){
    console.log(fibo (40));
    back();
})</code></pre>
<p>我们模拟了8个异步的行为，测试用的node v0.8.16版本，所以 process.nextTick还是异步方法。最后我们输出结果为：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
no thread: 23346ms</code></pre>
<p>接下来我们使用TAGG模块来测试同样的执行8次斐波那契数组计算，看看成绩如何？</p>
<pre class="prettyprint"><code>function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 thread&#39;);
var numThreads= 8; //创建线程池，最大数为8
var threadPool= require(&#39;threads_a_gogo&#39;).createPool(numThreads).all.eval(fibo); //为线程池注册程序
var i=8;
var cb = function(err,data){ //注册线程执行完毕的回调函数
    console.log(data);
    if(!--i){
        threadPool.destroy();
        console.timeEnd(&#39;8 thread&#39;);
    }
}
threadPool.any.eval(&#39;fibo(40)&#39;, cb); //开始向线程池中执行fibo(40)这个任务

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);

threadPool.any.eval(&#39;fibo(40)&#39;, cb);</code></pre>
<p>最重的结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 thread: 9510ms</code></pre>
<p>相比不使用多线程模型的node，使用了TAGG模块之后，我们在4CPU服务器上的测试结果要快上一倍还不止。<br>到这里我们看上去找到了一个比较完美的解决方案应对CPU密集型任务，但是可能有同学会说，我可以使用cluster来做相同的事情，下面我们来做一个使用cluster计算这些任务的情况：</p>
<pre class="prettyprint"><code>var cluster = require(&#39;cluster&#39;);
var numCPUs = 8;
function fibo (n) {
  return n &gt; 1 ? fibo(n - 1) + fibo(n - 2) : 1;
}
console.time(&#39;8 cluster&#39;);
if (cluster.isMaster) {
  // Fork workers.
  for (var i = 0; i &lt; numCPUs; i++) {
    cluster.fork();
  }
  var i = 8;
  cluster.on(&#39;exit&#39;, function(worker, code, signal) {
        if(!--i){
            console.timeEnd(&#39;8 cluster&#39;);
            process.exit(0);
        }
  });
} else {
    console.log(fibo (40));
    process.exit(0);
}</code></pre>
<p>代码上的复杂程度比使用TAGG要高的多，而且如果是动态计算斐波那契数组的结果，编码将更加困难，需要在fork时挂上不同的参数，出错的几率也更大。同时还有更重要的一个事情，如果是创建一个http服务器，如果4个cluster都在计算fibo，那第5个请求node将无法处理，而是用TAGG则还是能够正常处理的，所以cluster并不能解决单线程模型的cpu密集计算带来的阻塞问题，我们看下测试结果：</p>
<pre class="prettyprint"><code>165580141
165580141
165580141
165580141
165580141
165580141
165580141
165580141
8 cluster: 11925ms</code></pre>
<p>TAGG模块还有其他更多的功能，比如事件触发，平滑退出，查看线程工作状态等等，总之TAGG模块给node注入了新的活力，让node一直饱受诟病的处理cpu密集任务问题得到了一个妥善的解决，就算你不擅长c++代码，也能够轻松编写出多线程的真正的非阻塞node程序了。</p>
<p>最后分享一篇干货文章，相当很精彩的一篇博客：<br><a href="http://bjouhier.wordpress.com/2012/03/11/fibers-and-threads-in-node-js-what-for/">Fibers and Threads in node.js – what for?</a></p>
<p>tagg2，nodejs多线程模块，更好的api，支持nodejs原生模块，跨平台支持，windows，linux和mac<br><a href="http://cnodejs.org/topic/51976afe63e9f8a542484e66">跨平台模块tagg2，让node多线程支持</a></p>
</div>
      </div>
      <hr>
      <div class="tags">
        
        <span class='col_fade'>标签：无</span>  
        
      </div>
      <div class="changes">
        <span class='col_fade'>
          <a class='dark' href="/user/snoopy">snoopy</a> 在 5-9 17:08 发布
        </span>
        
        <span class='col_fade'>
          <a class='dark' href="/user/snoopy">snoopy</a> 在 6-25 21:07 重新编辑
        </span>
        
      </div>
      <div class="action">
        <a class='dark' id='share_weibo_btn'
          href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f='http://v.t.sina.com.cn/share/share.php?appkey=3020045345',u=z||d.location,p=['&url=',e(u),'&title=',e(t||d.title),'&source=',e(r),'&sourceUrl=',e(l),'&content=',c||'gb2312','&pic=',e(p||'')].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'','','','分享来自CNode的话题：nodejs多线程，真正的非阻塞','',''));"
          >分享到 weibo</a>
        
        
      </div>
    </div>
  </div>  
  
  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>14 回复</span>
    </div>
    <div class='cell reply_area reply_item' id="reply1" reply_id="518b6d3463e9f8a54244cefd">
  <a id="518b6d3463e9f8a54244cefd"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/hexie"><img src="http://www.gravatar.com/avatar/218220edff46df5465c8c36b0e6d1e2f?size=48" title="hexie" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/hexie">hexie
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518b6d3463e9f8a54244cefd">5-9 17:32</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#1</span>
      
      <span>
        
        <!---->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>干货分析，感谢。收藏了</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply2" reply_id="518b6d8d63e9f8a54244d59a">
  <a id="518b6d8d63e9f8a54244d59a"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/hexie"><img src="http://www.gravatar.com/avatar/218220edff46df5465c8c36b0e6d1e2f?size=48" title="hexie" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/hexie">hexie
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518b6d8d63e9f8a54244d59a">5-9 17:34</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#2</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>最后文章的连接无法打开。。</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518b7a9563e9f8a542461a45'>
  <div class='author_content'>
    <a id="518b7a9563e9f8a542461a45"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518b7a9563e9f8a542461a45">5-9 18:29</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>修改了，不过貌似被墙了。。。爱、唉</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply3" reply_id="518b959a63e9f8a5424ea29c">
  <a id="518b959a63e9f8a5424ea29c"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/showen"><img src="https://en.gravatar.com/userimage/49864593/32082ca696417812d83426b103136732.jpg" title="showen" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/showen">showen
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518b959a63e9f8a5424ea29c">5-9 20:24</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#3</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>threads_a_gogo貌似不支持windows哦  回去用linux试试看</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518c62e963e9f8a5425c5c52'>
  <div class='author_content'>
    <a id="518c62e963e9f8a5425c5c52"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518c62e963e9f8a5425c5c52">5-10 11:00</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>代码使用的pthread标准库，貌似windows下没法使用</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply4" reply_id="518b9e5063e9f8a5424f3572">
  <a id="518b9e5063e9f8a5424f3572"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/jiyinyiyong"><img src="http://www.gravatar.com/avatar/49d5a46383ea29666593e53c9851c58f?s=48" title="jiyinyiyong" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/jiyinyiyong">jiyinyiyong
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518b9e5063e9f8a5424f3572">5-9 21:02</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#4</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{3}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>居然用 <code>eval</code>, 会不会蛋疼的... 文章好棒.<br>现在有没有其他多线程实现出来呢?</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518ba82163e9f8a542504235'>
  <div class='author_content'>
    <a id="518ba82163e9f8a542504235"></a>
    <div class='user_avatar block'>
      <a href="/user/seasonx4">
        <img src="http://www.gravatar.com/avatar/eec70d7f87442d51c9b47b490c0d939f?size=48" title="seasonx4" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/seasonx4">seasonx4</a></span>
      <span class='col_fade'>
        <a href="#518ba82163e9f8a542504235">5-9 21:44</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>此 eval 可能非彼 eval 也</p>
</div>
  </div>
</div>
<div class='cell reply2_item' reply_id='518bb0a663e9f8a542515ecc'>
  <div class='author_content'>
    <a id="518bb0a663e9f8a542515ecc"></a>
    <div class='user_avatar block'>
      <a href="/user/jiyinyiyong">
        <img src="http://www.gravatar.com/avatar/49d5a46383ea29666593e53c9851c58f?s=48" title="jiyinyiyong" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/jiyinyiyong">jiyinyiyong</a></span>
      <span class='col_fade'>
        <a href="#518bb0a663e9f8a542515ecc">5-9 22:20</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p> @<a href="/user/seasonx4">seasonx4</a> 既然传字符串了.. 我想到除了 <code>eval</code> 只有存成文件调用的...</p>
</div>
  </div>
</div>
<div class='cell reply2_item' reply_id='518c61b563e9f8a5425c1ae9'>
  <div class='author_content'>
    <a id="518c61b563e9f8a5425c1ae9"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518c61b563e9f8a5425c1ae9">5-10 10:55</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p> @<a href="/user/jiyinyiyong">jiyinyiyong</a> 这个eval和js的eval没关系，只是表示执行的意思</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply5" reply_id="518ba86163e9f8a5425045f4">
  <a id="518ba86163e9f8a5425045f4"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/seasonx4"><img src="http://www.gravatar.com/avatar/eec70d7f87442d51c9b47b490c0d939f?size=48" title="seasonx4" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/seasonx4">seasonx4
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518ba86163e9f8a5425045f4">5-9 21:45</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#5</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>真真是极好的.....</p>
<p>node官方是什么反应呢 Jorge又是什么来头</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518c618863e9f8a5425c1715'>
  <div class='author_content'>
    <a id="518c618863e9f8a5425c1715"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518c618863e9f8a5425c1715">5-10 10:55</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>不着调jorge什么来头，官方没反应。。。。</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply6" reply_id="518ba8da63e9f8a542505474">
  <a id="518ba8da63e9f8a542505474"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/seasonx4"><img src="http://www.gravatar.com/avatar/eec70d7f87442d51c9b47b490c0d939f?size=48" title="seasonx4" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/seasonx4">seasonx4
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518ba8da63e9f8a542505474">5-9 21:47</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#6</span>
      
      <span>
        
        <!---->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>貌似最近更新在1年前了诶....</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply7" reply_id="518c5b2463e9f8a5425af086">
  <a id="518c5b2463e9f8a5425af086"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/suqian"><img src="http://tp1.sinaimg.cn/1640328892/50/5606661803/1" title="suqian" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/suqian">suqian
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c5b2463e9f8a5425af086">5-10 10:27</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#7</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{2}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>Fibers and Threads in node.js – what for? 访问不了？看看这个截图</p>
<p><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png"><a href="http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png">http://nfs.nodeblog.org/9/d/9d4da654f1eca2f24b3215940b9e1b45.png</a></a></p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518c616e63e9f8a5425c12c4'>
  <div class='author_content'>
    <a id="518c616e63e9f8a5425c12c4"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518c616e63e9f8a5425c12c4">5-10 10:54</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>我单位翻墙是福利，所以能看到，回到家里也要翻墙了才能看。<br>这几天在看这个TAGG模块的源码，打算强化他一下，它现在这个模块只能字符串传递，最好能直接传对象的引用，不然效率太低了。</p>
</div>
  </div>
</div>
<div class='cell reply2_item' reply_id='518c63e063e9f8a5425c82bc'>
  <div class='author_content'>
    <a id="518c63e063e9f8a5425c82bc"></a>
    <div class='user_avatar block'>
      <a href="/user/suqian">
        <img src="http://tp1.sinaimg.cn/1640328892/50/5606661803/1" title="suqian" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/suqian">suqian</a></span>
      <span class='col_fade'>
        <a href="#518c63e063e9f8a5425c82bc">5-10 11:05</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p> @<a href="/user/snoopy">snoopy</a> 支持啊！强烈关注下一篇文章！</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply8" reply_id="518c66e463e9f8a5425cd8cf">
  <a id="518c66e463e9f8a5425cd8cf"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/beiyio"><img src="http://www.gravatar.com/avatar/0808e2b8693f46047e56d738e12e22ee?size=48" title="beiyio" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/beiyio">beiyio
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c66e463e9f8a5425cd8cf">5-10 11:17</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#8</span>
      
      <span>
        
        <!---->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>不知道是否有源码，自己在windos下编译下应该也能用吧</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply9" reply_id="518c68ab63e9f8a5425d03bb">
  <a id="518c68ab63e9f8a5425d03bb"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/xieccy"><img src="http://www.gravatar.com/avatar/09a2869724dab220fe764076b5a40f40?s=48" title="xieccy" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/xieccy">xieccy
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c68ab63e9f8a5425d03bb">5-10 11:25</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#9</span>
      
      <span>
        
        <!---->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>好久了， 这项目</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply10" reply_id="518c68e163e9f8a5425d0661">
  <a id="518c68e163e9f8a5425d0661"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/xieccy"><img src="http://www.gravatar.com/avatar/09a2869724dab220fe764076b5a40f40?s=48" title="xieccy" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/xieccy">xieccy
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c68e163e9f8a5425d0661">5-10 11:26</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#10</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>其实我比较喜欢看Bruno和Issac在博客里对骂， 哈哈。</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518cbb6963e9f8a54267ba7c'>
  <div class='author_content'>
    <a id="518cbb6963e9f8a54267ba7c"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518cbb6963e9f8a54267ba7c">5-10 17:18</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>圈圈你也来了？外国人都很亢奋么，呵呵~</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply11" reply_id="518c6b7063e9f8a5425d6c1b">
  <a id="518c6b7063e9f8a5425d6c1b"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/xieccy"><img src="http://www.gravatar.com/avatar/09a2869724dab220fe764076b5a40f40?s=48" title="xieccy" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/xieccy">xieccy
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c6b7063e9f8a5425d6c1b">5-10 11:37</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#11</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p><a href="http://bjouhier.wordpress.com/2012/04/14/node-js-awesome-runtime-and-new-age-javascript-gospel/">http://bjouhier.wordpress.com/2012/04/14/node-js-awesome-runtime-and-new-age-javascript-gospel/</a></p>
<p>对骂的在后面的评论里。 摘一段：</p>
<blockquote>
<p>Blockquote<br>The node core team is not under any illusions that our current APIs are perfect. Are you insane? Handling errors is nightmarishly error prone! Why do you think that we’re doing this whole domains feature for v0.8? It’s just that most of us think that Streamline is is the wrong solution to the wrong part of the problem, that’s all. You don’t get to call people dogmatic just because they don’t agree with you. That’s childish and rude, Bruno.</p>
</blockquote>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518c7de363e9f8a5425f63a3'>
  <div class='author_content'>
    <a id="518c7de363e9f8a5425f63a3"></a>
    <div class='user_avatar block'>
      <a href="/user/shiedman">
        <img src="http://www.gravatar.com/avatar/849581002e39edc8ffe0cb8b97ee6f12?size=48" title="shiedman" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/shiedman">shiedman</a></span>
      <span class='col_fade'>
        <a href="#518c7de363e9f8a5425f63a3">5-10 12:56</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>比较赞同Bruno关于Asynchronous !== Callbacks(异步！＝回调）的看法。至今我们实现异步的方法都只能通过回调，在业务逻辑比较复杂的情况下，很容易就掉入回调嵌套回调的<strong>回调地狱</strong>里面，如果能提供yield/generator类似的功能，无疑会大大简化程序流程和可读性。<br>另一方面，Issac坚持nodejs语法规范与v8同步，声称</p>
<blockquote>
<p>Node is not a language design project</p>
</blockquote>
<p>同样无可挑剔。看来只能寄望v8在将来加入yield/generator。</p>
<h1>比较回调与yield实现异步的方式</h1>
<p>callback====</p>
<pre class="prettyprint"><code>var fs=require(&#39;fs&#39;);
fs.readFile(__filename,function(err,data){
    fs.writeFile(__filename+&#39;.bak&#39;,data,function(err){
        console.log(&#39;file backup success!&#39;);
    })
});</code></pre>
<p>=====yield=====</p>
<pre class="prettyprint"><code>//npm install fibers before run this code
var Fiber=require(&#39;fibers&#39;);
var fs = require(&#39;fs&#39;);
Fiber(function(){
    var fiber=Fiber.current;
    fs.readFile(__filename,function(err,data){
        fiber.run(data);
    });
    var data=Fiber.yield();
    fs.writeFile(__filename+&#39;.bak&#39;,data,function(err){
        console.log(&#39;file backup success!&#39;);
    });
}).run();</code></pre>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply12" reply_id="518c801163e9f8a5425fa5bc">
  <a id="518c801163e9f8a5425fa5bc"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/shiedman"><img src="http://www.gravatar.com/avatar/849581002e39edc8ffe0cb8b97ee6f12?size=48" title="shiedman" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/shiedman">shiedman
        </a>
      </span>
      <span class='col_fade'>
        <a href="#518c801163e9f8a5425fa5bc">5-10 13:05</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#12</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>threads-a-gogo是否支持访问node原生模块？<br>例如在fibo函数内增加一行<br><code>if(n==40)var fs=require(&#39;fs&#39;);</code><br>fibo函数报错：<br><code>ReferenceError: require is not defined</code><br>莫非tagg上下文(context)是纯粹的V8?这么强大。。。</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='518cbb2e63e9f8a54267b7d5'>
  <div class='author_content'>
    <a id="518cbb2e63e9f8a54267b7d5"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#518cbb2e63e9f8a54267b7d5">5-10 17:17</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>目前TAGG不支持，今天通读了这个模块的源码，已经想好怎么改造了，要然用户在线程里获取一些ndoe的东西，不然局限性太大了，估计作者对js不是很熟悉，但是写C真的是有一手。</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply13" reply_id="51dd2cead44cbfa304366821">
  <a id="51dd2cead44cbfa304366821"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/zhs077"><img src="http://www.gravatar.com/avatar/122f09f367baffc0f744cf46335b6521?size=48" title="zhs077" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/zhs077">zhs077
        </a>
      </span>
      <span class='col_fade'>
        <a href="#51dd2cead44cbfa304366821">7-10 17:44</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#13</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>什么时候能够在线程函数中返回node模块？？</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='51dd4b90d44cbfa3043a68a2'>
  <div class='author_content'>
    <a id="51dd4b90d44cbfa3043a68a2"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#51dd4b90d44cbfa3043a68a2">7-10 19:54</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>如楼下所说，nodejs多线程就不叫nodejs了，我目前做不到在多线程中植入node模块的东西，想要让nodejs支持多线程参考我的另一篇文章<br><a href="http://cnodejs.org/topic/519ceb5263e9f8a542c19764">利用libuv编写异步多线程的addon实例</a><br>还有ifile这个模块就是一个nodejs利用libuv多线程的demo<br><a href="http://cnodejs.org/topic/51c3289573c638f370492f2e">高性能，跨平台，轻量级nodejs静态文件ifile模块</a></p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>
<div class='cell reply_area reply_item' id="reply14" reply_id="51dd2d66d44cbfa304367cf9">
  <a id="51dd2d66d44cbfa304367cf9"></a>
  <div class='author_content'>
    <div class='user_avatar block'>
      <a href="/user/dengqiao"><img src="http://tp4.sinaimg.cn/2126166431/180/5635848686/1" title="dengqiao" /></a>
    </div>
    <div class='user_info'>
      <span class='reply_author'>
        <a class='dark' href="/user/dengqiao">dengqiao
        </a>
      </span>
      <span class='col_fade'>
        <a href="#51dd2d66d44cbfa304367cf9">7-10 17:46</a>
      </span>
    </div>
    <div class='user_action'>
      <span class='col_fade'>#14</span>
      
      <span>
        
        <!--
         <span class='col_fade'>{1}</span>
        -->
      </span>
    </div>
  </div>
  <div class='reply_content'>
  <div class="markdown-text"><p>node.js多线程就不少node.js了</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
        <div class='cell reply2_item' reply_id='51dd4bb6d44cbfa3043a6be6'>
  <div class='author_content'>
    <a id="51dd4bb6d44cbfa3043a6be6"></a>
    <div class='user_avatar block'>
      <a href="/user/snoopy">
        <img src="http://www.gravatar.com/avatar/ba5cfa8ed415cdd50b556a9482c696e9?s=48" title="snoopy" />
      </a>
    </div>
    <div class='user_info'>
      <span class='reply_author'><a class='dark' href="/user/snoopy">snoopy</a></span>
      <span class='col_fade'>
        <a href="#51dd4bb6d44cbfa3043a6be6">7-10 19:55</a>
      </span>
    </div>
    <div class='user_action'>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content'>
    <div class="markdown-text"><p>是的，js从诞生就注定是单线程的，无法改变的</p>
</div>
  </div>
</div>

      
      
    </div>
  </div>
</div>

  </div>
  
  
</div>


<script src="http://cnodejs.qiniudn.com/public/fancebox.min.81d92ecc.js"></script>
<link rel="stylesheet" href="http://cnodejs.qiniudn.com/public/libs/fancybox/fancebox.min.a4966e97.css" media="all" />


      </div>
    </div>
    <div id='backtotop'>回到顶部</div>
    <div id='footer'>
      <div id='footer_main'>
        <div class="links">
          <a class='dark' href='/about'><strong>关于</strong></a>
          |
          <a class='dark' href='/faq'><strong>FAQ</strong></a>
          |
          <a class='dark' href='https://github.com/cnodejs/nodeclub/' target="_blank"><strong>Github</strong></a>
          |
          <a class='dark' href='/rss' target="_blank"><strong>RSS</strong></a>
        </div>
        <div class='col_fade'>
          &copy; 2012 - 2013 <br>本社区为开源系统，版本: 0.3.5 ，欢迎贡献代码<br>
          由<a href='http://cnodejs.net' target='_blank'> NAE </a>为 CNode 提供动力
        </div>
      </div>
    </div>
  </body>
</html>
<br/>